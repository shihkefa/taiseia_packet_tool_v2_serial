<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaiSEIA 101 å”å®šå°åŒ…å·¥å…· v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Tahoma, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .version {
            position: absolute;
            top: 10px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 1em;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .label-info {
            font-weight: normal;
            color: #6c757d;
            font-size: 0.9em;
            margin-left: 10px;
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        textarea {
            font-family: 'Courier New', monospace;
            resize: vertical;
            min-height: 80px;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            margin-top: 10px;
        }

        .result-box {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 100px;
        }

        .packet-display {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            background: #2d3748;
            color: #68d391;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            word-break: break-all;
        }

        .packet-visual {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .packet-byte {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            text-align: center;
            min-width: 70px;
        }

        .packet-byte.checksum {
            background: #28a745;
        }

        .packet-byte-label {
            font-size: 0.8em;
            opacity: 0.8;
            display: block;
            margin-bottom: 5px;
        }

        .byte-explain {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-left: 4px solid #667eea;
        }

        .byte-explain strong {
            color: #667eea;
        }

        .error {
            background: #fee;
            border: 2px solid #f88;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .info-table th,
        .info-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .info-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
        }

        .info-table tr:hover {
            background: #f8f9fa;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .packet-visual {
                justify-content: center;
            }
        }

        .service-list {
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }

        .service-item {
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            transition: all 0.3s;
            border: 1px solid #dee2e6;
        }

        .service-item:hover {
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .service-item summary {
            padding: 12px 15px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            border-radius: 8px;
        }

        .service-item summary:hover {
            background: #f8f9fa;
        }

        .service-item[open] summary {
            border-bottom: 1px solid #dee2e6;
            border-radius: 8px 8px 0 0;
            background: #f8f9fa;
        }

        .service-item summary::-webkit-details-marker {
            display: none;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .search-box {
            position: sticky;
            top: 0;
            background: white;
            padding: 10px 0;
            z-index: 10;
        }

        .help-text {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-size: 0.95em;
        }

        .example-box {
            background: #fff9e6;
            border: 2px dashed #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge-read {
            background: #17a2b8;
            color: white;
        }

        .badge-write {
            background: #dc3545;
            color: white;
        }

        .quick-links {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .quick-link {
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
        }

        .quick-link:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="version">v2.0</div>
            <h1>TaiSEIA 101 å”å®šå°åŒ…å·¥å…·</h1>
            <p>ç©ºèª¿é€šè¨ŠæŠ“åŒ…è½‰è­¯å°å·¥å…· by å²é˜¿æ³•20260118.001</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('generate')">ğŸ“ ç”¢ç”Ÿå°åŒ…</button>
            <button class="tab" onclick="switchTab('parse')">ğŸ” è§£æå°åŒ…</button>
            <button class="tab" onclick="switchTab('serial')">ğŸ”Œ ä¸²å£é€šè¨Š</button>
            <button class="tab" onclick="switchTab('compare')">âš–ï¸ å»£æ’­æ¯”å°</button>
            <button class="tab" onclick="switchTab('batch')">ğŸ“Š æ‰¹æ¬¡è™•ç†</button>
            <button class="tab" onclick="switchTab('services')">ğŸ“š æœå‹™åˆ—è¡¨</button>
            <button class="tab" onclick="switchTab('help')">â“ ä½¿ç”¨èªªæ˜</button>
        </div>

        <!-- ç”¢ç”Ÿå°åŒ…é é¢ -->
        <div id="generate" class="tab-content active">
            <h2>ç”¢ç”Ÿ TaiSEIA å°åŒ…</h2>
            
            <div class="help-text">
                ğŸ’¡ <strong>æç¤ºï¼š</strong>é¸æ“‡è¨­å‚™é¡å‹å’Œæœå‹™ï¼Œè¨­å®šæ•¸å€¼å¾Œé»æ“Šç”¢ç”Ÿï¼Œç³»çµ±æœƒè‡ªå‹•è¨ˆç®— XOR æ ¡é©—ç¢¼
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="deviceType">
                        è¨­å‚™é¡å‹ (SA_ID)
                        <span class="label-info">- è¨­å‚™åœ°å€è­˜åˆ¥ç¢¼</span>
                    </label>
                    <select id="deviceType" onchange="updateServiceOptions()">
                        <option value="0x00">0x00 - å»£æ’­ (æ‰€æœ‰è¨­å‚™)</option>
                        <option value="0x01" selected>0x01 - ç©ºèª¿ (Air Conditioner)</option>
                        <option value="0x03">0x03 - æ´—è¡£æ©Ÿ (Washing Machine)</option>
                        <option value="0x04">0x04 - é™¤æ¿•æ©Ÿ (Dehumidifier)</option>
                        <option value="0x08">0x08 - ç©ºæ°£æ¸…æ·¨æ©Ÿ (Air Purifier)</option>
                        <option value="0x0E">0x0E - å…¨ç†±äº¤æ›å™¨ (ERV)</option>
                        <option value="0x0F">0x0F - é›»é¢¨æ‰‡ (Electric Fan)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="commandType">
                        å‘½ä»¤é¡å‹
                        <span class="label-info">- è®€å–æˆ–å¯«å…¥</span>
                    </label>
                    <select id="commandType">
                        <option value="write" selected>å¯«å…¥ (Write) - è¨­å®šåƒæ•¸</option>
                        <option value="read">è®€å– (Read) - æŸ¥è©¢ç‹€æ…‹</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="serviceId">
                    æœå‹™ ID (Service ID)
                    <span class="label-info">- é¸æ“‡è¦æ§åˆ¶çš„åŠŸèƒ½</span>
                </label>
                <select id="serviceId" onchange="updateValueHelp()">
                    <!-- å‹•æ…‹ç”¢ç”Ÿ -->
                </select>
            </div>

            <div class="form-group">
                <label for="dataValue">
                    æ•¸æ“šå€¼ (Data Value)
                    <span class="label-info">- é¸æ“‡æ•¸å€¼æˆ–è‡ªè¨‚</span>
                </label>
                <select id="dataValue" onchange="handleDataValueChange()">
                    <!-- å‹•æ…‹ç”¢ç”Ÿ -->
                </select>
                <div id="customValueInput" style="display: none; margin-top: 10px;">
                    <label for="customValue">
                        è‡ªè¨‚æ•¸å€¼
                        <span class="label-info">- åé€²ä½æˆ–åå…­é€²ä½ (0xé–‹é ­)</span>
                    </label>
                    <input type="text" id="customValue" placeholder="ä¾‹å¦‚: 25 æˆ– 0x19">
                </div>
                <div id="valueHelp" class="help-text" style="margin-top: 10px; display: none;"></div>
            </div>

            <button class="btn" onclick="generatePacket()">ğŸš€ ç”¢ç”Ÿå°åŒ…</button>
            
            <div id="generateResult" class="result-box" style="display: none;"></div>
        </div>

        <!-- è§£æå°åŒ…é é¢ -->
        <div id="parse" class="tab-content">
            <h2>è§£æ TaiSEIA å°åŒ…</h2>
            
            <div class="help-text">
                ğŸ’¡ <strong>æç¤ºï¼š</strong>è¼¸å…¥åå…­é€²ä½å°åŒ… (å¯å«æˆ–ä¸å«åˆ†éš”ç¬¦è™Ÿ)ï¼Œæ”¯æ´æ¨™æº–6å­—ç¯€å°åŒ…å’Œé•·å°åŒ…
            </div>

            <div class="example-box">
                <strong>ğŸ“‹ ç¯„ä¾‹æ ¼å¼ï¼š</strong><br>
                â€¢ <code>06 00 08 FF FF 0E</code> (ç©ºæ ¼åˆ†éš”)<br>
                â€¢ <code>06:00:08:FF:FF:0E</code> (å†’è™Ÿåˆ†éš”)<br>
                â€¢ <code>060008FFFF0E</code> (ç„¡åˆ†éš”)<br>
                â€¢ <code>0x06 0x00 0x08 0xFF 0xFF 0x0E</code> (0xå‰ç¶´)
            </div>

            <div class="quick-links">
                <div class="quick-link" onclick="fillExample('06:00:08:FF:FF:0E')">ç¯„ä¾‹1: å»£æ’­æŸ¥è©¢ç‹€æ…‹ â­æœ€å¸¸ç”¨</div>
                <div class="quick-link" onclick="fillExample('06:01:80:00:01:86')">ç¯„ä¾‹2: é–‹å•Ÿç©ºèª¿</div>
                <div class="quick-link" onclick="fillExample('06:01:83:00:19:9D')">ç¯„ä¾‹3: è¨­å®šæº«åº¦25Â°C</div>
                <div class="quick-link" onclick="fillExample('80 00 03 81 00 1F 82 00 1F 83 10 20 04 00 28 86 05 A0 8B 05 A0 8C 05 A0 8E 00 03 91 00 3F 14 1E 5A 97 00 03 9A 00 03 9B 00 03 9C 00 64 9D 00 3F 9E 00 03 9F 00 0F 21 E9 28 A8 FF FF 29 00 59 AF 52 58 B0 03 20 B9 00 03 3A 00 03 3B 00 08 BD 00 03 C0 00 7E C1 00 03 43 00 03 C4 00 04 C5 00 03 46 00 FF 47 05 A0 86')">ç¯„ä¾‹4: æœå‹™åˆ—è¡¨å›æ‡‰ ğŸ“‹</div>
            </div>

            <div class="form-group">
                <label for="packetInput">
                    å°åŒ…å…§å®¹ (Hex)
                    <span class="label-info">- æ”¯æ´å¤šç¨®æ ¼å¼</span>
                </label>
                <textarea id="packetInput" placeholder="è¼¸å…¥åå…­é€²ä½å°åŒ…ï¼Œä¾‹å¦‚: 06 00 08 FF FF 0E"></textarea>
            </div>

            <button class="btn" onclick="parsePacket()">ğŸ” è§£æå°åŒ…</button>
            
            <div id="parseResult" class="result-box" style="display: none;"></div>
        </div>

        <!-- ä¸²å£é€šè¨Šé é¢ -->
        <div id="serial" class="tab-content">
            <h2>ğŸ”Œ USB ä¸²å£é€šè¨Š</h2>
            
            <div class="help-text">
                ğŸ’¡ <strong>æç¤ºï¼š</strong>ä½¿ç”¨ USB TTL è½‰æ¥å™¨é€£æ¥ TaiSEIA è¨­å‚™ï¼Œç›´æ¥é€²è¡Œé€šè¨Šæ¸¬è©¦
                <br><strong>âš ï¸ æ³¨æ„ï¼š</strong>æ­¤åŠŸèƒ½éœ€è¦ä½¿ç”¨ Chromeã€Edge æˆ– Opera ç€è¦½å™¨ï¼Œä¸”å¿…é ˆæ˜¯ HTTPS æˆ– localhost
            </div>

            <div class="warning">
                âš ï¸ <strong>ç¡¬é«”é€£æ¥è­¦å‘Šï¼š</strong><br>
                â€¢ TaiSEIA è¨­å‚™ä½¿ç”¨ <strong>5V é‚è¼¯é›»å¹³</strong><br>
                â€¢ ESP32/Arduino ä½¿ç”¨ <strong>3.3V é‚è¼¯é›»å¹³</strong><br>
                â€¢ <strong>å¿…é ˆä½¿ç”¨ Level Shifter (é›»å¹³è½‰æ›å™¨)</strong> é€²è¡Œè½‰æ›ï¼<br>
                â€¢ ç›´æ¥é€£æ¥å¯èƒ½æœƒæå£è¨­å‚™æˆ– USB TTL æ¨¡çµ„ï¼
            </div>

            <!-- é€£æ¥ç‹€æ…‹ -->
            <div class="form-group">
                <label>é€£æ¥ç‹€æ…‹</label>
                <div id="serialStatus" style="padding: 15px; background: #f8f9fa; border-radius: 8px; font-weight: bold;">
                    ğŸ”´ æœªé€£æ¥
                </div>
            </div>

            <!-- ä¸²å£è¨­å®š -->
            <div class="grid-2">
                <div class="form-group">
                    <label for="baudRate">æ³¢ç‰¹ç‡ (Baud Rate)</label>
                    <select id="baudRate">
                        <option value="9600" selected>9600 (TaiSEIA æ¨™æº–)</option>
                        <option value="115200">115200</option>
                        <option value="57600">57600</option>
                        <option value="38400">38400</option>
                        <option value="19200">19200</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="dataBits">æ•¸æ“šä½</label>
                    <select id="dataBits">
                        <option value="8" selected>8</option>
                        <option value="7">7</option>
                    </select>
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="stopBits">åœæ­¢ä½</label>
                    <select id="stopBits">
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="parity">æ ¡é©—ä½</label>
                    <select id="parity">
                        <option value="none" selected>None (ç„¡)</option>
                        <option value="even">Even (å¶)</option>
                        <option value="odd">Odd (å¥‡)</option>
                    </select>
                </div>
            </div>

            <!-- é€£æ¥/æ–·é–‹æŒ‰éˆ• -->
            <div class="grid-2">
                <button class="btn" onclick="connectSerial()" id="connectBtn">ğŸ”Œ é€£æ¥ä¸²å£</button>
                <button class="btn btn-secondary" onclick="disconnectSerial()" id="disconnectBtn" style="display: none;">âŒ æ–·é–‹é€£æ¥</button>
            </div>

            <!-- åˆ†éš”ç·š -->
            <div id="serialCommandSection" style="display: none;">
                <hr style="margin: 30px 0; border: none; border-top: 2px solid #dee2e6;">
                
                <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ“¤ ç™¼é€å‘½ä»¤</h3>

                <!-- å‘½ä»¤ç”¢ç”Ÿå™¨ -->
                <div class="form-group">
                    <label>
                        <input type="radio" name="serialInputMode" value="builder" checked onchange="toggleSerialInputMode()">
                        <strong>å‘½ä»¤ç”¢ç”Ÿå™¨</strong> - é€éé¸å–®å¿«é€Ÿç”¢ç”Ÿå°åŒ…
                    </label>
                    <label style="margin-left: 30px;">
                        <input type="radio" name="serialInputMode" value="manual" onchange="toggleSerialInputMode()">
                        <strong>æ‰‹å‹•è¼¸å…¥</strong> - ç›´æ¥è¼¸å…¥åå…­é€²ä½å°åŒ…
                    </label>
                </div>

                <!-- å‘½ä»¤ç”¢ç”Ÿå™¨ä»‹é¢ -->
                <div id="serialCommandBuilder">
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="serialDeviceType">
                                è¨­å‚™é¡å‹ (SA_ID)
                                <span class="label-info">- è¨­å‚™åœ°å€è­˜åˆ¥ç¢¼</span>
                            </label>
                            <select id="serialDeviceType" onchange="updateSerialServiceOptions()">
                                <option value="0x00">0x00 - å»£æ’­ (æ‰€æœ‰è¨­å‚™)</option>
                                <option value="0x01" selected>0x01 - ç©ºèª¿ (Air Conditioner)</option>
                                <option value="0x03">0x03 - æ´—è¡£æ©Ÿ (Washing Machine)</option>
                                <option value="0x04">0x04 - é™¤æ¿•æ©Ÿ (Dehumidifier)</option>
                                <option value="0x08">0x08 - ç©ºæ°£æ¸…æ·¨æ©Ÿ (Air Purifier)</option>
                                <option value="0x0E">0x0E - å…¨ç†±äº¤æ›å™¨ (ERV)</option>
                                <option value="0x0F">0x0F - é›»é¢¨æ‰‡ (Electric Fan)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="serialCommandType">
                                å‘½ä»¤é¡å‹
                                <span class="label-info">- è®€å–æˆ–å¯«å…¥</span>
                            </label>
                            <select id="serialCommandType">
                                <option value="write" selected>å¯«å…¥ (Write) - è¨­å®šåƒæ•¸</option>
                                <option value="read">è®€å– (Read) - æŸ¥è©¢ç‹€æ…‹</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="serialServiceId">
                            æœå‹™ ID (Service ID)
                            <span class="label-info">- é¸æ“‡è¦æ§åˆ¶çš„åŠŸèƒ½</span>
                        </label>
                        <select id="serialServiceId" onchange="updateSerialValueHelp()">
                            <!-- å‹•æ…‹ç”¢ç”Ÿ -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="serialDataValue">
                            æ•¸æ“šå€¼ (Data Value)
                            <span class="label-info">- é¸æ“‡æ•¸å€¼æˆ–è‡ªè¨‚</span>
                        </label>
                        <select id="serialDataValue" onchange="handleSerialDataValueChange()">
                            <!-- å‹•æ…‹ç”¢ç”Ÿ -->
                        </select>
                        <div id="serialCustomValueInput" style="display: none; margin-top: 10px;">
                            <label for="serialCustomValue">
                                è‡ªè¨‚æ•¸å€¼
                                <span class="label-info">- åé€²ä½æˆ–åå…­é€²ä½ (0xé–‹é ­)</span>
                            </label>
                            <input type="text" id="serialCustomValue" placeholder="ä¾‹å¦‚: 25 æˆ– 0x19">
                        </div>
                        <div id="serialValueHelp" class="help-text" style="margin-top: 10px; display: none;"></div>
                    </div>

                    <button class="btn" onclick="sendSerialCommand()">ğŸ“¤ ç”¢ç”Ÿä¸¦ç™¼é€å°åŒ…</button>
                </div>

                <!-- æ‰‹å‹•è¼¸å…¥ä»‹é¢ -->
                <div id="serialManualInput" style="display: none;">
                    <div class="form-group">
                        <label for="serialSendData">
                            ç™¼é€å°åŒ… (Hex)
                            <span class="label-info">- å¯ä½¿ç”¨ç©ºæ ¼ã€å†’è™Ÿåˆ†éš”</span>
                        </label>
                        <div style="display: flex; gap: 10px;">
                            <textarea id="serialSendData" placeholder="ä¾‹å¦‚: 06 00 08 FF FF 0E (å»£æ’­æŸ¥è©¢)" style="flex: 1; min-height: 60px;"></textarea>
                            <button class="btn" onclick="sendSerialData()" style="width: 150px;">ğŸ“¤ ç™¼é€</button>
                        </div>
                    </div>
                </div>

                <!-- å¿«é€Ÿå‘½ä»¤ -->
                <div class="form-group" style="margin-top: 30px;">
                    <label>å¿«é€Ÿå‘½ä»¤</label>
                    <div class="quick-links">
                        <div class="quick-link" onclick="sendQuickCommand('06:00:00:FF:FF:FB', 'å»£æ’­æŸ¥è©¢')">ğŸ“¡ å»£æ’­æŸ¥è©¢</div>
                        <div class="quick-link" onclick="sendQuickCommand('06:01:00:FF:FF:FA', 'æŸ¥è©¢ç©ºèª¿ç‹€æ…‹')">â„ï¸ æŸ¥è©¢ç©ºèª¿</div>
                        <div class="quick-link" onclick="sendQuickCommand('06:01:80:00:01:87', 'é–‹å•Ÿç©ºèª¿')">âœ… é–‹å•Ÿç©ºèª¿</div>
                        <div class="quick-link" onclick="sendQuickCommand('06:01:80:00:00:86', 'é—œé–‰ç©ºèª¿')">â­• é—œé–‰ç©ºèª¿</div>
                        <div class="quick-link" onclick="sendQuickCommand('06:01:83:00:19:9D', 'è¨­å®š25Â°C')">ğŸŒ¡ï¸ è¨­å®š25Â°C</div>
                        <div class="quick-link" onclick="sendQuickCommand('06:04:00:FF:FF:FF', 'æŸ¥è©¢é™¤æ¿•æ©Ÿ')">ğŸ’§ æŸ¥è©¢é™¤æ¿•æ©Ÿ</div>
                    </div>
                </div>

                <!-- è‡ªå‹•è§£æé–‹é—œ -->
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="autoParseResponse" checked>
                        è‡ªå‹•è§£ææ¥æ”¶çš„å°åŒ…
                    </label>
                </div>

                <!-- æ¨¡æ“¬ç©ºèª¿è¨­å‚™ -->
                <hr style="margin: 30px 0; border: none; border-top: 2px solid #dee2e6;">
                
                <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ  æ¨¡æ“¬ç©ºèª¿è¨­å‚™</h3>
                
                <div class="help-text">
                    ğŸ’¡ <strong>æç¤ºï¼š</strong>æ¨¡æ“¬ç©ºèª¿è¨­å‚™ï¼Œå‘æ§åˆ¶å™¨ç™¼é€å»£æ’­å›æ‡‰å°åŒ…ï¼ˆé•·å°åŒ…ï¼‰ï¼Œæ¸¬è©¦æ§åˆ¶å™¨çš„æ¥æ”¶å’Œè§£æåŠŸèƒ½
                </div>

                <!-- å°åŒ…é•·åº¦èªªæ˜ -->
                <details style="margin: 15px 0; border: 1px solid #dee2e6; border-radius: 8px; padding: 10px;">
                    <summary style="cursor: pointer; color: #667eea; font-weight: 600;">ğŸ“Š å°åŒ…é•·åº¦è¨ˆç®—èˆ‡é©—è­‰</summary>
                    <div style="margin-top: 15px;">
                        <div style="margin-bottom: 15px; padding: 10px; background: #e7f3ff; border-radius: 5px;">
                            <strong>ğŸ’¡ æ ¸å¿ƒå…¬å¼:</strong><br>
                            <code style="background: white; padding: 5px; border-radius: 3px; display: inline-block; margin-top: 5px;">
                                æœå‹™æ•¸é‡ = (å°åŒ…é•·åº¦ - 4) Ã· 3
                            </code><br>
                            <div style="margin-top: 5px; font-size: 0.9em;">
                                â€¢ æ¸› 4 = é•·åº¦(1) + SA_ID(1) + å‘½ä»¤(1) + æ ¡é©—(1)<br>
                                â€¢ é™¤ 3 = æ¯å€‹æœå‹™å  æœå‹™ID(1) + æ•¸æ“šH(1) + æ•¸æ“šL(1)
                            </div>
                        </div>
                        
                        <table class="info-table" style="font-size: 0.9em;">
                            <tr>
                                <th>å°åŒ…é•·åº¦</th>
                                <th>è¨ˆç®—å¼</th>
                                <th>æœå‹™æ•¸</th>
                                <th>èªªæ˜</th>
                            </tr>
                            <tr>
                                <td>16 bytes (0x10)</td>
                                <td>(16-4)Ã·3</td>
                                <td>4 å€‹</td>
                                <td>æœ€å°æ¸¬è©¦</td>
                            </tr>
                            <tr>
                                <td>28 bytes (0x1C)</td>
                                <td>(28-4)Ã·3</td>
                                <td>8 å€‹</td>
                                <td>åŸºç¤åŠŸèƒ½</td>
                            </tr>
                            <tr>
                                <td>58 bytes (0x3A)</td>
                                <td>(58-4)Ã·3</td>
                                <td>18 å€‹</td>
                                <td>ç²¾ç°¡ç‰ˆ â­</td>
                            </tr>
                            <tr>
                                <td>70 bytes (0x46)</td>
                                <td>(70-4)Ã·3</td>
                                <td>22 å€‹</td>
                                <td>æ¨™æº–ç‰ˆ â­</td>
                            </tr>
                            <tr>
                                <td>76 bytes (0x4C)</td>
                                <td>(76-4)Ã·3</td>
                                <td>24 å€‹</td>
                                <td>é€²éšç‰ˆ â­</td>
                            </tr>
                            <tr style="background: #fff3cd;">
                                <td>85 bytes (0x55)</td>
                                <td>(85-4)Ã·3</td>
                                <td>27 å€‹</td>
                                <td>å®Œæ•´ç‰ˆ (æ¨è–¦) â­â­</td>
                            </tr>
                            <tr>
                                <td>106 bytes (0x6A)</td>
                                <td>(106-4)Ã·3</td>
                                <td>34 å€‹</td>
                                <td>å¾…æ©Ÿç‰ˆ â­</td>
                            </tr>
                            <tr>
                                <td>154 bytes (0x9A)</td>
                                <td>(154-4)Ã·3</td>
                                <td>50 å€‹</td>
                                <td>å£“åŠ›æ¸¬è©¦</td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 0.85em;">
                            <strong>âœ… æœ‰æ•ˆé•·åº¦é©—è­‰è¦å‰‡:</strong><br>
                            1. <strong>æœ€å°é•·åº¦</strong>: è‡³å°‘ 4 bytes (é ­éƒ¨ + æ ¡é©—)<br>
                            2. <strong>å°é½Šè¦æ±‚</strong>: (é•·åº¦ - 4) å¿…é ˆèƒ½è¢« 3 æ•´é™¤<br>
                            3. <strong>æœ€å¤§é•·åº¦</strong>: ä¸è¶…é 255 bytes (å–®å­—ç¯€é™åˆ¶)<br>
                            <br>
                            <strong>âŒ ç„¡æ•ˆé•·åº¦ç¤ºä¾‹:</strong><br>
                            â€¢ 5 bytes â†’ (5-4)Ã·3 = 0.33... âŒ ä¸èƒ½æ•´é™¤<br>
                            â€¢ 6 bytes â†’ (6-4)Ã·3 = 0.67... âŒ ä¸èƒ½æ•´é™¤<br>
                            â€¢ 7 bytes â†’ (7-4)Ã·3 = 1 âœ… å¯ä»¥ (1å€‹æœå‹™)<br>
                            <br>
                            <strong>ğŸ’¡ å¿«é€Ÿåˆ¤æ–·:</strong><br>
                            æœ‰æ•ˆé•·åº¦ = 4, 7, 10, 13, 16, 19, 22, 25, 28, 31, 34, 37, 40, ...<br>
                            è¦å¾‹: å¾ 4 é–‹å§‹ï¼Œæ¯æ¬¡ +3
                        </div>
                        
                        <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px; font-size: 0.85em; border-left: 4px solid #ffc107;">
                            <strong>ğŸ” æ ¡é©—ä½è¨ˆç®—å…¬å¼ (XOR):</strong><br>
                            <code style="background: white; padding: 5px; border-radius: 3px; display: inline-block; margin-top: 5px;">
                                æ ¡é©—ç¢¼ = å­—ç¯€[0] XOR å­—ç¯€[1] XOR å­—ç¯€[2] XOR ... XOR å­—ç¯€[N-2]
                            </code><br>
                            <div style="margin-top: 10px;">
                                <strong>èªªæ˜ï¼š</strong><br>
                                â€¢ å°é™¤äº†æœ€å¾Œä¸€å€‹å­—ç¯€ï¼ˆæ ¡é©—ç¢¼æœ¬èº«ï¼‰ä¹‹å¤–çš„æ‰€æœ‰å­—ç¯€é€²è¡Œ XOR é‹ç®—<br>
                                â€¢ XOR (ç•°æˆ–) é‹ç®—è¦å‰‡: 0âŠ•0=0, 0âŠ•1=1, 1âŠ•0=1, 1âŠ•1=0<br>
                                â€¢ è¨ˆç®—ç¯„åœ: å¾ç¬¬ 1 å€‹å­—ç¯€åˆ°å€’æ•¸ç¬¬ 2 å€‹å­—ç¯€
                            </div>
                            <div style="margin-top: 10px;">
                                <strong>ğŸ“ è¨ˆç®—ç¤ºä¾‹ (85 bytes å°åŒ…):</strong><br>
                                <code style="background: white; padding: 3px; border-radius: 3px; font-size: 0.85em;">
                                55:00:08:00:00:01:01:00:00:02:00:04:03:00:1A:... (çœç•¥ä¸­é–“) ...:3D:00:00:??
                                </code><br>
                                <div style="margin-top: 5px; font-size: 0.9em;">
                                    è¨ˆç®—: 0x55 âŠ• 0x00 âŠ• 0x08 âŠ• 0x00 âŠ• 0x00 âŠ• 0x01 âŠ• ... âŠ• 0x00 = <strong style="color: #d97706;">0xFD</strong><br>
                                    æœ€å¾Œä¸€å€‹å­—ç¯€å¡«å…¥: <strong style="color: #d97706;">0xFD</strong>
                                </div>
                            </div>
                            <div style="margin-top: 10px;">
                                <strong>ğŸ’» ç¨‹å¼ç¢¼å¯¦ç¾:</strong><br>
                                <code style="background: white; padding: 5px; border-radius: 3px; display: block; margin-top: 5px; white-space: pre; font-size: 0.85em;">uint8_t checksum = 0;
for (int i = 0; i < length - 1; i++) {
    checksum ^= data[i];
}
// checksum å³ç‚ºæ ¡é©—ç¢¼</code>
                            </div>
                        </div>
                    </div>
                </details>

                <!-- å¿«é€Ÿé è¨­ -->
                <div class="form-group">
                    <label>å¿«é€Ÿé è¨­æƒ…å¢ƒ</label>
                    <div class="quick-links">
                        <div class="quick-link" onclick="loadDevicePreset('off')">â­• é—œæ©Ÿå¾…æ©Ÿ</div>
                        <div class="quick-link" onclick="loadDevicePreset('cooling')">â„ï¸ å†·æ°£é‹è½‰</div>
                        <div class="quick-link" onclick="loadDevicePreset('heating')">ğŸ”¥ æš–æ°£é‹è½‰</div>
                        <div class="quick-link" onclick="loadDevicePreset('hot_day')">ğŸŒ ç‚ç†±å¤©æ°£</div>
                        <div class="quick-link" onclick="loadDevicePreset('cold_day')">ğŸ§Š å¯’å†·å¤©æ°£</div>
                    </div>
                </div>

                <!-- è¨­å‚™ç‹€æ…‹é…ç½® -->
                <div class="grid-2">
                    <div class="form-group">
                        <label for="simPower">é›»æºç‹€æ…‹</label>
                        <select id="simPower">
                            <option value="0">â­• é—œæ©Ÿ OFF</option>
                            <option value="1" selected>âœ… é–‹æ©Ÿ ON</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="simMode">é‹è½‰æ¨¡å¼</label>
                        <select id="simMode">
                            <option value="0" selected>COOL å†·æ°£</option>
                            <option value="1">DRY é™¤æ¿•</option>
                            <option value="2">FAN é€é¢¨</option>
                            <option value="3">AUTO è‡ªå‹•</option>
                            <option value="4">HEAT æš–æ°£</option>
                        </select>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label for="simFan">é¢¨é€Ÿ</label>
                        <select id="simFan">
                            <option value="0" selected>AUTO è‡ªå‹•</option>
                            <option value="1">QUIET éœéŸ³</option>
                            <option value="2">LOW ä½é€Ÿ</option>
                            <option value="3">MEDIUM ä¸­é€Ÿ</option>
                            <option value="4">HIGH é«˜é€Ÿ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="simTargetTemp">ç›®æ¨™æº«åº¦ (Â°C)</label>
                        <input type="number" id="simTargetTemp" value="24" min="16" max="32">
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label for="simIndoorTemp">å®¤å…§æº«åº¦ (Â°C)</label>
                        <input type="number" id="simIndoorTemp" value="26" min="0" max="50">
                    </div>

                    <div class="form-group">
                        <label for="simOutdoorTemp">å®¤å¤–æº«åº¦ (Â°C)</label>
                        <input type="number" id="simOutdoorTemp" value="30" min="-20" max="50">
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label for="simHumidity">å®¤å…§æ¿•åº¦ (%)</label>
                        <input type="number" id="simHumidity" value="60" min="0" max="100">
                    </div>

                    <div class="form-group">
                        <label for="simSwing">å‚ç›´æ“ºé¢¨</label>
                        <select id="simSwing">
                            <option value="0">é—œé–‰</option>
                            <option value="1" selected>é–‹å•Ÿ</option>
                        </select>
                    </div>
                </div>

                <!-- é«˜ç´šé¸é … -->
                <details style="margin: 20px 0;">
                    <summary style="cursor: pointer; color: #667eea; font-weight: 600; margin-bottom: 15px;">â–¶ é«˜ç´šé¸é …</summary>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="simRuntime">é‹è½‰æ™‚æ•¸ (å°æ™‚)</label>
                            <input type="number" id="simRuntime" value="1000" min="0" max="99999">
                        </div>

                        <div class="form-group">
                            <label for="simFilter">æ¿¾ç¶²æ™‚æ•¸ (å°æ™‚)</label>
                            <input type="number" id="simFilter" value="300" min="0" max="9999">
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="form-group">
                            <label for="simEnergy">èƒ½æºæ¶ˆè€— (kWh)</label>
                            <input type="number" id="simEnergy" value="100" min="0" max="99999">
                        </div>

                        <div class="form-group">
                            <label for="simPacketBytes">å°åŒ…é•·åº¦ (bytes)</label>
                            <input type="number" id="simPacketBytes" min="16" max="255" step="1" value="85" 
                                   onchange="updatePacketBytesInfo()" oninput="updatePacketBytesInfo()"
                                   style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <div id="packetBytesInfo" style="margin-top: 5px; font-size: 0.85em;"></div>
                            
                            <!-- å¸¸ç”¨å»ºè­°æŒ‰éˆ• -->
                            <div style="margin-top: 10px;">
                                <div style="font-size: 0.85em; color: #6c757d; margin-bottom: 5px;">ğŸ’¡ å¸¸ç”¨é•·åº¦å¿«é€Ÿé¸æ“‡:</div>
                                <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                    <button type="button" onclick="setPacketBytes(16)" class="quick-btn" title="4å€‹æœå‹™">16</button>
                                    <button type="button" onclick="setPacketBytes(28)" class="quick-btn" title="8å€‹æœå‹™">28</button>
                                    <button type="button" onclick="setPacketBytes(58)" class="quick-btn" title="18å€‹æœå‹™ - ç²¾ç°¡ç‰ˆ">58 â­</button>
                                    <button type="button" onclick="setPacketBytes(70)" class="quick-btn" title="22å€‹æœå‹™ - æ¨™æº–ç‰ˆ">70 â­</button>
                                    <button type="button" onclick="setPacketBytes(76)" class="quick-btn" title="24å€‹æœå‹™ - é€²éšç‰ˆ">76 â­</button>
                                    <button type="button" onclick="setPacketBytes(85)" class="quick-btn" title="27å€‹æœå‹™ - å®Œæ•´ç‰ˆ">85 â­â­</button>
                                    <button type="button" onclick="setPacketBytes(106)" class="quick-btn" title="34å€‹æœå‹™ - å¾…æ©Ÿç‰ˆ">106 â­</button>
                                    <button type="button" onclick="setPacketBytes(154)" class="quick-btn" title="50å€‹æœå‹™ - å£“åŠ›æ¸¬è©¦">154</button>
                                </div>
                            </div>
                        </div>
                        
                        <style>
                            .quick-btn {
                                padding: 5px 10px;
                                border: 1px solid #667eea;
                                background: white;
                                color: #667eea;
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 0.85em;
                                transition: all 0.2s;
                            }
                            .quick-btn:hover {
                                background: #667eea;
                                color: white;
                            }
                            .quick-btn:active {
                                transform: scale(0.95);
                            }
                        </style>
                    </div>
                </details>

                <!-- ç”Ÿæˆä¸¦ç™¼é€ -->
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn" onclick="generateBroadcastResponse()" style="flex: 1;">
                        ğŸ¯ ç”Ÿæˆå»£æ’­å›æ‡‰å°åŒ…
                    </button>
                    <button class="btn" onclick="sendBroadcastResponse()" style="flex: 1;">
                        ğŸ“¤ ç™¼é€å»£æ’­å›æ‡‰å°åŒ…
                    </button>
                </div>

                <!-- ç”Ÿæˆçš„å°åŒ…é è¦½ -->
                <div id="generatedBroadcast" style="display: none; margin-top: 20px; padding: 15px; background: #f0f7ff; border-radius: 8px; border-left: 4px solid #667eea;">
                    <div style="font-weight: bold; margin-bottom: 10px; color: #667eea;">ğŸ“¦ ç”Ÿæˆçš„å°åŒ…ï¼š</div>
                    <div id="generatedBroadcastData" style="font-family: 'Courier New', monospace; background: white; padding: 10px; border-radius: 4px; word-break: break-all;"></div>
                    <div id="generatedBroadcastInfo" style="margin-top: 10px; font-size: 0.9em; color: #6c757d;"></div>
                </div>
            </div>

            <!-- ä¸²å£ç›£è¦–å™¨ -->
            <div id="serialMonitorGroup" style="display: none;">
                <hr style="margin: 30px 0; border: none; border-top: 2px solid #dee2e6;">
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label style="margin: 0;"><strong>ğŸ“¡ ä¸²å£ç›£è¦–å™¨</strong></label>
                    <div style="display: flex; gap: 10px;">
                        <button id="pauseMonitorBtn" class="copy-btn" onclick="toggleSerialMonitorPause()" style="min-width: 80px;">â¸ï¸ æš«åœ</button>
                        <button class="copy-btn" onclick="clearSerialMonitor()">ğŸ—‘ï¸ æ¸…ç©º</button>
                    </div>
                </div>
                <div id="serialMonitor" style="
                    background: #2d3748;
                    color: #68d391;
                    padding: 15px;
                    border-radius: 8px;
                    font-family: 'Courier New', monospace;
                    font-size: 0.9em;
                    max-height: 400px;
                    overflow-y: auto;
                    white-space: pre-wrap;
                    word-break: break-all;
                ">ç­‰å¾…æ•¸æ“š...</div>
            </div>

            <!-- æ¥æ”¶è§£æçµæœ -->
            <div id="serialParseResult" class="result-box" style="display: none;"></div>
        </div>

        <!-- å»£æ’­å°åŒ…æ¯”å°é é¢ -->
        <div id="compare" class="tab-content">
            <h2>âš–ï¸ å»£æ’­å°åŒ…æ¯”å°</h2>
            
            <div class="help-text">
                ğŸ’¡ <strong>æç¤ºï¼š</strong>æ¯”å°å…©å€‹å»£æ’­å°åŒ…çš„å·®ç•°ï¼Œé€šå¸¸ç”¨æ–¼æ¯”å°é–‹æ©Ÿå‰å¾Œã€è¨­å®šå‰å¾Œçš„ç‹€æ…‹è®ŠåŒ–
            </div>

            <div class="example-box">
                <strong>ğŸ“‹ ä½¿ç”¨æƒ…å¢ƒï¼š</strong><br>
                â€¢ æ¯”å°é–‹æ©Ÿå‰å¾Œçš„å»£æ’­å°åŒ…ï¼Œäº†è§£å“ªäº›åƒæ•¸æ”¹è®Šäº†<br>
                â€¢ æ¯”å°è¨­å®šæº«åº¦å‰å¾Œçš„å»£æ’­å°åŒ…ï¼Œç¢ºèªè¨­å®šæ˜¯å¦ç”Ÿæ•ˆ<br>
                â€¢ æ¯”å°ä¸åŒè¨­å‚™çš„å»£æ’­å°åŒ…ï¼Œäº†è§£åŠŸèƒ½å·®ç•°
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="broadcastPacket1">
                        å»£æ’­å°åŒ… 1 (ä¹‹å‰/è¨­å®šå‰)
                        <span class="label-info">- ç™¼é€ 06:00:08:FF:FF:0E å¾Œæ”¶åˆ°çš„é•·å°åŒ…</span>
                    </label>
                    <textarea id="broadcastPacket1" placeholder="è¼¸å…¥ç¬¬ä¸€å€‹å»£æ’­å°åŒ…ï¼Œä¾‹å¦‚ï¼š55:00:08:00:00:01:01:00:00:02:00:00:03:00:14..." style="min-height: 120px; font-family: 'Courier New', monospace;"></textarea>
                </div>

                <div class="form-group">
                    <label for="broadcastPacket2">
                        å»£æ’­å°åŒ… 2 (ä¹‹å¾Œ/è¨­å®šå¾Œ)
                        <span class="label-info">- ç™¼é€ 06:00:08:FF:FF:0E å¾Œæ”¶åˆ°çš„é•·å°åŒ…</span>
                    </label>
                    <textarea id="broadcastPacket2" placeholder="è¼¸å…¥ç¬¬äºŒå€‹å»£æ’­å°åŒ…ï¼Œä¾‹å¦‚ï¼š55:00:08:00:00:01:01:00:04:02:00:00:03:00:19..." style="min-height: 120px; font-family: 'Courier New', monospace;"></textarea>
                </div>
            </div>

            <div class="form-group">
                <label for="compareDeviceType">
                    è¨­å‚™é¡å‹ (ç”¨æ–¼è§£ææœå‹™åç¨±)
                    <span class="label-info">- é¸æ“‡å°åŒ…å°æ‡‰çš„è¨­å‚™</span>
                </label>
                <select id="compareDeviceType">
                    <option value="0x01" selected>0x01 - ç©ºèª¿ (Air Conditioner)</option>
                    <option value="0x03">0x03 - æ´—è¡£æ©Ÿ (Washing Machine)</option>
                    <option value="0x04">0x04 - é™¤æ¿•æ©Ÿ (Dehumidifier)</option>
                    <option value="0x08">0x08 - ç©ºæ°£æ¸…æ·¨æ©Ÿ (Air Purifier)</option>
                    <option value="0x0E">0x0E - å…¨ç†±äº¤æ›å™¨ (ERV)</option>
                    <option value="0x0F">0x0F - é›»é¢¨æ‰‡ (Electric Fan)</option>
                </select>
            </div>

            <button class="btn" onclick="compareBroadcastPackets()">âš–ï¸ é–‹å§‹æ¯”å°</button>
            
            <div id="compareResult" class="result-box" style="display: none;"></div>
        </div>

        <!-- æ‰¹æ¬¡è™•ç†é é¢ -->
        <div id="batch" class="tab-content">
            <h2>æ‰¹æ¬¡è™•ç†å°åŒ…</h2>
            
            <div class="help-text">
                ğŸ’¡ <strong>æç¤ºï¼š</strong>æ¯è¡Œä¸€å€‹å°åŒ…ï¼Œå¯æ‰¹æ¬¡é©—è­‰æˆ–è§£æå¤šå€‹å°åŒ…
            </div>

            <div class="form-group">
                <label for="batchInput">
                    æ‰¹æ¬¡å°åŒ…è¼¸å…¥
                    <span class="label-info">- æ¯è¡Œä¸€å€‹å°åŒ…</span>
                </label>
                <textarea id="batchInput" style="min-height: 200px;" placeholder="æ¯è¡Œè¼¸å…¥ä¸€å€‹å°åŒ…ï¼Œä¾‹å¦‚ï¼š
06 01 00 FF FF FA
06 01 80 00 01 87
06 01 83 00 19 9D"></textarea>
            </div>

            <div class="grid-2">
                <button class="btn" onclick="batchProcess('verify')">âœ“ æ‰¹æ¬¡é©—è­‰æ ¡é©—ç¢¼</button>
                <button class="btn" onclick="batchProcess('parse')">ğŸ“Š æ‰¹æ¬¡è§£æ</button>
            </div>

            <div id="batchResult" class="result-box" style="display: none;"></div>
        </div>

        <!-- æœå‹™åˆ—è¡¨é é¢ -->
        <div id="services" class="tab-content">
            <h2>TaiSEIA æœå‹™åˆ—è¡¨</h2>
            
            <div class="form-group">
                <label for="serviceDeviceType">
                    <strong>è¨­å‚™é¡å‹</strong>
                    <span class="label-info">- é¸æ“‡è¦æŸ¥çœ‹çš„è¨­å‚™</span>
                </label>
                <select id="serviceDeviceType" onchange="displayServices()">
                    <option value="0x01">ğŸŒ¡ï¸ ç©ºèª¿ (SA_ID: 0x01)</option>
                    <option value="0x04">ğŸ’§ é™¤æ¿•æ©Ÿ (SA_ID: 0x04)</option>
                    <option value="0x08">ğŸŒ¬ï¸ ç©ºæ°£æ¸…æ·¨æ©Ÿ (SA_ID: 0x08)</option>
                    <option value="0x0E">â™»ï¸ ERV å…¨ç†±äº¤æ›å™¨ (SA_ID: 0x0E)</option>
                    <option value="0x0F">ğŸŒ€ é›»é¢¨æ‰‡ (SA_ID: 0x0F)</option>
                </select>
            </div>
            
            <div class="search-box">
                <input type="text" id="searchService" placeholder="ğŸ” æœå°‹æœå‹™åç¨±æˆ– ID..." oninput="searchServices()">
            </div>

            <div id="serviceList" class="service-list"></div>
        </div>

        <!-- ä½¿ç”¨èªªæ˜é é¢ -->
        <div id="help" class="tab-content">
            <h2>ğŸ“– ä½¿ç”¨èªªæ˜</h2>
            
            <h3>ğŸ”¹ å°åŒ…æ ¼å¼</h3>
            <div class="help-text">
                <p><strong>æ¨™æº–å°åŒ…ï¼ˆ6 å­—ç¯€ï¼‰ï¼š</strong></p>
                <pre style="background: #2d3748; color: #68d391; padding: 15px; border-radius: 5px; overflow-x: auto;">
[é•·åº¦] [SA_ID] [æœå‹™ID] [æ•¸æ“šé«˜ä½] [æ•¸æ“šä½ä½] [æ ¡é©—å’Œ]
  0x06    0x00     0x08      0xFF        0xFF      0x0E
   â†‘       â†‘        â†‘         â†‘           â†‘          â†‘
  6å­—ç¯€   å»£æ’­   è®€å–ç‹€æ…‹    æŸ¥è©¢        æŸ¥è©¢      æ ¡é©—ç¢¼

<strong>ğŸ“¡ æœ€å¸¸è¦‹ç¯„ä¾‹ï¼šå»£æ’­æŸ¥è©¢ (06:00:08:FF:FF:0E)</strong>
ç™¼é€æ­¤å‘½ä»¤å¾Œï¼Œæ‰€æœ‰è¨­å‚™æœƒå›æ‡‰å®Œæ•´ç‹€æ…‹çš„é•·å°åŒ…

ä½å…ƒçµ„ 0: å°åŒ…é•·åº¦ (é€šå¸¸ç‚º 0x06)
ä½å…ƒçµ„ 1: è¨­å‚™ ID (SA_ID) - 0x00=å»£æ’­, 0x01=ç©ºèª¿, 0x04=é™¤æ¿•æ©Ÿ...
ä½å…ƒçµ„ 2: æœå‹™ ID (è®€å–æ™‚åŸå€¼ï¼Œå¯«å…¥æ™‚ OR 0x80)
ä½å…ƒçµ„ 3-4: 16ä½æ•¸æ“š (å¤§ç«¯åº) - 0xFFFF=æŸ¥è©¢
ä½å…ƒçµ„ 5: XOR æ ¡é©—å’Œ (å‰5å€‹ä½å…ƒçµ„çš„ XOR é‹ç®—)
                </pre>
            </div>

            <h3>ğŸ”¹ è¨­å‚™é¡å‹ (SA_ID)</h3>
            <table class="info-table">
                <tr>
                    <th>SA_ID</th>
                    <th>è¨­å‚™é¡å‹</th>
                    <th>èªªæ˜</th>
                </tr>
                <tr>
                    <td><code>0x00</code></td>
                    <td>å»£æ’­</td>
                    <td>ç™¼é€çµ¦æ‰€æœ‰è¨­å‚™</td>
                </tr>
                <tr>
                    <td><code>0x01</code></td>
                    <td>ç©ºèª¿</td>
                    <td>Air Conditioner / Climate</td>
                </tr>
                <tr>
                    <td><code>0x03</code></td>
                    <td>æ´—è¡£æ©Ÿ</td>
                    <td>Washing Machine</td>
                </tr>
                <tr>
                    <td><code>0x04</code></td>
                    <td>é™¤æ¿•æ©Ÿ</td>
                    <td>Dehumidifier</td>
                </tr>
                <tr>
                    <td><code>0x08</code></td>
                    <td>ç©ºæ°£æ¸…æ·¨æ©Ÿ</td>
                    <td>Air Purifier</td>
                </tr>
                <tr>
                    <td><code>0x0E</code></td>
                    <td>å…¨ç†±äº¤æ›å™¨</td>
                    <td>ERV (Energy Recovery Ventilator)</td>
                </tr>
                <tr>
                    <td><code>0x0F</code></td>
                    <td>é›»é¢¨æ‰‡</td>
                    <td>Electric Fan</td>
                </tr>
            </table>

            <h3>ğŸ”¹ å¸¸ç”¨æœå‹™ ID</h3>
            <div class="help-text">
                <p><strong>âš ï¸ é‡è¦æ¦‚å¿µï¼šæœå‹™ ID åœ¨ä¸åŒè¨­å‚™ä¸­æœ‰ä¸åŒæ„ç¾©</strong></p>
                <p>åŒä¸€å€‹æœå‹™ IDï¼ˆå¦‚ 0x07ï¼‰åœ¨ä¸åŒè¨­å‚™é¡å‹ä¸­ä»£è¡¨ä¸åŒçš„åŠŸèƒ½ï¼š</p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><strong>é€šç”¨æŸ¥è©¢æ™‚ï¼ˆSA_ID = 0x00ï¼‰ï¼š</strong>0x07 = Read Servicesï¼ˆè®€å–æ”¯æ´çš„æœå‹™åˆ—è¡¨ï¼‰</li>
                    <li><strong>ç©ºèª¿è¨­å‚™ï¼ˆSA_ID = 0x01ï¼‰ï¼š</strong>0x07 = Fuzzy Modeï¼ˆæ¨¡ç³Šæ¨¡å¼ï¼‰</li>
                    <li><strong>é™¤æ¿•æ©Ÿï¼ˆSA_ID = 0x04ï¼‰ï¼š</strong>0x07 = Humidity Indoorï¼ˆå®¤å…§æ¿•åº¦ï¼‰</li>
                </ul>
                <p style="margin-top: 10px;">å› æ­¤ä½¿ç”¨æ™‚å¿…é ˆæ³¨æ„ç•¶å‰æ“ä½œçš„è¨­å‚™é¡å‹ã€‚</p>
                
                <p style="margin-top: 20px;"><strong>é€šç”¨æœå‹™ï¼š</strong></p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><code>0x00</code> - Registerï¼ˆè¨»å†Šï¼‰/é›»æºç‹€æ…‹</li>
                    <li><code>0x01</code> - Read Device Typeï¼ˆè¨­å‚™é¡å‹ï¼‰</li>
                    <li><code>0x02</code> - Read Versionï¼ˆç‰ˆæœ¬è³‡è¨Šï¼‰</li>
                    <li><code>0x04</code> - Read SA ID</li>
                    <li><code>0x05</code> - Read Brandï¼ˆå“ç‰Œï¼‰</li>
                    <li><code>0x06</code> - Read Modelï¼ˆå‹è™Ÿï¼‰</li>
                    <li><code>0x07</code> - Read Servicesï¼ˆæ”¯æ´çš„æœå‹™åˆ—è¡¨ï¼‰</li>
                    <li><code>0x08</code> - Read Statusï¼ˆç‹€æ…‹æŸ¥è©¢ï¼‰</li>
                </ul>
                
                <p style="margin-top: 15px;"><strong>ç©ºèª¿å°ˆç”¨æœå‹™ï¼š</strong></p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li><code>0x00</code> - é›»æºç‹€æ…‹</li>
                    <li><code>0x01</code> - é‹è½‰æ¨¡å¼ (å†·/æš–/é™¤æ¿•/é€é¢¨)</li>
                    <li><code>0x02</code> - é¢¨é€Ÿ</li>
                    <li><code>0x03</code> - ç›®æ¨™æº«åº¦</li>
                    <li><code>0x04</code> - å®¤å…§æº«åº¦</li>
                    <li><code>0x05</code> - Sleepï¼ˆç¡çœ æ¨¡å¼ï¼‰</li>
                    <li><code>0x06</code> - Sleep Timerï¼ˆç¡çœ å®šæ™‚ï¼‰</li>
                    <li><code>0x07</code> - Fuzzy Modeï¼ˆæ¨¡ç³Šæ¨¡å¼ï¼‰</li>
                    <li><code>0x08</code> - Air Purifierï¼ˆç©ºæ°£æ¸…æ·¨ï¼‰</li>
                    <li><code>0x09</code> - On Timeï¼ˆé–‹æ©Ÿæ™‚é–“ï¼‰</li>
                    <li><code>0x0A</code> - Off Timeï¼ˆé—œæ©Ÿæ™‚é–“ï¼‰</li>
                    <li><code>0x0B</code> - On Timerï¼ˆé–‹æ©Ÿå®šæ™‚ï¼‰</li>
                    <li><code>0x0C</code> - Off Timerï¼ˆé—œæ©Ÿå®šæ™‚ï¼‰</li>
                    <li><code>0x0D</code> - System Timeï¼ˆç³»çµ±æ™‚é–“ï¼‰</li>
                    <li><code>0x0E</code> - å‚ç›´æ“ºé¢¨</li>
                    <li><code>0x0F</code> - å‚ç›´æ“ºé¢¨ä½ç½®</li>
                    <li><code>0x10</code> - æ°´å¹³æ“ºé¢¨</li>
                    <li><code>0x11</code> - æ°´å¹³æ“ºé¢¨ä½ç½®</li>
                    <li><code>0x12</code> - Filter Notifyï¼ˆæ¿¾ç¶²æç¤ºï¼‰</li>
                    <li><code>0x13</code> - ç›®æ¨™æ¿•åº¦</li>
                    <li><code>0x14</code> - å®¤å…§æ¿•åº¦</li>
                    <li><code>0x1A</code> - Boostï¼ˆå¼·åŠ›æ¨¡å¼ï¼‰</li>
                    <li><code>0x1B</code> - ECOï¼ˆç¯€èƒ½æ¨¡å¼ï¼‰</li>
                    <li><code>0x1E</code> - Beeperï¼ˆèœ‚é³´å™¨ï¼‰</li>
                    <li><code>0x20</code> - Moisturizeï¼ˆä¿æ¿•ï¼‰</li>
                    <li><code>0x21</code> - å®¤å¤–æº«åº¦</li>
                </ul>
            </div>

            <h3>ğŸ”¹ XOR æ ¡é©—ç¢¼è¨ˆç®—</h3>
            <div class="help-text">
                <p><strong>ç®—æ³•ï¼š</strong>å°‡å‰ 5 å€‹ä½å…ƒçµ„é€²è¡Œ XOR é‹ç®—</p>
                <pre style="background: #2d3748; color: #68d391; padding: 15px; border-radius: 5px;">
ç¯„ä¾‹ï¼šå°åŒ… [06 01 00 FF FF ??]

è¨ˆç®—ï¼š
0x06 XOR 0x01 = 0x07
0x07 XOR 0x00 = 0x07
0x07 XOR 0xFF = 0xF8
0xF8 XOR 0xFF = 0x07

éŒ¯èª¤ï¼æ‡‰è©²æ˜¯ï¼š
checksum = 0x06 ^ 0x01 ^ 0x00 ^ 0xFF ^ 0xFF = 0xFA

å®Œæ•´å°åŒ…ï¼š[06 01 00 FF FF FA]
                </pre>
            </div>

            <h3>ğŸ”¹ å¸¸è¦‹å•é¡Œ</h3>
            <div class="help-text">
                <p><strong>Q: è®€å–å’Œå¯«å…¥æœ‰ä»€éº¼å€åˆ¥ï¼Ÿ</strong></p>
                <p>A: è®€å–æ™‚æœå‹™IDä¿æŒåŸå€¼ï¼Œå¯«å…¥æ™‚éœ€è¦å°‡æœå‹™ID OR 0x80 (å³åŠ ä¸Š128)</p>
                <p style="margin-top: 10px;">ä¾‹å¦‚ï¼š</p>
                <ul style="margin-left: 20px;">
                    <li>è®€å–ç‹€æ…‹ï¼š<code>0x00</code></li>
                    <li>å¯«å…¥ç‹€æ…‹ï¼š<code>0x80</code> (0x00 | 0x80)</li>
                </ul>
                
                <p style="margin-top: 15px;"><strong>Q: 0xFFFF ä»£è¡¨ä»€éº¼ï¼Ÿ</strong></p>
                <p>A: æ•¸æ“šå€¼ 0xFFFF é€šå¸¸è¡¨ç¤ºï¼š</p>
                <ul style="margin-left: 20px;">
                    <li>æŸ¥è©¢å‘½ä»¤ï¼ˆè«‹æ±‚è¨­å‚™å›å‚³ç•¶å‰å€¼ï¼‰</li>
                    <li>ç„¡æ•ˆ/ä¸æ”¯æ´çš„åŠŸèƒ½</li>
                    <li>æ‹’çµ•åŸ·è¡Œ</li>
                </ul>
                
                <p style="margin-top: 15px;"><strong>Q: å¦‚ä½•é©—è­‰å°åŒ…æ˜¯å¦æ­£ç¢ºï¼Ÿ</strong></p>
                <p>A: ä½¿ç”¨ã€Œè§£æå°åŒ…ã€åŠŸèƒ½ï¼Œå·¥å…·æœƒè‡ªå‹•é©—è­‰æ ¡é©—ç¢¼ä¸¦è§£æå…§å®¹</p>
                
                <p style="margin-top: 15px;"><strong>Q: ä¸²å£é€šè¨ŠåŠŸèƒ½ç„¡æ³•ä½¿ç”¨ï¼Ÿ</strong></p>
                <p>A: è«‹ç¢ºèªï¼š</p>
                <ul style="margin-left: 20px;">
                    <li>ä½¿ç”¨æ”¯æ´çš„ç€è¦½å™¨ï¼ˆChrome 89+ã€Edge 89+ã€Opera 75+ï¼‰</li>
                    <li>ä½¿ç”¨ HTTPS æˆ– localhost é€£ç·š</li>
                    <li>USB TTL è£ç½®å·²æ­£ç¢ºé€£æ¥ä¸¦è¢«ç³»çµ±è­˜åˆ¥</li>
                    <li>æ²’æœ‰å…¶ä»–ç¨‹å¼ä½”ç”¨ä¸²å£ï¼ˆå¦‚ Arduino IDEï¼‰</li>
                </ul>
                
                <p style="margin-top: 15px;"><strong>Q: ç‚ºä»€éº¼éœ€è¦ Level Shifterï¼Ÿ</strong></p>
                <p>A: TaiSEIA è¨­å‚™ä½¿ç”¨ 5V é‚è¼¯ï¼Œè€Œå¤§å¤šæ•¸ USB TTL æ¨¡çµ„ï¼ˆå¦‚ FTDIã€CP2102ï¼‰è¼¸å‡º 3.3Vã€‚ç›´æ¥é€£æ¥å¯èƒ½å°è‡´ï¼š</p>
                <ul style="margin-left: 20px;">
                    <li>é€šè¨ŠéŒ¯èª¤æˆ–ä¸ç©©å®š</li>
                    <li>è¨­å‚™ç„¡æ³•æ­£ç¢ºè­˜åˆ¥è¨Šè™Ÿ</li>
                    <li>é•·æœŸä½¿ç”¨å¯èƒ½æå£ç¡¬é«”</li>
                </ul>
                <p>å»ºè­°ä½¿ç”¨é›™å‘é›»å¹³è½‰æ›æ¨¡çµ„ï¼ˆå¦‚ TXB0108ã€BSS138ï¼‰</p>
            </div>

            <h3>ğŸ”¹ ä¸²å£é€šè¨Šç¡¬é«”é€£æ¥</h3>
            <div class="help-text">
                <p><strong>é€£æ¥ç¤ºæ„åœ–ï¼š</strong></p>
                <pre style="background: #2d3748; color: #68d391; padding: 15px; border-radius: 5px; overflow-x: auto;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é›»è…¦     â”‚ USB  â”‚  USB TTL     â”‚ 3.3V â”‚Level Shifter â”‚ 5V  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚â”€â”€â”€â”€â”€â–¶â”‚  è½‰æ¥å™¨      â”‚â”€â”€â”€â”€â”€â–¶â”‚  é›»å¹³è½‰æ›å™¨  â”‚â”€â”€â”€â”€â–¶â”‚ TaiSEIA è¨­å‚™ â”‚
â”‚  Chrome    â”‚      â”‚ (CP2102/CH340)â”‚      â”‚ (TXB0108)    â”‚     â”‚   (ç©ºèª¿ç­‰)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚                      â”‚
                         â”‚ GND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ GND
                         
æ¥ç·šèªªæ˜ï¼š
â€¢ USB TTL TX â†’ Level Shifter (3.3Vå´) â†’ TaiSEIA RX (5Vå´)
â€¢ USB TTL RX â† Level Shifter (3.3Vå´) â† TaiSEIA TX (5Vå´)
â€¢ å…±åœ°ï¼šUSB TTL GND = Level Shifter GND = TaiSEIA GND
â€¢ ä¾›é›»ï¼šLevel Shifter éœ€è¦åŒæ™‚æ¥ 3.3V å’Œ 5V
                </pre>
                
                <p style="margin-top: 15px;"><strong>æ¨è–¦çš„ USB TTL æ¨¡çµ„ï¼š</strong></p>
                <ul style="margin-left: 20px; line-height: 1.8;">
                    <li>âœ… CP2102 USB to TTLï¼ˆä¾¿å®œã€ç©©å®šï¼‰</li>
                    <li>âœ… CH340G USB to TTLï¼ˆä½æˆæœ¬ï¼‰</li>
                    <li>âœ… FTDI FT232RLï¼ˆå“è³ªæœ€ä½³ä½†è¼ƒè²´ï¼‰</li>
                    <li>âœ… PL2303ï¼ˆå¸¸è¦‹ä½†é©…å‹•å¯èƒ½æœ‰å•é¡Œï¼‰</li>
                </ul>
                
                <p style="margin-top: 15px;"><strong>æ¸¬è©¦æ­¥é©Ÿï¼š</strong></p>
                <ol style="margin-left: 20px; line-height: 2;">
                    <li>ç¢ºèªç¡¬é«”é€£æ¥æ­£ç¢ºï¼ˆåŒ…å« Level Shifterï¼‰</li>
                    <li>é–‹å•Ÿæœ¬å·¥å…·çš„ã€Œä¸²å£é€šè¨Šã€é é¢</li>
                    <li>é»æ“Šã€Œé€£æ¥ä¸²å£ã€ï¼Œé¸æ“‡æ­£ç¢ºçš„ COM åŸ </li>
                    <li>ä½¿ç”¨ã€Œå¿«é€Ÿå‘½ä»¤ã€ç™¼é€æ¸¬è©¦å°åŒ…</li>
                    <li>è§€å¯Ÿç›£è¦–å™¨ä¸­çš„å›æ‡‰</li>
                    <li>å¦‚æœæœ‰å›æ‡‰ï¼Œè¡¨ç¤ºé€£æ¥æˆåŠŸï¼</li>
                </ol>
            </div>

            <h3>ğŸ”¹ é€šè¨Šåƒæ•¸</h3>
            <table class="info-table">
                <tr>
                    <th>åƒæ•¸</th>
                    <th>è¨­å®šå€¼</th>
                </tr>
                <tr>
                    <td>æ³¢ç‰¹ç‡ (Baud Rate)</td>
                    <td>9600</td>
                </tr>
                <tr>
                    <td>æ•¸æ“šä½ (Data Bits)</td>
                    <td>8</td>
                </tr>
                <tr>
                    <td>åœæ­¢ä½ (Stop Bits)</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td>æ ¡é©—ä½ (Parity)</td>
                    <td>None (ç„¡)</td>
                </tr>
                <tr>
                    <td>æµé‡æ§åˆ¶ (Flow Control)</td>
                    <td>None (ç„¡)</td>
                </tr>
                <tr>
                    <td>é›»å£“</td>
                    <td>5V TTL (éœ€é›»å¹³è½‰æ›è‡³3.3V)</td>
                </tr>
            </table>

            <div class="warning" style="margin-top: 20px;">
                âš ï¸ <strong>é‡è¦æé†’ï¼š</strong><br>
                TaiSEIA è¨­å‚™ä½¿ç”¨ 5V é‚è¼¯é›»å¹³ï¼ŒESP32/ESP8266 ä½¿ç”¨ 3.3V<br>
                <strong>å¿…é ˆä½¿ç”¨ Level Shifter é€²è¡Œé›»å¹³è½‰æ›ï¼Œå¦å‰‡å¯èƒ½æå£è¨­å‚™ï¼</strong>
            </div>

            <h3>ğŸ”¹ æ§åˆ¶å™¨é–‹ç™¼æŒ‡å—</h3>
            <div class="help-text">
                <h4>ğŸ’¡ TaiSEIA 101 <strong>ä¸éœ€è¦</strong>æ¡æ‰‹å”è­°</h4>
                <p>TaiSEIA 101 æ˜¯ä¸€å€‹ç„¡é€£æ¥å”è­°ï¼Œè¨­å‚™éš¨æ™‚æ¥æ”¶ä¸¦å›æ‡‰å‘½ä»¤ã€‚ä¸éå»ºè­°åœ¨æ§åˆ¶å™¨å•Ÿå‹•æ™‚é€²è¡Œåˆå§‹åŒ–æµç¨‹ã€‚</p>
                
                <h4>ğŸ“‹ æ¨è–¦çš„æ§åˆ¶å™¨åˆå§‹åŒ–æµç¨‹</h4>
                <div class="example-box" style="margin: 15px 0;">
                    <h5 style="margin-top: 0;">æ­¥é©Ÿ 1ï¼šå»£æ’­æ¢æ¸¬è¨­å‚™</h5>
                    <pre style="background: #2d3748; color: #68d391; padding: 15px; border-radius: 5px; margin: 10px 0;">
// ç™¼é€å»£æ’­æŸ¥è©¢ï¼Œæ¢æ¸¬æ‰€æœ‰è¨­å‚™
ç™¼é€: 06 00 08 FF FF 0E  â­ æœ€å¸¸è¦‹å‘½ä»¤
      â”‚  â”‚  â”‚  â””â”€æŸ¥è©¢ (0xFFFF)
      â”‚  â”‚  â””â”€ æœå‹™ 0x08 (è®€å–ç‹€æ…‹)
      â”‚  â””â”€ SA_ID 0x00 (å»£æ’­)
      â””â”€ é•·åº¦ 6 å­—ç¯€

<span style="color: #ffc107;">ğŸ“ æ ¡é©—ç¢¼è¨ˆç®— (æœ€å¾Œä¸€å€‹å­—ç¯€ 0x0E):</span>
   0x06 âŠ• 0x00 âŠ• 0x08 âŠ• 0xFF âŠ• 0xFF = <span style="color: #ffc107;">0x0E</span>
   <span style="color: #a0aec0;">èªªæ˜: å°å‰ 5 å€‹å­—ç¯€é€²è¡Œ XOR é‹ç®—</span>

// è¨­å‚™æœƒå›æ‡‰é•·å°åŒ…ï¼ˆå»£æ’­ç‹€æ…‹ï¼‰
æ¥æ”¶: 55 00 08 00 00 01 01 00 00 02 00 00 ... FD
      â”‚  â”‚  â”‚  â””â”€ æ‰€æœ‰æœå‹™çš„ç•¶å‰ç‹€æ…‹
      â”‚  â”‚  â””â”€ é¡å‹ 0x08
      â”‚  â””â”€ SA_ID 0x00
      â””â”€ é•·åº¦ (ä¾‹å¦‚ 85 å­—ç¯€ = 0x55)

<span style="color: #ffc107;">ğŸ“ æ ¡é©—ç¢¼è¨ˆç®— (æœ€å¾Œä¸€å€‹å­—ç¯€ 0xFD):</span>
   0x55 âŠ• 0x00 âŠ• 0x08 âŠ• 0x00 âŠ• 0x00 âŠ• 0x01 âŠ• ... âŠ• 0x00 = <span style="color: #ffc107;">0xFD</span>
   <span style="color: #a0aec0;">èªªæ˜: å°å‰ 84 å€‹å­—ç¯€é€²è¡Œ XOR é‹ç®— (é•·åº¦-1)</span>
                    </pre>
                    
                    <h5>æ­¥é©Ÿ 2ï¼šè®€å–è¨­å‚™è³‡è¨Šï¼ˆå¯é¸ï¼‰</h5>
                    <pre style="background: #2d3748; color: #68d391; padding: 15px; border-radius: 5px; margin: 10px 0;">
// è®€å–å“ç‰Œ
06 01 05 FF FF F8  â†’ å–å¾—å“ç‰Œè³‡è¨Š
   <span style="color: #a0aec0;">æ ¡é©—: 0x06 âŠ• 0x01 âŠ• 0x05 âŠ• 0xFF âŠ• 0xFF = <span style="color: #ffc107;">0xF8</span></span>

// è®€å–å‹è™Ÿ
06 01 06 FF FF FB  â†’ å–å¾—å‹è™Ÿè³‡è¨Š
   <span style="color: #a0aec0;">æ ¡é©—: 0x06 âŠ• 0x01 âŠ• 0x06 âŠ• 0xFF âŠ• 0xFF = <span style="color: #ffc107;">0xFB</span></span>

// è®€å–æ”¯æ´çš„æœå‹™åˆ—è¡¨
06 01 07 FF FF FC  â†’ å–å¾—è©²è¨­å‚™æ”¯æ´å“ªäº›æœå‹™
   <span style="color: #a0aec0;">æ ¡é©—: 0x06 âŠ• 0x01 âŠ• 0x07 âŠ• 0xFF âŠ• 0xFF = <span style="color: #ffc107;">0xFC</span></span>
                    </pre>
                    
                    <h5>æ­¥é©Ÿ 3ï¼šé–‹å§‹æ§åˆ¶</h5>
                    <pre style="background: #2d3748; color: #68d391; padding: 15px; border-radius: 5px; margin: 10px 0;">
// å¯«å…¥å‘½ä»¤æ™‚ï¼Œæœå‹™ ID éœ€è¦ OR 0x80
// ä¾‹å¦‚ï¼šé–‹æ©Ÿï¼ˆæœå‹™ 0x00ï¼Œå¯«å…¥å€¼ 1ï¼‰
06 01 80 00 01 86
      â”‚  â”‚  â””â”€é–‹æ©Ÿ
      â”‚  â””â”€ 0x80 = 0x00 OR 0x80 (å¯«å…¥å‘½ä»¤)
      â””â”€ SA_ID 0x01 (ç©ºèª¿)

<span style="color: #ffc107;">ğŸ“ æ ¡é©—ç¢¼è¨ˆç®— (æœ€å¾Œä¸€å€‹å­—ç¯€ 0x86):</span>
   0x06 âŠ• 0x01 âŠ• 0x80 âŠ• 0x00 âŠ• 0x01 = <span style="color: #ffc107;">0x86</span>

// è¨­å‚™æœƒå›æ‡‰ç¢ºèªå°åŒ…
æ¥æ”¶: 06 01 80 00 01 86 (å›æ‡‰ç›¸åŒå°åŒ…è¡¨ç¤ºæˆåŠŸ)
   <span style="color: #a0aec0;">ç¢ºèª: å›æ‡‰å°åŒ…èˆ‡ç™¼é€å°åŒ…å®Œå…¨ç›¸åŒï¼ˆåŒ…å«æ ¡é©—ç¢¼ï¼‰</span>
                    </pre>
                </div>
                
                <h4>ğŸ”„ è¼ªè©¢ç­–ç•¥</h4>
                <div class="info-table-container" style="margin: 15px 0;">
                    <table class="info-table">
                        <tr>
                            <th>æ–¹å¼</th>
                            <th>èªªæ˜</th>
                            <th>å„ªç¼ºé»</th>
                        </tr>
                        <tr>
                            <td><strong>å»£æ’­è¼ªè©¢</strong></td>
                            <td>å®šæœŸç™¼é€å»£æ’­æŸ¥è©¢<br><code>06 00 08 FF FF 0E</code></td>
                            <td>âœ… ä¸€æ¬¡å–å¾—æ‰€æœ‰ç‹€æ…‹<br>âœ… ç°¡å–®å¯é <br>âš ï¸ å°åŒ…è¼ƒé•·</td>
                        </tr>
                        <tr>
                            <td><strong>å–®é …æŸ¥è©¢</strong></td>
                            <td>æŸ¥è©¢ç‰¹å®šæœå‹™<br><code>06 01 00 FF FF FA</code></td>
                            <td>âœ… å°åŒ…å°<br>âœ… ç²¾ç¢ºæ§åˆ¶<br>âš ï¸ éœ€å¤šæ¬¡æŸ¥è©¢</td>
                        </tr>
                        <tr>
                            <td><strong>äº‹ä»¶é©…å‹•</strong></td>
                            <td>å¯«å…¥å¾Œè®€å–ç¢ºèª<br>è¨­å®šå®šæ™‚å™¨æ›´æ–°ç‹€æ…‹</td>
                            <td>âœ… æ•ˆç‡æœ€é«˜<br>âš ï¸ å¯¦ä½œè¼ƒè¤‡é›œ</td>
                        </tr>
                    </table>
                </div>
                
                <h4>âš¡ å¯¦ç”¨æŠ€å·§</h4>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li><strong>å»¶é²å»ºè­°ï¼š</strong>æ¯å€‹å‘½ä»¤ä¹‹é–“è‡³å°‘å»¶é² <code>100ms</code></li>
                    <li><strong>è¶…æ™‚è¨­å®šï¼š</strong>ç­‰å¾…å›æ‡‰çš„è¶…æ™‚æ™‚é–“å»ºè­° <code>500-1000ms</code></li>
                    <li><strong>é‡è©¦æ©Ÿåˆ¶ï¼š</strong>å¦‚æœæ²’æœ‰æ”¶åˆ°å›æ‡‰ï¼Œæœ€å¤šé‡è©¦ <code>3 æ¬¡</code></li>
                    <li><strong>éŒ¯èª¤è™•ç†ï¼š</strong>æ ¡é©—ç¢¼éŒ¯èª¤æ™‚ä¸Ÿæ£„å°åŒ…ï¼Œä¸è¦è™•ç†</li>
                    <li><strong>ç‹€æ…‹åŒæ­¥ï¼š</strong>å¯«å…¥å‘½ä»¤å¾Œï¼Œå»ºè­°å†è®€å–ä¸€æ¬¡ç¢ºèªç‹€æ…‹</li>
                </ul>
                
                <h4>ğŸ¯ å®Œæ•´æ§åˆ¶æµç¨‹ç¯„ä¾‹</h4>
                <div class="example-box" style="margin: 15px 0;">
                    <pre style="background: #2d3748; color: #68d391; padding: 15px; border-radius: 5px; line-height: 1.8;">
<strong>// æƒ…å¢ƒï¼šé–‹æ©Ÿä¸¦è¨­å®šç©ºèª¿ç‚ºå†·æ°£ 25Â°C</strong>

1ï¸âƒ£ é–‹æ©Ÿ
   ç™¼é€: 06 01 80 00 01 86 (æœå‹™ 0x00, å¯«å…¥ 1)
   ç­‰å¾…: 100ms
   æ¥æ”¶: 06 01 80 00 01 86 (ç¢ºèª)
   
2ï¸âƒ£ è¨­å®šæ¨¡å¼ç‚ºå†·æ°£
   ç™¼é€: 06 01 81 00 00 86 (æœå‹™ 0x01, å¯«å…¥ 0 = COOL)
   ç­‰å¾…: 100ms
   æ¥æ”¶: 06 01 81 00 00 86 (ç¢ºèª)
   
3ï¸âƒ£ è¨­å®šç›®æ¨™æº«åº¦ 25Â°C
   ç™¼é€: 06 01 83 00 19 9D (æœå‹™ 0x03, å¯«å…¥ 25)
   ç­‰å¾…: 100ms
   æ¥æ”¶: 06 01 83 00 19 9D (ç¢ºèª)
   
4ï¸âƒ£ æŸ¥è©¢ç•¶å‰ç‹€æ…‹ï¼ˆç¢ºèªè¨­å®šï¼‰â­
   ç™¼é€: 06 00 08 FF FF 0E (å»£æ’­æŸ¥è©¢ - æœ€å¸¸ç”¨å‘½ä»¤)
   ç­‰å¾…: 500ms
   æ¥æ”¶: 55 00 08 00 00 01 ... (é•·å°åŒ…)
   è§£æ: ç¢ºèªé›»æº=1, æ¨¡å¼=0, æº«åº¦=25
   
âœ… è¨­å®šå®Œæˆï¼
                    </pre>
                </div>
                
                <h4>âš ï¸ å¸¸è¦‹å•é¡Œ</h4>
                <div class="warning" style="margin: 15px 0;">
                    <strong>Q: ç™¼é€å‘½ä»¤å¾Œæ²’æœ‰å›æ‡‰ï¼Ÿ</strong><br>
                    A: æª¢æŸ¥ï¼š(1)é›»å¹³è½‰æ›æ˜¯å¦æ­£ç¢º (2)æ³¢ç‰¹ç‡æ˜¯å¦ç‚º9600 (3)å»¶é²æ˜¯å¦è¶³å¤  (4)æ ¡é©—ç¢¼æ˜¯å¦æ­£ç¢º
                    <br><br>
                    <strong>Q: éœ€è¦å®šæœŸç™¼é€å¿ƒè·³å—ï¼Ÿ</strong><br>
                    A: ä¸éœ€è¦ã€‚TaiSEIA è¨­å‚™éš¨æ™‚å¾…å‘½ï¼Œæ²’æœ‰é€£æ¥ç‹€æ…‹ã€‚
                    <br><br>
                    <strong>Q: å¯ä»¥åŒæ™‚æ§åˆ¶å¤šå€‹è¨­å‚™å—ï¼Ÿ</strong><br>
                    A: å¯ä»¥ï¼Œä½¿ç”¨ä¸åŒçš„ SA_IDã€‚æˆ–ä½¿ç”¨å»£æ’­(SA_ID=0x00)åŒæ™‚æ§åˆ¶æ‰€æœ‰è¨­å‚™ã€‚
                    <br><br>
                    <strong>Q: å»£æ’­æŸ¥è©¢æœƒå¾ˆæ…¢å—ï¼Ÿ</strong><br>
                    A: é€šå¸¸åœ¨ 100-300ms å…§å®Œæˆï¼Œå–æ±ºæ–¼è¨­å‚™æ”¯æ´çš„æœå‹™æ•¸é‡ã€‚
                </div>
            </div>

            <h3>ğŸ”¹ ç›¸é—œè³‡æº</h3>
            <div class="help-text">
                <ul style="margin-left: 20px; line-height: 2;">
                    <li>ğŸ”— <a href="https://github.com/tsunglung/taixia" target="_blank">GitHub: tsunglung/taixia</a></li>
                    <li>ğŸ”— <a href="https://github.com/xangin/TaiSEIA_ESPhome_samples" target="_blank">TaiSEIA ESPHome ç¯„ä¾‹</a></li>
                    <li>ğŸ”— å°ç£æ™ºæ…§èƒ½æºç”¢æ¥­å”æœƒ (TaiSEIA)</li>
                    <li>ğŸ“„ TaiSEIA 101 é€šè¨Šå”å®šæ¨™æº–</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // ==================== è¨­å‚™å°ˆå±¬æœå‹™å®šç¾© ====================
        // æ ¹æ“šè¨­å‚™é¡å‹ (SA_ID) æ±ºå®šä½¿ç”¨å“ªä¸€çµ„æœå‹™å®šç¾©
        
        const SERVICES_BY_DEVICE = {
            // ===== é€šç”¨æœå‹™ (SA_ID_ALL 0x00) =====
            '0x00': {
                0x00: { name: 'è¨»å†Š', category: 'é€šç”¨' },
                0x01: { name: 'è®€å–è¨­å‚™é¡å‹', category: 'é€šç”¨' },
                0x02: { name: 'è®€å–ç‰ˆæœ¬', category: 'é€šç”¨' },
                0x03: { name: 'ä¿ç•™', category: 'é€šç”¨' },
                0x04: { name: 'è®€å– SA ID', category: 'é€šç”¨' },
                0x05: { name: 'è®€å–å“ç‰Œ', category: 'é€šç”¨' },
                0x06: { name: 'è®€å–å‹è™Ÿ', category: 'é€šç”¨' },
                0x07: { name: 'è®€å–æœå‹™åˆ—è¡¨', category: 'é€šç”¨' },
                0x08: { name: 'è®€å–ç‹€æ…‹', category: 'é€šç”¨' }
            },
            
            // ===== ç©ºèª¿ (SA_ID_CLIMATE 0x01) =====
            '0x01': {
                0x00: { name: 'é›»æºç‹€æ…‹', category: 'ç©ºèª¿', values: { '0': 'é—œæ©Ÿ', '1': 'é–‹æ©Ÿ' }},
                0x01: { name: 'é‹è½‰æ¨¡å¼', category: 'ç©ºèª¿', values: {
                    '0': 'COOL å†·æ°£', '1': 'DRY é™¤æ¿•', '2': 'FAN_ONLY é€é¢¨', '3': 'AUTO è‡ªå‹•', '4': 'HEAT æš–æ°£'
                }},
                0x02: { name: 'é¢¨é€Ÿ', category: 'ç©ºèª¿', values: {
                    '0': 'AUTO è‡ªå‹•', '1': 'QUIET éœéŸ³', '2': 'LOW ä½é€Ÿ', '3': 'MEDIUM ä¸­é€Ÿ', '4': 'HIGH é«˜é€Ÿ'
                }},
                0x03: { name: 'ç›®æ¨™æº«åº¦', category: 'ç©ºèª¿', unit: 'Â°C' },
                0x04: { name: 'å®¤å…§æº«åº¦', category: 'ç©ºèª¿', unit: 'Â°C' },
                0x05: { name: 'ç¡çœ æ¨¡å¼', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x06: { name: 'ç¡çœ å®šæ™‚', category: 'ç©ºèª¿', unit: 'åˆ†é˜' },
                0x07: { name: 'æ™ºæ…§æ§åˆ¶', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x08: { name: 'ç©ºæ°£æ¸…æ·¨', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x09: { name: 'é–‹æ©Ÿæ™‚é–“', category: 'ç©ºèª¿', unit: 'åˆ†é˜' },
                0x0A: { name: 'é—œæ©Ÿæ™‚é–“', category: 'ç©ºèª¿', unit: 'åˆ†é˜' },
                0x0B: { name: 'é–‹æ©Ÿå®šæ™‚', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'å•Ÿç”¨' }},
                0x0C: { name: 'é—œæ©Ÿå®šæ™‚', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'å•Ÿç”¨' }},
                0x0D: { name: 'ç³»çµ±æ™‚é–“', category: 'ç©ºèª¿' },
                0x0E: { name: 'å‚ç›´æ“ºé¢¨', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x0F: { name: 'å‚ç›´æ“ºé¢¨ä½ç½®', category: 'ç©ºèª¿', values: {
                    '0': 'æœ€ä¸Š', '1': 'ä¸Š', '2': 'ä¸­', '3': 'ä¸‹', '4': 'æœ€ä¸‹'
                }},
                0x10: { name: 'æ°´å¹³æ“ºé¢¨', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x11: { name: 'æ°´å¹³æ“ºé¢¨ä½ç½®', category: 'ç©ºèª¿', values: {
                    '0': 'æœ€å·¦', '1': 'å·¦', '2': 'ä¸­', '3': 'å³', '4': 'æœ€å³'
                }},
                0x12: { name: 'æ¿¾ç¶²æç¤º', category: 'ç©ºèª¿', values: { '0': 'æ­£å¸¸', '1': 'éœ€æ¸…æ½”' }},
                0x13: { name: 'ç›®æ¨™æ¿•åº¦', category: 'ç©ºèª¿', unit: '%' },
                0x14: { name: 'å®¤å…§æ¿•åº¦', category: 'ç©ºèª¿', unit: '%' },
                0x15: { name: 'è‡ªæˆ‘æª¢æ¸¬', category: 'ç©ºèª¿' },
                0x16: { name: 'ç©ºæ°£å“è³ªåµæ¸¬', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x17: { name: 'é˜²éœ‰åŠŸèƒ½', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x18: { name: 'è‡ªå‹•æ¸…æ½”', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x19: { name: 'æ´»å‹•åµæ¸¬', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x1A: { name: 'å¼·åŠ›æ¨¡å¼', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x1B: { name: 'ç¯€èƒ½æ¨¡å¼', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x1C: { name: 'èˆ’é©æ¨¡å¼', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x1D: { name: 'åŠŸèƒ½ç¦ç”¨', category: 'ç©ºèª¿' },
                0x1E: { name: 'èœ‚é³´å™¨', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x1F: { name: 'é¡¯ç¤ºæ¨¡å¼', category: 'ç©ºèª¿' },
                0x20: { name: 'ä¿æ¿•åŠŸèƒ½', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x21: { name: 'å®¤å¤–æº«åº¦', category: 'ç©ºèª¿', unit: 'Â°C' },
                0x24: { name: 'é‹è½‰é›»æµ', category: 'é›»åŠ›', unit: 'A' },
                0x25: { name: 'é‹è½‰é›»å£“', category: 'é›»åŠ›', unit: 'V' },
                0x26: { name: 'åŠŸç‡å› æ•¸', category: 'é›»åŠ›' },
                0x27: { name: 'é‹è½‰åŠŸç‡', category: 'é›»åŠ›', unit: 'W' },
                0x28: { name: 'èƒ½æºæ¶ˆè€—', category: 'é›»åŠ›', unit: 'kWh' },
                0x29: { name: 'éŒ¯èª¤ä»£ç¢¼', category: 'è¨ºæ–·' },
                0x2F: { name: 'é‹è½‰æ™‚æ•¸', category: 'è¨ºæ–·', unit: 'å°æ™‚' },
                0x30: { name: 'æ¿¾ç¶²ä½¿ç”¨æ™‚æ•¸', category: 'è¨ºæ–·', unit: 'å°æ™‚' },
                0x37: { name: 'PM2.5', category: 'ç©ºæ°£å“è³ª', unit: 'Î¼g/mÂ³' },
                0x39: { name: 'éœœæ´—åŠŸèƒ½', category: 'ç©ºèª¿', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x3A: { name: 'æ“´å……åŠŸèƒ½ 3A', category: 'ç©ºèª¿' },
                0x3B: { name: 'æ“´å……åŠŸèƒ½ 3B', category: 'ç©ºèª¿' },
                0x40: { name: 'æ“´å……åŠŸèƒ½ 40', category: 'ç©ºèª¿' },
                0xFF: { name: 'å®¤å¤–æ¿•åº¦', category: 'ç©ºèª¿', unit: '%' }
            },
            
            // ===== æ´—è¡£æ©Ÿ (SA_ID_WASHER 0x03) =====
            '0x03': {
                0x00: { name: 'é›»æºç‹€æ…‹', category: 'æ´—è¡£æ©Ÿ', values: { '0': 'é—œæ©Ÿ', '1': 'é–‹æ©Ÿ' }},
                0x01: { name: 'æ¨¡å¼', category: 'æ´—è¡£æ©Ÿ' },
                0x02: { name: 'æ´—è¡£ç¨‹å¼', category: 'æ´—è¡£æ©Ÿ' },
                0x03: { name: 'ç•¶å‰ç‹€æ…‹', category: 'æ´—è¡£æ©Ÿ' },
                0x06: { name: 'å‰©é¤˜æ¬¡æ•¸', category: 'æ´—è¡£æ©Ÿ', unit: 'æ¬¡' },
                0x08: { name: 'æ´—è¡£å‰©é¤˜æ™‚é–“', category: 'æ´—è¡£æ©Ÿ', unit: 'å°æ™‚' },
                0x0A: { name: 'è„«æ°´å‰©é¤˜æ™‚é–“', category: 'æ´—è¡£æ©Ÿ', unit: 'å°æ™‚' },
                0x0C: { name: 'æµ¸æ³¡å‰©é¤˜æ™‚é–“', category: 'æ´—è¡£æ©Ÿ', unit: 'å°æ™‚' },
                0x0E: { name: 'çƒ˜ä¹¾å‰©é¤˜æ™‚é–“', category: 'æ´—è¡£æ©Ÿ', unit: 'å°æ™‚' },
                0x10: { name: 'æ§½æ¸…æ½”å‰©é¤˜æ™‚é–“', category: 'æ´—è¡£æ©Ÿ', unit: 'å°æ™‚' },
                0x12: { name: 'ä¹¾ç‡¥æ¸…æ½”å‰©é¤˜æ™‚é–“', category: 'æ´—è¡£æ©Ÿ', unit: 'å°æ™‚' },
                0x13: { name: 'ç¸½å‰©é¤˜æ™‚é–“', category: 'æ´—è¡£æ©Ÿ', unit: 'å°æ™‚' },
                0x15: { name: 'é ç´„å‰©é¤˜æ™‚é–“', category: 'æ´—è¡£æ©Ÿ', unit: 'å°æ™‚' },
                0x16: { name: 'å…¶ä»–åŠŸèƒ½', category: 'æ´—è¡£æ©Ÿ' },
                0x17: { name: 'æ´—è¡£æ¨¡å¼', category: 'æ´—è¡£æ©Ÿ' },
                0x18: { name: 'æº«æ°´ç¨‹å¼', category: 'æ´—è¡£æ©Ÿ' },
                0x1A: { name: 'é‹è½‰é›»æµ', category: 'é›»åŠ›', unit: 'A' },
                0x1B: { name: 'é‹è½‰é›»å£“', category: 'é›»åŠ›', unit: 'V' },
                0x1C: { name: 'åŠŸç‡å› æ•¸', category: 'é›»åŠ›' },
                0x1D: { name: 'é‹è½‰åŠŸç‡', category: 'é›»åŠ›', unit: 'W' },
                0x1E: { name: 'èƒ½æºæ¶ˆè€—', category: 'é›»åŠ›', unit: 'kWh' }
            },
            
            // ===== é™¤æ¿•æ©Ÿ (SA_ID_DEHUMIDIFIER 0x04) =====
            '0x04': {
                0x00: { name: 'é›»æºç‹€æ…‹', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œæ©Ÿ', '1': 'é–‹æ©Ÿ' }},
                0x01: { name: 'æ¨¡å¼', category: 'é™¤æ¿•æ©Ÿ' },
                0x02: { name: 'é‹è½‰æ™‚é–“', category: 'é™¤æ¿•æ©Ÿ', unit: 'å°æ™‚' },
                0x03: { name: 'ç›¸å°æ¿•åº¦', category: 'é™¤æ¿•æ©Ÿ', unit: '%' },
                0x04: { name: 'é™¤æ¿•ç­‰ç´š', category: 'é™¤æ¿•æ©Ÿ' },
                0x05: { name: 'ä¹¾ç‡¥ç­‰ç´š', category: 'é™¤æ¿•æ©Ÿ' },
                0x06: { name: 'å®¤å…§æº«åº¦', category: 'é™¤æ¿•æ©Ÿ', unit: 'Â°C' },
                0x07: { name: 'å®¤å…§æ¿•åº¦', category: 'é™¤æ¿•æ©Ÿ', unit: '%' },
                0x08: { name: 'è‡ªå‹•é¢¨é‡', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x09: { name: 'é¢¨æ‰‡è§’åº¦', category: 'é™¤æ¿•æ©Ÿ' },
                0x0A: { name: 'æ°´ç®±æ»¿', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'æ­£å¸¸', '1': 'å·²æ»¿' }},
                0x0B: { name: 'æ¿¾ç¶²æç¤º', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'æ­£å¸¸', '1': 'éœ€æ¸…æ½”' }},
                0x0C: { name: 'ç‡ˆå…‰', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x0D: { name: 'ç©ºæ°£æ¸…æ·¨', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x0E: { name: 'é¢¨æ‰‡ç­‰ç´š', category: 'é™¤æ¿•æ©Ÿ' },
                0x0F: { name: 'å´é‚Šå‡ºé¢¨å£', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x10: { name: 'éœéŸ³æ¨¡å¼', category: 'é™¤æ¿•æ©Ÿ' },
                0x11: { name: 'é™¤éœœ', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'å¦', '1': 'æ˜¯' }},
                0x12: { name: 'éŒ¯èª¤ä»£ç¢¼', category: 'è¨ºæ–·' },
                0x13: { name: 'é˜²éœ‰åŠŸèƒ½', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x14: { name: 'é«˜æ¿•åº¦æç¤º', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x15: { name: 'é«˜æ¿•åº¦ç­‰ç´š', category: 'é™¤æ¿•æ©Ÿ', unit: '%' },
                0x16: { name: 'é–å®š', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'æœªé–', '1': 'å·²é–' }},
                0x17: { name: 'åŠŸèƒ½è¨­å®š', category: 'é™¤æ¿•æ©Ÿ' },
                0x18: { name: 'èœ‚é³´å™¨', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x19: { name: 'é‹è½‰é›»æµ', category: 'é›»åŠ›', unit: 'A' },
                0x1A: { name: 'é‹è½‰é›»å£“', category: 'é›»åŠ›', unit: 'V' },
                0x1B: { name: 'åŠŸç‡å› æ•¸', category: 'é›»åŠ›' },
                0x1C: { name: 'é‹è½‰åŠŸç‡', category: 'é›»åŠ›', unit: 'W' },
                0x1D: { name: 'èƒ½æºæ¶ˆè€—', category: 'é›»åŠ›', unit: 'kWh' },
                0x25: { name: 'PM2.5', category: 'ç©ºæ°£å“è³ª', unit: 'Î¼g/mÂ³' },
                0x27: { name: 'ç‡ˆå…‰ç­‰ç´š', category: 'é™¤æ¿•æ©Ÿ' },
                0x28: { name: 'ç•°å‘³åµæ¸¬', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'ç„¡', '1': 'æœ‰' }},
                0x29: { name: 'PM2.5 åµæ¸¬', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x2A: { name: 'éœœæ´—åŠŸèƒ½', category: 'é™¤æ¿•æ©Ÿ', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x52: { name: 'æ¿¾ç¶²é‡ç½®', category: 'é™¤æ¿•æ©Ÿ' }
            },
            
            // ===== ç©ºæ°£æ¸…æ·¨æ©Ÿ (SA_ID_AIR_PURIFIER 0x08) =====
            '0x08': {
                0x00: { name: 'é›»æºç‹€æ…‹', category: 'æ¸…æ·¨æ©Ÿ', values: { '0': 'é—œæ©Ÿ', '1': 'é–‹æ©Ÿ' }},
                0x01: { name: 'æ¨¡å¼', category: 'æ¸…æ·¨æ©Ÿ' },
                0x04: { name: 'ç©ºæ°£å“è³ª', category: 'æ¸…æ·¨æ©Ÿ' },
                0x0A: { name: 'é‹è½‰é›»æµ', category: 'é›»åŠ›', unit: 'A' },
                0x0B: { name: 'é‹è½‰é›»å£“', category: 'é›»åŠ›', unit: 'V' },
                0x0C: { name: 'åŠŸç‡å› æ•¸', category: 'é›»åŠ›' },
                0x0D: { name: 'é‹è½‰åŠŸç‡', category: 'é›»åŠ›', unit: 'W' },
                0x0E: { name: 'èƒ½æºæ¶ˆè€—', category: 'é›»åŠ›', unit: 'kWh' }
            },
            
            // ===== ERV å…¨ç†±äº¤æ›å™¨ (SA_ID_ERV 0x0E) =====
            '0x0E': {
                0x00: { name: 'é›»æºç‹€æ…‹', category: 'ERV', values: { '0': 'é—œæ©Ÿ', '1': 'é–‹æ©Ÿ' }},
                0x01: { name: 'æ¨¡å¼', category: 'ERV' },
                0x02: { name: 'é¢¨é€Ÿ', category: 'ERV' },
                0x03: { name: 'ç›®æ¨™æº«åº¦', category: 'ERV', unit: 'Â°C' },
                0x04: { name: 'å®¤å…§æº«åº¦', category: 'ERV', unit: 'Â°C' },
                0x05: { name: 'å®¤å¤–æº«åº¦', category: 'ERV', unit: 'Â°C' },
                0x06: { name: 'å®šæ™‚é–‹æ©Ÿ', category: 'ERV', unit: 'åˆ†é˜' },
                0x07: { name: 'æª¢æŸ¥ç¢¼', category: 'ERV' },
                0x08: { name: 'æ©Ÿå‹', category: 'ERV' },
                0x09: { name: 'éŒ¯èª¤ä»£ç¢¼', category: 'è¨ºæ–·' },
                0x0E: { name: 'èƒ½æº', category: 'ERV' },
                0x14: { name: 'æ¿¾ç¶²é‡ç½®', category: 'ERV' },
                0x15: { name: 'é€šé¢¨æ¨¡å¼', category: 'ERV' },
                0x16: { name: 'é ç†±/é å†·', category: 'ERV', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x1C: { name: 'å‰ç½®æ¿¾ç¶²æç¤º', category: 'ERV', values: { '0': 'æ­£å¸¸', '1': 'éœ€æ›´æ›' }},
                0x1D: { name: 'PM2.5æ¿¾ç¶²æç¤º', category: 'ERV', values: { '0': 'æ­£å¸¸', '1': 'éœ€æ›´æ›' }}
            },
            
            // ===== é›»é¢¨æ‰‡ (SA_ID_FAN 0x0F) =====
            '0x0F': {
                0x00: { name: 'é›»æºç‹€æ…‹', category: 'é¢¨æ‰‡', values: { '0': 'é—œæ©Ÿ', '1': 'é–‹æ©Ÿ' }},
                0x01: { name: 'æ¨¡å¼', category: 'é¢¨æ‰‡' },
                0x02: { name: 'é¢¨é€Ÿ', category: 'é¢¨æ‰‡' },
                0x03: { name: 'æº«åº¦', category: 'é¢¨æ‰‡', unit: 'Â°C' },
                0x05: { name: 'æ“ºå‹•', category: 'é¢¨æ‰‡', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x06: { name: 'è² é›¢å­', category: 'é¢¨æ‰‡', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x07: { name: 'ç‡ˆå…‰', category: 'é¢¨æ‰‡', values: { '0': 'é—œé–‰', '1': 'é–‹å•Ÿ' }},
                0x08: { name: 'æ¿•åº¦', category: 'é¢¨æ‰‡', unit: '%' },
                0x0E: { name: 'é‹è½‰é›»æµ', category: 'é›»åŠ›', unit: 'A' },
                0x0F: { name: 'é‹è½‰é›»å£“', category: 'é›»åŠ›', unit: 'V' },
                0x10: { name: 'åŠŸç‡å› æ•¸', category: 'é›»åŠ›' },
                0x11: { name: 'é‹è½‰åŠŸç‡', category: 'é›»åŠ›', unit: 'W' },
                0x12: { name: 'èƒ½æºæ¶ˆè€—', category: 'é›»åŠ›', unit: 'kWh' }
            }
        };
        
        // æ ¹æ“šè¨­å‚™é¡å‹å–å¾—å°æ‡‰çš„æœå‹™å®šç¾©
        function getServicesForDevice(deviceType) {
            const deviceKey = '0x' + deviceType.toString(16).toUpperCase().padStart(2, '0');
            return SERVICES_BY_DEVICE[deviceKey] || SERVICES_BY_DEVICE['0x01']; // é è¨­ç‚ºç©ºèª¿
        }
        
        // å‘å¾Œç›¸å®¹ï¼šé è¨­ä½¿ç”¨ç©ºèª¿çš„æœå‹™å®šç¾©
        const SERVICES = SERVICES_BY_DEVICE['0x01'];

        // ==================== Tab åˆ‡æ› ====================
        function switchTab(tabName) {
            // éš±è—æ‰€æœ‰å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„å…§å®¹
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // ==================== XOR æ ¡é©—ç¢¼è¨ˆç®— ====================
        function calculateChecksum(bytes) {
            let checksum = 0;
            for (let byte of bytes) {
                checksum ^= byte;
            }
            return checksum;
        }

        // ==================== æ›´æ–°æœå‹™é¸é … ====================
        function updateServiceOptions() {
            const deviceType = parseInt(document.getElementById('deviceType').value);
            const select = document.getElementById('serviceId');
            select.innerHTML = '';
            
            // å¦‚æœæ˜¯å»£æ’­ (0x00)ï¼Œé¡¯ç¤ºå»£æ’­å‘½ä»¤
            if (deviceType === 0x00) {
                const broadcastCommands = [
                    { id: 0x00, name: 'è¨»å†Š' },
                    { id: 0x01, name: 'è®€å–è¨­å‚™é¡å‹' },
                    { id: 0x02, name: 'è®€å–ç‰ˆæœ¬' },
                    { id: 0x03, name: 'ä¿ç•™' },
                    { id: 0x04, name: 'è®€å– SA ID' },
                    { id: 0x05, name: 'è®€å–å“ç‰Œ' },
                    { id: 0x06, name: 'è®€å–å‹è™Ÿ' },
                    { id: 0x07, name: 'è®€å–æœå‹™åˆ—è¡¨' },
                    { id: 0x08, name: 'è®€å–ç‹€æ…‹ (Broadcast Query) â­' }
                ];
                
                broadcastCommands.forEach(cmd => {
                    const option = document.createElement('option');
                    option.value = cmd.id;
                    option.textContent = `0x${cmd.id.toString(16).toUpperCase().padStart(2, '0')} - ${cmd.name}`;
                    if (cmd.id === 0x08) option.selected = true; // é è¨­é¸æ“‡æœ€å¸¸ç”¨çš„
                    select.appendChild(option);
                });
                
                // å»£æ’­å‘½ä»¤é€šå¸¸ä¸éœ€è¦è®€å¯«é¸æ“‡ï¼Œéš±è—å‘½ä»¤é¡å‹
                document.getElementById('commandType').value = 'read';
                
            } else {
                // å–å¾—è©²è¨­å‚™çš„æœå‹™å®šç¾©
                const deviceServices = getServicesForDevice(deviceType);
                
                // å–å¾—æ‰€æœ‰å¯ç”¨çš„æœå‹™ ID ä¸¦æ’åº
                const serviceIds = Object.keys(deviceServices).map(id => parseInt(id)).sort((a, b) => a - b);
                
                serviceIds.forEach(id => {
                    const service = deviceServices[id];
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = `0x${id.toString(16).toUpperCase().padStart(2, '0')} - ${service.name}`;
                    select.appendChild(option);
                });
            }
            
            updateValueHelp();
        }

        // ==================== æ›´æ–°æ•¸å€¼å¹«åŠ© ====================
        function updateValueHelp() {
            const deviceType = parseInt(document.getElementById('deviceType').value);
            const serviceId = parseInt(document.getElementById('serviceId').value);
            const helpDiv = document.getElementById('valueHelp');
            const dataValueSelect = document.getElementById('dataValue');
            
            // æ¸…ç©ºç¾æœ‰é¸é …
            dataValueSelect.innerHTML = '';
            
            // ç‰¹æ®Šè™•ç†ï¼šå»£æ’­å‘½ä»¤
            if (deviceType === 0x00) {
                const queryOption = document.createElement('option');
                queryOption.value = '0xFFFF';
                queryOption.textContent = '0xFFFF - æŸ¥è©¢';
                queryOption.selected = true;
                dataValueSelect.appendChild(queryOption);
                
                const broadcastCommandNames = {
                    0x00: 'è¨»å†Š',
                    0x01: 'è®€å–è¨­å‚™é¡å‹',
                    0x02: 'è®€å–ç‰ˆæœ¬',
                    0x03: 'ä¿ç•™',
                    0x04: 'è®€å– SA ID',
                    0x05: 'è®€å–å“ç‰Œ',
                    0x06: 'è®€å–å‹è™Ÿ',
                    0x07: 'è®€å–æœå‹™åˆ—è¡¨',
                    0x08: 'è®€å–ç‹€æ…‹ (Broadcast Query)'
                };
                
                let helpText = `<strong>${broadcastCommandNames[serviceId]}</strong> (å»£æ’­å‘½ä»¤)<br>`;
                
                if (serviceId === 0x08) {
                    helpText += '<br><strong>â­ æœ€å¸¸ç”¨çš„å»£æ’­å‘½ä»¤</strong><br>';
                    helpText += 'ç™¼é€æ­¤å‘½ä»¤å¾Œï¼Œæ‰€æœ‰è¨­å‚™æœƒå›æ‡‰å®Œæ•´ç‹€æ…‹çš„é•·å°åŒ…<br>';
                    helpText += '<br><strong>ç”¨é€”ï¼š</strong><br>';
                    helpText += 'â€¢ æ§åˆ¶å™¨å•Ÿå‹•æ™‚å–å¾—åˆå§‹ç‹€æ…‹<br>';
                    helpText += 'â€¢ å®šæœŸè¼ªè©¢ç›£æ§è¨­å‚™ç‹€æ…‹<br>';
                    helpText += 'â€¢ å¯«å…¥å‘½ä»¤å¾Œé©—è­‰è¨­å®š<br>';
                } else {
                    helpText += '<br>å»£æ’­å‘½ä»¤æ•¸æ“šå€¼é€šå¸¸ç‚º 0xFFFF (æŸ¥è©¢)<br>';
                }
                
                helpDiv.innerHTML = helpText;
                helpDiv.style.display = 'block';
                return;
            }
            
            // ä¸€èˆ¬è¨­å‚™æœå‹™è™•ç†
            const deviceServices = getServicesForDevice(deviceType);
            const service = deviceServices[serviceId];
            
            if (!service) {
                helpDiv.style.display = 'none';
                // æ·»åŠ åŸºæœ¬é¸é …
                addBasicDataOptions(dataValueSelect);
                return;
            }
            
            let helpText = `<strong>${service.name}</strong> (${service.category})<br>`;
            
            if (service.values) {
                // æœ‰é å®šç¾©å€¼çš„æœå‹™
                helpText += '<br><strong>å¯ç”¨æ•¸å€¼ï¼š</strong><br>';
                
                // æ·»åŠ æŸ¥è©¢é¸é …
                const queryOption = document.createElement('option');
                queryOption.value = '0xFFFF';
                queryOption.textContent = '0xFFFF - æŸ¥è©¢ (Query)';
                dataValueSelect.appendChild(queryOption);
                
                // æ·»åŠ é å®šç¾©çš„å€¼
                Object.entries(service.values).forEach(([val, desc]) => {
                    const option = document.createElement('option');
                    option.value = val;
                    option.textContent = `${val} - ${desc}`;
                    dataValueSelect.appendChild(option);
                    helpText += `â€¢ ${val}: ${desc}<br>`;
                });
                
                // æ·»åŠ è‡ªè¨‚é¸é …
                const customOption = document.createElement('option');
                customOption.value = 'custom';
                customOption.textContent = 'ğŸ”§ è‡ªè¨‚æ•¸å€¼...';
                dataValueSelect.appendChild(customOption);
                
            } else if (service.unit) {
                // æœ‰å–®ä½çš„æœå‹™ï¼ˆæº«åº¦ã€æ¿•åº¦ç­‰ï¼‰
                helpText += `<br><strong>å–®ä½ï¼š</strong>${service.unit}<br>`;
                
                // æ·»åŠ æŸ¥è©¢é¸é …
                const queryOption = document.createElement('option');
                queryOption.value = '0xFFFF';
                queryOption.textContent = '0xFFFF - æŸ¥è©¢ (Query)';
                queryOption.selected = true;
                dataValueSelect.appendChild(queryOption);
                
                // æ ¹æ“šå–®ä½æ·»åŠ å¸¸ç”¨å€¼
                if (service.unit === 'Â°C') {
                    // æº«åº¦ï¼š16-30åº¦
                    for (let temp = 16; temp <= 30; temp++) {
                        const option = document.createElement('option');
                        option.value = temp;
                        option.textContent = `${temp}Â°C`;
                        dataValueSelect.appendChild(option);
                    }
                    helpText += '<br><strong>å»ºè­°ç¯„åœï¼š</strong>16Â°C ~ 30Â°C';
                } else if (service.unit === '%') {
                    // æ¿•åº¦ï¼š30-90%ï¼Œæ¯5%
                    for (let humidity = 30; humidity <= 90; humidity += 5) {
                        const option = document.createElement('option');
                        option.value = humidity;
                        option.textContent = `${humidity}%`;
                        dataValueSelect.appendChild(option);
                    }
                    helpText += '<br><strong>å»ºè­°ç¯„åœï¼š</strong>30% ~ 90%';
                } else {
                    // å…¶ä»–å–®ä½ï¼Œæ·»åŠ åŸºæœ¬é¸é …
                    addBasicDataOptions(dataValueSelect);
                }
                
                // æ·»åŠ è‡ªè¨‚é¸é …
                const customOption = document.createElement('option');
                customOption.value = 'custom';
                customOption.textContent = 'ğŸ”§ è‡ªè¨‚æ•¸å€¼...';
                dataValueSelect.appendChild(customOption);
                
            } else {
                // æ²’æœ‰é å®šç¾©å€¼çš„æœå‹™
                addBasicDataOptions(dataValueSelect);
                helpText += '<br><em>æ­¤æœå‹™æ²’æœ‰é å®šç¾©æ•¸å€¼</em>';
            }
            
            helpText += '<br><br><em>ğŸ’¡ é¸æ“‡ 0xFFFF é€²è¡ŒæŸ¥è©¢</em>';
            
            helpDiv.innerHTML = helpText;
            helpDiv.style.display = 'block';
        }
        
        // ==================== æ·»åŠ åŸºæœ¬æ•¸æ“šé¸é … ====================
        function addBasicDataOptions(selectElement) {
            // æŸ¥è©¢
            const queryOption = document.createElement('option');
            queryOption.value = '0xFFFF';
            queryOption.textContent = '0xFFFF - æŸ¥è©¢ (Query)';
            queryOption.selected = true;
            selectElement.appendChild(queryOption);
            
            // å¸¸ç”¨å€¼
            const commonValues = [
                { val: '0', text: '0 - é—œé–‰/OFF' },
                { val: '1', text: '1 - é–‹å•Ÿ/ON' },
                { val: '2', text: '2' },
                { val: '3', text: '3' },
                { val: '4', text: '4' },
                { val: '5', text: '5' }
            ];
            
            commonValues.forEach(item => {
                const option = document.createElement('option');
                option.value = item.val;
                option.textContent = item.text;
                selectElement.appendChild(option);
            });
            
            // è‡ªè¨‚
            const customOption = document.createElement('option');
            customOption.value = 'custom';
            customOption.textContent = 'ğŸ”§ è‡ªè¨‚æ•¸å€¼...';
            selectElement.appendChild(customOption);
        }
        
        // ==================== è™•ç†æ•¸æ“šå€¼è®Šæ›´ ====================
        function handleDataValueChange() {
            const selectedValue = document.getElementById('dataValue').value;
            const customValueDiv = document.getElementById('customValueInput');
            
            if (selectedValue === 'custom') {
                customValueDiv.style.display = 'block';
                document.getElementById('customValue').focus();
            } else {
                customValueDiv.style.display = 'none';
            }
        }

        // ==================== ç”¢ç”Ÿå°åŒ… ====================
        function generatePacket() {
            try {
                const deviceType = parseInt(document.getElementById('deviceType').value);
                const commandType = document.getElementById('commandType').value;
                const serviceId = parseInt(document.getElementById('serviceId').value);
                let dataValue = document.getElementById('dataValue').value.trim();
                
                // æª¢æŸ¥æ˜¯å¦é¸æ“‡è‡ªè¨‚å€¼
                if (dataValue === 'custom') {
                    dataValue = document.getElementById('customValue').value.trim();
                    if (!dataValue) {
                        throw new Error('è«‹è¼¸å…¥è‡ªè¨‚æ•¸å€¼');
                    }
                }
                
                // è§£ææ•¸æ“šå€¼
                if (dataValue.startsWith('0x') || dataValue.startsWith('0X')) {
                    dataValue = parseInt(dataValue, 16);
                } else {
                    dataValue = parseInt(dataValue);
                }
                
                if (isNaN(dataValue) || dataValue < 0 || dataValue > 0xFFFF) {
                    throw new Error('æ•¸æ“šå€¼å¿…é ˆåœ¨ 0 åˆ° 65535 (0xFFFF) ä¹‹é–“');
                }
                
                // å»ºæ§‹å°åŒ…
                const bytes = [];
                bytes[0] = 0x06; // é•·åº¦
                bytes[1] = deviceType; // SA_ID
                
                // ç¬¬ä¸‰å€‹å­—ç¯€ï¼šå»£æ’­å‘½ä»¤ç›´æ¥ä½¿ç”¨å‘½ä»¤IDï¼Œè¨­å‚™æœå‹™éœ€è¦åŠ è®€å¯«æ¨™èªŒ
                if (deviceType === 0x00) {
                    // å»£æ’­å‘½ä»¤ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤ID
                    bytes[2] = serviceId;
                } else {
                    // è¨­å‚™æœå‹™ï¼šéœ€è¦åŠ è®€å¯«æ¨™èªŒ
                    bytes[2] = commandType === 'write' ? (serviceId | 0x80) : serviceId;
                }
                
                bytes[3] = (dataValue >> 8) & 0xFF; // æ•¸æ“šé«˜ä½
                bytes[4] = dataValue & 0xFF; // æ•¸æ“šä½ä½
                bytes[5] = calculateChecksum(bytes.slice(0, 5)); // æ ¡é©—ç¢¼
                
                displayGeneratedPacket(bytes, serviceId, commandType, dataValue, deviceType);
                
            } catch (error) {
                document.getElementById('generateResult').innerHTML = 
                    `<div class="error">âŒ éŒ¯èª¤: ${error.message}</div>`;
                document.getElementById('generateResult').style.display = 'block';
            }
        }

        // ==================== é¡¯ç¤ºç”¢ç”Ÿçš„å°åŒ… ====================
        function displayGeneratedPacket(bytes, serviceId, commandType, dataValue, deviceType) {
            const hexString = bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
            const isBroadcast = (deviceType === 0x00);
            
            let html = '<div class="success">âœ… å°åŒ…ç”¢ç”ŸæˆåŠŸï¼</div>';
            
            // è¦–è¦ºåŒ–å°åŒ…
            html += '<div class="packet-visual">';
            const labels = isBroadcast 
                ? ['é•·åº¦', 'SA_ID', 'å‘½ä»¤é¡å‹', 'æ•¸æ“šé«˜ä½', 'æ•¸æ“šä½ä½', 'æ ¡é©—ç¢¼']
                : ['é•·åº¦', 'SA_ID', 'æœå‹™ID', 'æ•¸æ“šé«˜ä½', 'æ•¸æ“šä½ä½', 'æ ¡é©—ç¢¼'];
            bytes.forEach((byte, index) => {
                const isChecksum = index === 5;
                html += `
                    <div class="packet-byte ${isChecksum ? 'checksum' : ''}">
                        <span class="packet-byte-label">${labels[index]}</span>
                        <div style="font-size: 1.2em; font-weight: bold;">0x${byte.toString(16).toUpperCase().padStart(2, '0')}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            html += `<div class="packet-display">${hexString}</div>`;
            
            // å°åŒ…è©³æƒ…
            html += '<h3>ğŸ“‹ å°åŒ…è©³æƒ…ï¼š</h3>';
            
            const deviceTypes = {
                0x00: 'å»£æ’­',
                0x01: 'ç©ºèª¿',
                0x03: 'æ´—è¡£æ©Ÿ',
                0x04: 'é™¤æ¿•æ©Ÿ',
                0x08: 'ç©ºæ°£æ¸…æ·¨æ©Ÿ',
                0x0E: 'å…¨ç†±äº¤æ›å™¨',
                0x0F: 'é›»é¢¨æ‰‡'
            };
            
            html += `<div class="byte-explain"><strong>SA_ID:</strong><span>0x${bytes[1].toString(16).toUpperCase().padStart(2, '0')} - ${deviceTypes[bytes[1]] || 'æœªçŸ¥è¨­å‚™'}</span></div>`;
            
            if (isBroadcast) {
                // å»£æ’­å‘½ä»¤é¡¯ç¤º
                const broadcastCommandNames = {
                    0x00: 'è¨»å†Š',
                    0x01: 'è®€å–è¨­å‚™é¡å‹',
                    0x02: 'è®€å–ç‰ˆæœ¬',
                    0x03: 'ä¿ç•™',
                    0x04: 'è®€å– SA ID',
                    0x05: 'è®€å–å“ç‰Œ',
                    0x06: 'è®€å–å‹è™Ÿ',
                    0x07: 'è®€å–æœå‹™åˆ—è¡¨',
                    0x08: 'è®€å–ç‹€æ…‹ (Broadcast Query)'
                };
                
                html += `<div class="byte-explain"><strong>å‘½ä»¤é¡å‹:</strong><span>0x${bytes[2].toString(16).toUpperCase().padStart(2, '0')} - ${broadcastCommandNames[bytes[2]] || 'æœªçŸ¥å‘½ä»¤'}</span></div>`;
                
                if (bytes[2] === 0x08) {
                    html += `<div class="byte-explain" style="background: #e7f3ff; border-left: 4px solid #2196F3;"><strong>â­ èªªæ˜:</strong><span>æœ€å¸¸ç”¨çš„å»£æ’­å‘½ä»¤ - æŸ¥è©¢æ‰€æœ‰è¨­å‚™ç‹€æ…‹</span></div>`;
                }
            } else {
                // è¨­å‚™æœå‹™é¡¯ç¤º
                const deviceServices = getServicesForDevice(deviceType);
                const service = deviceServices[serviceId];
                
                html += `<div class="byte-explain"><strong>å‘½ä»¤é¡å‹:</strong><span>${commandType === 'write' ? 'å¯«å…¥ (WRITE)' : 'è®€å– (READ)'}</span></div>`;
                html += `<div class="byte-explain"><strong>æœå‹™åç¨±:</strong><span>${service?.name || 'æœªçŸ¥æœå‹™'}</span></div>`;
                html += `<div class="byte-explain"><strong>æœå‹™ID:</strong><span>0x${serviceId.toString(16).toUpperCase().padStart(2, '0')} ${commandType === 'write' ? 'â†’ 0x' + bytes[2].toString(16).toUpperCase() + ' (åŠ ä¸Šå¯«å…¥æ¨™èªŒ)' : ''}</span></div>`;
                
                if (service?.values && service.values[bytes[4].toString()]) {
                    html += `<div class="byte-explain"><strong>æ•¸å€¼æ„ç¾©:</strong><span>${service.values[bytes[4].toString()]}</span></div>`;
                } else if (service?.unit) {
                    html += `<div class="byte-explain"><strong>æ•¸å€¼æ„ç¾©:</strong><span>${dataValue} ${service.unit}</span></div>`;
                }
            }
            
            html += `<div class="byte-explain"><strong>æ•¸æ“šå€¼:</strong><span>${dataValue} (0x${dataValue.toString(16).toUpperCase().padStart(4, '0')})</span></div>`;
            
            if (dataValue === 0xFFFF) {
                html += `<div class="byte-explain"><strong>æ•¸å€¼èªªæ˜:</strong><span>ğŸ” æŸ¥è©¢æŒ‡ä»¤</span></div>`;
            }
            
            html += `<div class="byte-explain"><strong>æ ¡é©—ç¢¼:</strong><span>0x${bytes[5].toString(16).toUpperCase()}</span></div>`;
            
            // è¤‡è£½æŒ‰éˆ•
            html += `<button class="copy-btn" onclick="copyToClipboard('${hexString}')">ğŸ“‹ è¤‡è£½å°åŒ…</button>`;
            html += `<button class="copy-btn" onclick="copyToClipboard('${bytes.map(b => '0x' + b.toString(16).toUpperCase().padStart(2, '0')).join(', ')}')">ğŸ“‹ è¤‡è£½ C é™£åˆ—æ ¼å¼</button>`;
            
            document.getElementById('generateResult').innerHTML = html;
            document.getElementById('generateResult').style.display = 'block';
        }

        // ==================== è§£æå°åŒ… ====================
        function parsePacket() {
            try {
                let input = document.getElementById('packetInput').value.trim();
                
                if (!input) {
                    throw new Error('è«‹è¼¸å…¥å°åŒ…å…§å®¹');
                }
                
                // ç§»é™¤æ‰€æœ‰åˆ†éš”ç¬¦è™Ÿå’Œ 0x å‰ç¶´
                input = input.replace(/0x/gi, '').replace(/[:\s-]/g, '');
                
                if (input.length < 12) {
                    throw new Error('å°åŒ…é•·åº¦ä¸è¶³ (è‡³å°‘éœ€è¦ 6 å€‹ä½å…ƒçµ„ = 12 å€‹åå…­é€²ä½å­—å…ƒ)');
                }
                
                if (input.length % 2 !== 0) {
                    throw new Error('å°åŒ…é•·åº¦å¿…é ˆæ˜¯å¶æ•¸ (æ¯å€‹ä½å…ƒçµ„2å€‹åå…­é€²ä½å­—å…ƒ)');
                }
                
                // è½‰æ›ç‚ºä½å…ƒçµ„é™£åˆ—
                const bytes = [];
                for (let i = 0; i < input.length; i += 2) {
                    bytes.push(parseInt(input.substr(i, 2), 16));
                }
                
                // æª¢æ¸¬æ˜¯å¦ç‚ºæœå‹™åˆ—è¡¨æ ¼å¼
                // æœå‹™åˆ—è¡¨ç‰¹å¾µï¼šé•·åº¦ç‚º3çš„å€æ•¸+1ï¼ˆæ ¡é©—ç¢¼ï¼‰ï¼Œä¸”é€šå¸¸è¼ƒé•·ï¼ˆ>20 bytesï¼‰
                const isLikelyServiceList = (bytes.length > 20) && (bytes.length % 3 === 1);
                
                // æª¢æ¸¬æ˜¯å¦ç‚ºæ¨™æº–å°åŒ…æ ¼å¼ï¼ˆç¬¬ä¸€å€‹å­—ç¯€æ‡‰è©²ç­‰æ–¼å¯¦éš›é•·åº¦ï¼‰
                const isStandardPacket = (bytes[0] === bytes.length);
                
                if (!isStandardPacket && isLikelyServiceList) {
                    displayServiceList(bytes);
                } else {
                    displayParsedPacket(bytes);
                }
                
            } catch (error) {
                document.getElementById('parseResult').innerHTML = 
                    `<div class="error">âŒ éŒ¯èª¤: ${error.message}</div>`;
                document.getElementById('parseResult').style.display = 'block';
            }
        }

        // ==================== é¡¯ç¤ºè§£æçš„å°åŒ… ====================
        function displayParsedPacket(bytes) {
            const length = bytes[0];
            const calculatedChecksum = calculateChecksum(bytes.slice(0, bytes.length - 1));
            const packetChecksum = bytes[bytes.length - 1];
            const isValid = calculatedChecksum === packetChecksum;
            
            let html = '';
            
            // é•·åº¦æª¢æŸ¥
            if (bytes.length !== length) {
                html += `<div class="warning">âš ï¸ è­¦å‘Šï¼šå°åŒ…é•·åº¦æ¬„ä½é¡¯ç¤º ${length} bytesï¼Œä½†å¯¦éš›æ”¶åˆ° ${bytes.length} bytes</div>`;
            }
            
            // æ ¡é©—ç¢¼æª¢æŸ¥
            if (isValid) {
                html += '<div class="success">âœ… æ ¡é©—ç¢¼æ­£ç¢º</div>';
            } else {
                html += `<div class="error">âŒ æ ¡é©—ç¢¼éŒ¯èª¤ï¼<br>è¨ˆç®—å€¼: 0x${calculatedChecksum.toString(16).toUpperCase()}<br>å°åŒ…å€¼: 0x${packetChecksum.toString(16).toUpperCase()}</div>`;
            }
            
            // è¦–è¦ºåŒ–å°åŒ…
            const hexString = bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
            html += `<div class="packet-display">${hexString}</div>`;
            
            // åˆ¤æ–·æ˜¯å¦ç‚ºå»£æ’­å‘½ä»¤
            const saId = bytes[1];
            const isBroadcast = (saId === 0x00);
            const byte2 = bytes[2];
            
            // è¦–è¦ºåŒ–
            html += '<div class="packet-visual">';
            bytes.forEach((byte, index) => {
                let labels;
                if (index === 0) {
                    labels = 'é•·åº¦';
                } else if (index === 1) {
                    labels = 'SA_ID';
                } else if (index === 2) {
                    labels = isBroadcast ? 'å‘½ä»¤é¡å‹' : 'æœå‹™ID';
                } else if (index === bytes.length - 1) {
                    labels = 'æ ¡é©—ç¢¼';
                } else {
                    labels = 'æ•¸æ“š';
                }
                
                const isChecksum = index === bytes.length - 1;
                html += `
                    <div class="packet-byte ${isChecksum ? 'checksum' : ''}">
                        <span class="packet-byte-label">${labels} [${index}]</span>
                        <div style="font-size: 1.2em; font-weight: bold;">0x${byte.toString(16).toUpperCase().padStart(2, '0')}</div>
                        <div style="font-size: 0.8em; opacity: 0.8;">${byte}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            // è§£æå…§å®¹
            html += '<h3>ğŸ“Š å°åŒ…è§£æï¼š</h3>';
            
            const deviceTypes = {
                0x00: 'å»£æ’­',
                0x01: 'ç©ºèª¿',
                0x03: 'æ´—è¡£æ©Ÿ',
                0x04: 'é™¤æ¿•æ©Ÿ',
                0x08: 'ç©ºæ°£æ¸…æ·¨æ©Ÿ',
                0x0E: 'å…¨ç†±äº¤æ›å™¨',
                0x0F: 'é›»é¢¨æ‰‡'
            };
            
            html += `<div class="byte-explain"><strong>å°åŒ…é•·åº¦:</strong><span>${length} bytes (0x${length.toString(16).toUpperCase()})</span></div>`;
            html += `<div class="byte-explain"><strong>SA_ID:</strong><span>0x${saId.toString(16).toUpperCase().padStart(2, '0')} - ${deviceTypes[saId] || 'æœªçŸ¥è¨­å‚™'}</span></div>`;
            
            if (isBroadcast) {
                // å»£æ’­å‘½ä»¤çš„è§£æ
                const broadcastCommands = {
                    0x00: 'è¨»å†Š',
                    0x01: 'è®€å–è¨­å‚™é¡å‹',
                    0x02: 'è®€å–ç‰ˆæœ¬',
                    0x03: 'ä¿ç•™',
                    0x04: 'è®€å– SA ID',
                    0x05: 'è®€å–å“ç‰Œ',
                    0x06: 'è®€å–å‹è™Ÿ',
                    0x07: 'è®€å–æœå‹™åˆ—è¡¨',
                    0x08: 'è®€å–ç‹€æ…‹ (Broadcast Query)'
                };
                
                const cmdName = broadcastCommands[byte2] || 'æœªçŸ¥å‘½ä»¤';
                html += `<div class="byte-explain"><strong>å‘½ä»¤é¡å‹:</strong><span>0x${byte2.toString(16).toUpperCase().padStart(2, '0')} - ${cmdName}</span></div>`;
                
                if (byte2 === 0x08) {
                    html += `<div class="byte-explain" style="background: #e7f3ff; border-left: 4px solid #2196F3;"><strong>â­ èªªæ˜:</strong><span>å»£æ’­æŸ¥è©¢å‘½ä»¤ - è¦æ±‚æ‰€æœ‰è¨­å‚™å›å ±å®Œæ•´ç‹€æ…‹</span></div>`;
                }
                
            } else {
                // ä¸€èˆ¬è¨­å‚™å‘½ä»¤çš„è§£æ
                const isWrite = (byte2 & 0x80) !== 0;
                const serviceId = byte2 & 0x7F;
                
                html += `<div class="byte-explain"><strong>å‘½ä»¤é¡å‹:</strong><span>${isWrite ? 'å¯«å…¥ (WRITE)' : 'è®€å– (READ)'}<span class="badge ${isWrite ? 'badge-write' : 'badge-read'}">${isWrite ? 'W' : 'R'}</span></span></div>`;
                
                const deviceServices = getServicesForDevice(saId);
                const service = deviceServices[serviceId];
                html += `<div class="byte-explain"><strong>æœå‹™ID:</strong><span>0x${serviceId.toString(16).toUpperCase().padStart(2, '0')} - ${service?.name || 'æœªçŸ¥æœå‹™'}</span></div>`;
            }
            
            if (bytes.length === 6) {
                // æ¨™æº– 6 å­—ç¯€å°åŒ…
                const dataHigh = bytes[3];
                const dataLow = bytes[4];
                const dataValue = (dataHigh << 8) | dataLow;
                
                html += `<div class="byte-explain"><strong>æ•¸æ“šå€¼:</strong><span>0x${dataValue.toString(16).toUpperCase().padStart(4, '0')} (${dataValue})</span></div>`;
                
                if (dataValue === 0xFFFF) {
                    if (isBroadcast && byte2 === 0x08) {
                        html += `<div class="byte-explain"><strong>æ•¸å€¼æ„ç¾©:</strong><span>ğŸ” æŸ¥è©¢æ‰€æœ‰è¨­å‚™çš„æ‰€æœ‰æœå‹™ç‹€æ…‹</span></div>`;
                    } else {
                        html += `<div class="byte-explain"><strong>æ•¸å€¼æ„ç¾©:</strong><span>ğŸ” æŸ¥è©¢æŒ‡ä»¤</span></div>`;
                    }
                } else if (!isBroadcast) {
                    const serviceId = byte2 & 0x7F;
                    const deviceServices = getServicesForDevice(saId);
                    const service = deviceServices[serviceId];
                    
                    if (service?.values && service.values[dataLow.toString()]) {
                        html += `<div class="byte-explain"><strong>æ•¸å€¼æ„ç¾©:</strong><span>${service.values[dataLow.toString()]}</span></div>`;
                    } else if (service?.unit) {
                        html += `<div class="byte-explain"><strong>æ•¸å€¼æ„ç¾©:</strong><span>${dataValue} ${service.unit}</span></div>`;
                    }
                }
            } else if (byte2 === 0x08 && bytes.length > 6) {
                // ç‹€æ…‹æŸ¥è©¢å›æ‡‰ - é•·å°åŒ…
                html += '<h3 style="margin-top: 20px;">ğŸ“Š ç‹€æ…‹æŸ¥è©¢å›æ‡‰ - è©³ç´°è³‡æ–™ï¼š</h3>';
                html += '<table class="info-table">';
                html += '<tr><th>é …æ¬¡</th><th>æœå‹™ID</th><th>æœå‹™åç¨±</th><th>æ•¸å€¼ (Hex)</th><th>æ•¸å€¼ (Dec)</th><th>æ„ç¾©</th></tr>';
                
                const deviceServices = isBroadcast ? SERVICES : getServicesForDevice(saId);
                
                let rowNum = 1;
                for (let i = 3; i < bytes.length - 1; i += 3) {
                    const svcId = bytes[i];
                    const dataH = bytes[i + 1];
                    const dataL = bytes[i + 2];
                    const value = (dataH << 8) | dataL;
                    
                    const svcInfo = deviceServices[svcId];
                    const svcName = svcInfo?.name || 'æœªçŸ¥æœå‹™';
                    
                    let meaning = '';
                    if (value === 0xFFFF) {
                        meaning = 'âŒ ç„¡æ•ˆ/ä¸æ”¯æ´';
                    } else if (svcInfo?.values && svcInfo.values[dataL.toString()]) {
                        meaning = svcInfo.values[dataL.toString()];
                    } else if (svcInfo?.unit) {
                        meaning = `${value} ${svcInfo.unit}`;
                    } else {
                        meaning = value.toString();
                    }
                    
                    html += `<tr>
                        <td>${rowNum++}</td>
                        <td><code>0x${svcId.toString(16).toUpperCase().padStart(2, '0')}</code></td>
                        <td>${svcName}</td>
                        <td><code>0x${value.toString(16).toUpperCase().padStart(4, '0')}</code></td>
                        <td>${value}</td>
                        <td><strong>${meaning}</strong></td>
                    </tr>`;
                }
                
                html += '</table>';
                
                // é‡è¦è³‡è¨Šæ‘˜è¦
                html += '<h3 style="margin-top: 20px;">ğŸŒŸ é‡è¦è³‡è¨Šæ‘˜è¦ï¼š</h3>';
                html += '<div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">';
                
                for (let i = 3; i < bytes.length - 1; i += 3) {
                    const svcId = bytes[i];
                    const value = (bytes[i + 1] << 8) | bytes[i + 2];
                    
                    if (svcId === 0x00) {
                        html += `<div class="byte-explain"><strong>ğŸ’¡ é›»æºç‹€æ…‹:</strong><span style="color: ${value === 1 ? 'green' : 'red'}; font-weight: bold;">${value === 1 ? 'âœ… é–‹æ©Ÿ ON' : 'â­• é—œæ©Ÿ OFF'}</span></div>`;
                    } else if (svcId === 0x01 && value !== 0xFFFF) {
                        const modes = ['COOL å†·æ°£', 'DRY é™¤æ¿•', 'FAN_ONLY é€é¢¨', 'AUTO è‡ªå‹•', 'HEAT æš–æ°£'];
                        html += `<div class="byte-explain"><strong>ğŸŒ¡ï¸ é‹è½‰æ¨¡å¼:</strong><span>${modes[value] || value}</span></div>`;
                    } else if (svcId === 0x02 && value !== 0xFFFF) {
                        const fans = ['AUTO è‡ªå‹•', 'QUIET éœéŸ³', 'LOW ä½é€Ÿ', 'MEDIUM ä¸­é€Ÿ', 'HIGH é«˜é€Ÿ'];
                        html += `<div class="byte-explain"><strong>ğŸ’¨ é¢¨é€Ÿ:</strong><span>${fans[value] || value}</span></div>`;
                    } else if (svcId === 0x03 && value !== 0xFFFF) {
                        html += `<div class="byte-explain"><strong>ğŸ¯ ç›®æ¨™æº«åº¦:</strong><span>${value}Â°C</span></div>`;
                    } else if (svcId === 0x04 && value !== 0xFFFF) {
                        html += `<div class="byte-explain"><strong>ğŸ  å®¤å…§æº«åº¦:</strong><span>${value}Â°C</span></div>`;
                    } else if (svcId === 0x14 && value !== 0xFFFF) {
                        html += `<div class="byte-explain"><strong>ğŸ’§ å®¤å…§æ¿•åº¦:</strong><span>${value}%</span></div>`;
                    } else if (svcId === 0x21 && value !== 0xFFFF) {
                        html += `<div class="byte-explain"><strong>ğŸŒ¤ï¸ å®¤å¤–æº«åº¦:</strong><span>${value}Â°C</span></div>`;
                    }
                }
                
                html += '</div>';
            }
            
            html += `<div class="byte-explain"><strong>æ ¡é©—ç¢¼:</strong><span>0x${bytes[bytes.length - 1].toString(16).toUpperCase()} ${isValid ? 'âœ…' : 'âŒ'}</span></div>`;
            
            document.getElementById('parseResult').innerHTML = html;
            document.getElementById('parseResult').style.display = 'block';
        }

        // ==================== å¡«å……ç¯„ä¾‹ ====================
        function fillExample(example) {
            document.getElementById('packetInput').value = example;
            parsePacket();
        }

        // ==================== é¡¯ç¤ºæœå‹™åˆ—è¡¨ ====================
        function displayServiceList(bytes) {
            let html = '';
            
            html += '<div class="success">âœ… æª¢æ¸¬åˆ°æœå‹™åˆ—è¡¨æ ¼å¼</div>';
            html += '<div class="help-text" style="margin: 15px 0;">é€™æ˜¯è¨­å‚™å›æ‡‰ã€Œ0x07 - è®€å–æœå‹™åˆ—è¡¨ã€å‘½ä»¤çš„è³‡æ–™ï¼Œåˆ—å‡ºè¨­å‚™æ”¯æ´çš„æ‰€æœ‰æœå‹™åŠå…¶è®€å¯«æ¬Šé™ã€‚</div>';
            
            // è¦–è¦ºåŒ–åŸå§‹æ•¸æ“š
            const hexString = bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
            html += `<div class="packet-display">${hexString}</div>`;
            
            html += `<div class="byte-explain"><strong>ç¸½å­—ç¯€æ•¸:</strong><span>${bytes.length} bytes</span></div>`;
            html += `<div class="byte-explain"><strong>æœå‹™æ•¸é‡:</strong><span>${Math.floor((bytes.length - 1) / 3)} å€‹æœå‹™</span></div>`;
            html += `<div class="byte-explain"><strong>æœ€å¾Œå­—ç¯€:</strong><span>0x${bytes[bytes.length-1].toString(16).toUpperCase()} (å¯èƒ½æ˜¯æ ¡é©—ç¢¼)</span></div>`;
            
            // æœå‹™åˆ—è¡¨è¡¨æ ¼
            html += '<h3 style="margin-top: 20px;">ğŸ“‹ æœå‹™åˆ—è¡¨è§£æï¼š</h3>';
            html += '<table class="info-table">';
            html += '<tr><th>åºè™Ÿ</th><th>æœå‹™ID</th><th>æœå‹™åç¨±</th><th>æ¬Šé™</th><th>èƒ½åŠ›å€¼ (Hex)</th><th>èƒ½åŠ›ç¯„åœ/èªªæ˜</th></tr>';
            
            let writableCount = 0;
            let readonlyCount = 0;
            
            for (let i = 0; i < bytes.length - 1; i += 3) {
                if (i + 2 >= bytes.length) break;
                
                const svcByte = bytes[i];
                const dataH = bytes[i + 1];
                const dataL = bytes[i + 2];
                const value = (dataH << 8) | dataL;
                
                const isWritable = (svcByte & 0x80) !== 0;
                const svcId = svcByte & 0x7F;
                
                // å˜—è©¦å¾å¤šå€‹è¨­å‚™é¡å‹ä¸­æŸ¥æ‰¾æœå‹™åç¨±å’Œå–®ä½
                let svcName = 'æœªçŸ¥æœå‹™';
                let svcUnit = null;
                let svcValues = null;
                const allDevices = ['0x01', '0x03', '0x04', '0x08', '0x0E', '0x0F'];
                for (const deviceKey of allDevices) {
                    const deviceServices = SERVICES_BY_DEVICE[deviceKey];
                    if (deviceServices && deviceServices[svcId]) {
                        svcName = deviceServices[svcId].name;
                        svcUnit = deviceServices[svcId].unit;
                        svcValues = deviceServices[svcId].values;
                        break;
                    }
                }
                
                const permission = isWritable ? 'âœï¸ å¯è®€å¯«' : 'ğŸ‘ï¸ åªè®€';
                const permissionClass = isWritable ? 'badge-write' : 'badge-read';
                
                if (isWritable) writableCount++;
                else readonlyCount++;
                
                const rowNum = Math.floor(i / 3) + 1;
                
                // æ™ºèƒ½è§£æèƒ½åŠ›å€¼
                let capabilityText = '';
                const rangeUnits = ['Â°C', '%', 'åˆ†é˜', 'å°æ™‚', 'A', 'V', 'W', 'kWh', 'Î¼g/mÂ³'];
                
                if (rangeUnits.includes(svcUnit)) {
                    // æœ‰å–®ä½çš„æœå‹™ï¼šé«˜ä½=æœ€å°å€¼ï¼Œä½ä½=æœ€å¤§å€¼
                    if (dataH === 0 && dataL === 0) {
                        capabilityText = `0 ${svcUnit}`;
                    } else if (dataH === 0) {
                        capabilityText = `0 ~ ${dataL} ${svcUnit}`;
                    } else {
                        capabilityText = `${dataH} ~ ${dataL} ${svcUnit}`;
                    }
                } else if (svcValues) {
                    // æœ‰é å®šç¾©å€¼çš„æœå‹™ï¼šé¡¯ç¤ºé¸é …æ•¸é‡
                    const optionCount = Object.keys(svcValues).length;
                    capabilityText = `${optionCount} å€‹é¸é … (0-${value})`;
                } else if (value === 0xFFFF) {
                    // 0xFFFF é€šå¸¸è¡¨ç¤ºä¸é™åˆ¶æˆ–æŸ¥è©¢
                    capabilityText = 'ç„¡é™åˆ¶/æŸ¥è©¢';
                } else {
                    // å…¶ä»–æœå‹™ï¼šç›´æ¥é¡¯ç¤ºæ•¸å€¼
                    capabilityText = value.toString();
                }
                
                html += `<tr>
                    <td>${rowNum}</td>
                    <td><code>0x${svcId.toString(16).toUpperCase().padStart(2, '0')}</code></td>
                    <td>${svcName}</td>
                    <td><span class="badge ${permissionClass}">${permission}</span></td>
                    <td><code>0x${value.toString(16).toUpperCase().padStart(4, '0')}</code></td>
                    <td><strong>${capabilityText}</strong></td>
                </tr>`;
            }
            
            html += '</table>';
            
            // çµ±è¨ˆè³‡è¨Š
            html += '<h3 style="margin-top: 20px;">ğŸ“Š çµ±è¨ˆè³‡è¨Šï¼š</h3>';
            html += '<div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">';
            html += `<div class="byte-explain"><strong>ç¸½æœå‹™æ•¸:</strong><span>${writableCount + readonlyCount} å€‹</span></div>`;
            html += `<div class="byte-explain"><strong>å¯è®€å¯«æœå‹™:</strong><span class="badge badge-write">${writableCount} å€‹ âœï¸</span></div>`;
            html += `<div class="byte-explain"><strong>åªè®€æœå‹™:</strong><span class="badge badge-read">${readonlyCount} å€‹ ğŸ‘ï¸</span></div>`;
            html += '</div>';
            
            // èªªæ˜
            html += '<h3 style="margin-top: 20px;">ğŸ’¡ èªªæ˜ï¼š</h3>';
            html += '<div class="help-text">';
            html += '<strong>æ ¼å¼ï¼š</strong>æ¯å€‹æœå‹™ä½” 3 bytes â†’ [æœå‹™ID] [èƒ½åŠ›å€¼é«˜ä½] [èƒ½åŠ›å€¼ä½ä½]<br><br>';
            html += '<strong>æœå‹™IDè¦å‰‡ï¼š</strong><br>';
            html += 'â€¢ å¦‚æœ >= 0x80 (æœ€é«˜ä½ç‚º1) â†’ å¯è®€å¯« âœï¸ (å¯ä»¥æ§åˆ¶)<br>';
            html += 'â€¢ å¦‚æœ < 0x80 (æœ€é«˜ä½ç‚º0) â†’ åªè®€ ğŸ‘ï¸ (åªèƒ½æŸ¥è©¢)<br><br>';
            html += '<strong>èƒ½åŠ›å€¼ç·¨ç¢¼ï¼š</strong><br>';
            html += 'â€¢ <strong>æœ‰å–®ä½çš„æœå‹™</strong> (æº«åº¦ã€æ¿•åº¦ã€æ™‚é–“ç­‰)ï¼š<br>';
            html += '  â†’ é«˜ä½å­—ç¯€ = æœ€å°å€¼ï¼Œä½ä½å­—ç¯€ = æœ€å¤§å€¼<br>';
            html += '  â†’ ä¾‹å¦‚ï¼š<code>0x1E5A</code> = <code>0x1E (30)</code> ~ <code>0x5A (90)</code> â†’ <strong>30% ~ 90%</strong><br>';
            html += '  â†’ ä¾‹å¦‚ï¼š<code>0x1020</code> = <code>0x10 (16)</code> ~ <code>0x20 (32)</code> â†’ <strong>16Â°C ~ 32Â°C</strong><br>';
            html += 'â€¢ <strong>é–‹é—œ/é¸é …é¡æœå‹™</strong> (é›»æºã€æ¨¡å¼ç­‰)ï¼š<br>';
            html += '  â†’ æ•¸å€¼è¡¨ç¤ºæœ€å¤§é¸é …æ•¸é‡æˆ–ç‹€æ…‹æ•¸<br>';
            html += '  â†’ ä¾‹å¦‚ï¼š<code>0x0003</code> â†’ æœ‰ 0-3 å…± 4 å€‹é¸é …<br><br>';
            html += '<strong>å¦‚ä½•ç²å¾—ï¼š</strong>ç™¼é€å»£æ’­å‘½ä»¤ <code>06:00:07:FF:FF:xx</code> (0x07 = è®€å–æœå‹™åˆ—è¡¨)<br>';
            html += '<strong>ç”¨é€”ï¼š</strong>è®“æ§åˆ¶å™¨è‡ªå‹•äº†è§£è¨­å‚™æ”¯æ´å“ªäº›åŠŸèƒ½åŠå…¶æœ‰æ•ˆç¯„åœï¼Œç„¡éœ€é å…ˆçŸ¥é“è¨­å‚™å‹è™Ÿ';
            html += '</div>';
            
            document.getElementById('parseResult').innerHTML = html;
            document.getElementById('parseResult').style.display = 'block';
        }

        // ==================== æ‰¹æ¬¡è™•ç† ====================
        function batchProcess(mode) {
            try {
                const input = document.getElementById('batchInput').value.trim();
                if (!input) {
                    throw new Error('è«‹è¼¸å…¥æ‰¹æ¬¡å°åŒ…');
                }
                
                const lines = input.split('\n').filter(line => line.trim());
                let html = '';
                let successCount = 0;
                let errorCount = 0;
                
                if (mode === 'verify') {
                    html += '<h3>ğŸ“‹ æ‰¹æ¬¡æ ¡é©—çµæœï¼š</h3>';
                    html += '<table class="info-table">';
                    html += '<tr><th>åºè™Ÿ</th><th>å°åŒ…</th><th>æ ¡é©—çµæœ</th><th>è©³æƒ…</th></tr>';
                    
                    lines.forEach((line, index) => {
                        try {
                            let cleanLine = line.replace(/0x/gi, '').replace(/[:\s-]/g, '');
                            const bytes = [];
                            for (let i = 0; i < cleanLine.length; i += 2) {
                                bytes.push(parseInt(cleanLine.substr(i, 2), 16));
                            }
                            
                            const calculatedChecksum = calculateChecksum(bytes.slice(0, bytes.length - 1));
                            const packetChecksum = bytes[bytes.length - 1];
                            const isValid = calculatedChecksum === packetChecksum;
                            
                            if (isValid) successCount++;
                            else errorCount++;
                            
                            const hexString = bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
                            html += `<tr>
                                <td>${index + 1}</td>
                                <td><code>${hexString}</code></td>
                                <td style="color: ${isValid ? 'green' : 'red'}; font-weight: bold;">${isValid ? 'âœ… æ­£ç¢º' : 'âŒ éŒ¯èª¤'}</td>
                                <td>${isValid ? '' : `è¨ˆç®—: 0x${calculatedChecksum.toString(16).toUpperCase()}, å°åŒ…: 0x${packetChecksum.toString(16).toUpperCase()}`}</td>
                            </tr>`;
                        } catch (e) {
                            errorCount++;
                            html += `<tr>
                                <td>${index + 1}</td>
                                <td><code>${line}</code></td>
                                <td style="color: red; font-weight: bold;">âŒ æ ¼å¼éŒ¯èª¤</td>
                                <td>${e.message}</td>
                            </tr>`;
                        }
                    });
                    
                    html += '</table>';
                    html += `<div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">`;
                    html += `<strong>çµ±è¨ˆï¼š</strong> ç¸½è¨ˆ ${lines.length} å€‹å°åŒ…ï¼Œ`;
                    html += `<span style="color: green;">æˆåŠŸ ${successCount} å€‹</span>ï¼Œ`;
                    html += `<span style="color: red;">å¤±æ•— ${errorCount} å€‹</span>`;
                    html += `</div>`;
                    
                } else if (mode === 'parse') {
                    html += '<h3>ğŸ“Š æ‰¹æ¬¡è§£æçµæœï¼š</h3>';
                    
                    lines.forEach((line, index) => {
                        try {
                            let cleanLine = line.replace(/0x/gi, '').replace(/[:\s-]/g, '');
                            const bytes = [];
                            for (let i = 0; i < cleanLine.length; i += 2) {
                                bytes.push(parseInt(cleanLine.substr(i, 2), 16));
                            }
                            
                            const hexString = bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
                            const saId = bytes[1];
                            const serviceIdByte = bytes[2];
                            const isWrite = (serviceIdByte & 0x80) !== 0;
                            const serviceId = serviceIdByte & 0x7F;
                            const service = SERVICES[serviceId];
                            
                            const deviceTypes = {
                                0x00: 'å»£æ’­', 0x01: 'ç©ºèª¿', 0x03: 'æ´—è¡£æ©Ÿ',
                                0x04: 'é™¤æ¿•æ©Ÿ', 0x08: 'ç©ºæ°£æ¸…æ·¨æ©Ÿ', 0x0E: 'ERV', 0x0F: 'é›»é¢¨æ‰‡'
                            };
                            
                            html += `<div style="border: 2px solid #dee2e6; border-radius: 8px; padding: 15px; margin: 15px 0; background: white;">`;
                            html += `<h4 style="color: #667eea; margin-bottom: 10px;">å°åŒ… #${index + 1}</h4>`;
                            html += `<div class="packet-display" style="margin: 10px 0;">${hexString}</div>`;
                            html += `<div class="byte-explain"><strong>è¨­å‚™:</strong><span>${deviceTypes[saId] || 'æœªçŸ¥'} (0x${saId.toString(16).toUpperCase()})</span></div>`;
                            html += `<div class="byte-explain"><strong>æœå‹™:</strong><span>${service?.name || 'æœªçŸ¥'} (0x${serviceId.toString(16).toUpperCase()})</span></div>`;
                            html += `<div class="byte-explain"><strong>é¡å‹:</strong><span>${isWrite ? 'å¯«å…¥ WRITE' : 'è®€å– READ'}</span></div>`;
                            
                            if (bytes.length === 6) {
                                const dataValue = (bytes[3] << 8) | bytes[4];
                                html += `<div class="byte-explain"><strong>æ•¸å€¼:</strong><span>${dataValue} (0x${dataValue.toString(16).toUpperCase().padStart(4, '0')})</span></div>`;
                            }
                            
                            html += `</div>`;
                            successCount++;
                        } catch (e) {
                            html += `<div class="error" style="margin: 15px 0;">å°åŒ… #${index + 1}: ${line}<br>éŒ¯èª¤: ${e.message}</div>`;
                            errorCount++;
                        }
                    });
                    
                    html += `<div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">`;
                    html += `<strong>çµ±è¨ˆï¼š</strong> ç¸½è¨ˆ ${lines.length} å€‹å°åŒ…ï¼Œ`;
                    html += `<span style="color: green;">æˆåŠŸ ${successCount} å€‹</span>ï¼Œ`;
                    html += `<span style="color: red;">å¤±æ•— ${errorCount} å€‹</span>`;
                    html += `</div>`;
                }
                
                document.getElementById('batchResult').innerHTML = html;
                document.getElementById('batchResult').style.display = 'block';
                
            } catch (error) {
                document.getElementById('batchResult').innerHTML = 
                    `<div class="error">âŒ éŒ¯èª¤: ${error.message}</div>`;
                document.getElementById('batchResult').style.display = 'block';
            }
        }

        // ==================== é¡¯ç¤ºæœå‹™åˆ—è¡¨ ====================
        function displayServices() {
            // ç²å–é¸æ“‡çš„è¨­å‚™é¡å‹
            const deviceTypeSelect = document.getElementById('serviceDeviceType');
            const deviceTypeKey = deviceTypeSelect ? deviceTypeSelect.value : '0x01';
            const selectedServices = SERVICES_BY_DEVICE[deviceTypeKey] || SERVICES_BY_DEVICE['0x01'];
            
            let html = '';
            const categories = {};
            
            // æŒ‰åˆ†é¡æ•´ç†æœå‹™
            Object.entries(selectedServices).forEach(([id, info]) => {
                if (!categories[info.category]) {
                    categories[info.category] = [];
                }
                categories[info.category].push({id: parseInt(id), info});
            });
            
            // ç”Ÿæˆ HTML
            Object.entries(categories).forEach(([category, items]) => {
                html += `<h3 style="margin: 20px 0 10px 0; color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ğŸ“Œ ${category}</h3>`;
                items.sort((a, b) => a.id - b.id).forEach(({id, info}) => {
                    const hexId = id.toString(16).toUpperCase().padStart(2, '0');
                    
                    // ç”Ÿæˆæ•¸æ“šå€¼åˆ—è¡¨çš„ HTML
                    let valuesHtml = '';
                    
                    if (info.values) {
                        // æœ‰é å®šç¾©å€¼çš„æœå‹™
                        valuesHtml = '<div style="margin-top: 8px; padding: 10px; background: #f8f9fa; border-radius: 5px;">';
                        valuesHtml += '<div style="margin-bottom: 5px; font-weight: 600; color: #495057;">ğŸ“‹ å¯ç”¨æ•¸æ“šå€¼ï¼š</div>';
                        valuesHtml += '<table style="width: 100%; border-collapse: collapse;">';
                        
                        Object.entries(info.values).forEach(([val, desc]) => {
                            const hexVal = parseInt(val).toString(16).toUpperCase().padStart(4, '0');
                            valuesHtml += `
                                <tr style="border-bottom: 1px solid #dee2e6;">
                                    <td style="padding: 5px; font-family: monospace; color: #667eea; width: 100px;">0x${hexVal}</td>
                                    <td style="padding: 5px; color: #28a745; width: 60px; text-align: center;">(${val})</td>
                                    <td style="padding: 5px; color: #495057;">${desc}</td>
                                </tr>`;
                        });
                        
                        valuesHtml += '</table>';
                        valuesHtml += '<div style="margin-top: 8px; font-size: 0.9em; color: #6c757d;">ğŸ’¡ æŸ¥è©¢æ­¤æœå‹™ï¼šä½¿ç”¨ 0xFFFF (65535)</div>';
                        valuesHtml += '</div>';
                        
                    } else if (info.unit) {
                        // æœ‰å–®ä½çš„æœå‹™ï¼ˆæº«åº¦ã€æ¿•åº¦ç­‰ï¼‰
                        valuesHtml = '<div style="margin-top: 8px; padding: 10px; background: #f8f9fa; border-radius: 5px;">';
                        valuesHtml += `<div style="color: #495057;"><strong>å–®ä½ï¼š</strong>${info.unit}</div>`;
                        
                        if (info.unit === 'Â°C') {
                            valuesHtml += '<div style="margin-top: 5px; color: #6c757d;">å»ºè­°ç¯„åœï¼š16Â°C ~ 30Â°C</div>';
                            valuesHtml += '<div style="margin-top: 5px; font-size: 0.9em; color: #6c757d;">æ•¸å€¼ç¯„åœï¼š0x0010 (16) ~ 0x001E (30)</div>';
                        } else if (info.unit === '%') {
                            valuesHtml += '<div style="margin-top: 5px; color: #6c757d;">å»ºè­°ç¯„åœï¼š30% ~ 90%</div>';
                            valuesHtml += '<div style="margin-top: 5px; font-size: 0.9em; color: #6c757d;">æ•¸å€¼ç¯„åœï¼š0x001E (30) ~ 0x005A (90)</div>';
                        }
                        
                        valuesHtml += '<div style="margin-top: 8px; font-size: 0.9em; color: #6c757d;">ğŸ’¡ æŸ¥è©¢æ­¤æœå‹™ï¼šä½¿ç”¨ 0xFFFF (65535)</div>';
                        valuesHtml += '</div>';
                        
                    } else {
                        // æ²’æœ‰é å®šç¾©å€¼çš„æœå‹™
                        valuesHtml = '<div style="margin-top: 8px; padding: 10px; background: #f8f9fa; border-radius: 5px;">';
                        valuesHtml += '<div style="color: #6c757d;">æ­¤æœå‹™æ²’æœ‰é å®šç¾©æ•¸å€¼ï¼Œè«‹åƒè€ƒè¨­å‚™æ–‡æª”</div>';
                        valuesHtml += '<div style="margin-top: 8px; font-size: 0.9em; color: #6c757d;">ğŸ’¡ æŸ¥è©¢æ­¤æœå‹™ï¼šä½¿ç”¨ 0xFFFF (65535)</div>';
                        valuesHtml += '</div>';
                    }
                    
                    html += `
                        <details class="service-item" style="margin-bottom: 10px; border: 1px solid #dee2e6; border-radius: 8px; padding: 10px;">
                            <summary style="cursor: pointer; font-weight: 500; user-select: none; list-style: none; display: flex; align-items: center;">
                                <span style="margin-right: 8px;">â–¶</span>
                                <strong style="color: #667eea;">0x${hexId}</strong>
                                <span style="margin: 0 8px;">-</span>
                                <span>${info.name}</span>
                                ${info.unit ? `<span style="color: #6c757d; font-size: 0.9em; margin-left: 8px;">(${info.unit})</span>` : ''}
                                ${info.values ? `<span style="color: #28a745; font-size: 0.9em; margin-left: auto;">[${Object.keys(info.values).length} å€‹é¸é …]</span>` : ''}
                            </summary>
                            ${valuesHtml}
                        </details>`;
                });
            });
            
            document.getElementById('serviceList').innerHTML = html;
            
            // ç‚º details å…ƒç´ æ·»åŠ å±•é–‹/æ”¶åˆå‹•ç•«
            document.querySelectorAll('.service-item').forEach(details => {
                details.addEventListener('toggle', function() {
                    const arrow = this.querySelector('summary span:first-child');
                    if (this.open) {
                        arrow.textContent = 'â–¼';
                    } else {
                        arrow.textContent = 'â–¶';
                    }
                });
            });
        }

        // ==================== æœå°‹æœå‹™ ====================
        function searchServices() {
            const query = document.getElementById('searchService').value.toLowerCase();
            const items = document.querySelectorAll('.service-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(query) ? 'block' : 'none';
            });
        }

        // ==================== è¤‡è£½åˆ°å‰ªè²¼ç°¿ ====================
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
            });
        }

        // ==================== ä¸²å£é€šè¨ŠåŠŸèƒ½ ====================
        let serialPort = null;
        let serialReader = null;
        let serialWriter = null;
        let keepReading = false;
        let receiveBuffer = [];
        let isMonitorPaused = false;  // ä¸²å£ç›£è¦–å™¨æš«åœæ¨™å¿—
        let lastReceivedPacket = null;  // ä¸Šä¸€å€‹æ¥æ”¶çš„å°åŒ…ï¼ˆç”¨æ–¼å»é‡ï¼‰
        let duplicateCount = 0;  // é‡è¤‡å°åŒ…è¨ˆæ•¸

        // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´
        function checkSerialSupport() {
            if (!('serial' in navigator)) {
                return false;
            }
            return true;
        }

        // åˆ‡æ›ä¸²å£è¼¸å…¥æ¨¡å¼
        function toggleSerialInputMode() {
            const mode = document.querySelector('input[name="serialInputMode"]:checked').value;
            const builderDiv = document.getElementById('serialCommandBuilder');
            const manualDiv = document.getElementById('serialManualInput');
            
            if (mode === 'builder') {
                builderDiv.style.display = 'block';
                manualDiv.style.display = 'none';
            } else {
                builderDiv.style.display = 'none';
                manualDiv.style.display = 'block';
            }
        }

        // æ›´æ–°ä¸²å£é é¢çš„æœå‹™é¸é …
        function updateSerialServiceOptions() {
            const deviceType = parseInt(document.getElementById('serialDeviceType').value);
            const select = document.getElementById('serialServiceId');
            select.innerHTML = '';
            
            // å¦‚æœæ˜¯å»£æ’­ (0x00)ï¼Œé¡¯ç¤ºå»£æ’­å‘½ä»¤
            if (deviceType === 0x00) {
                const broadcastCommands = [
                    { id: 0x00, name: 'è¨»å†Š' },
                    { id: 0x01, name: 'è®€å–è¨­å‚™é¡å‹' },
                    { id: 0x02, name: 'è®€å–ç‰ˆæœ¬' },
                    { id: 0x03, name: 'ä¿ç•™' },
                    { id: 0x04, name: 'è®€å– SA ID' },
                    { id: 0x05, name: 'è®€å–å“ç‰Œ' },
                    { id: 0x06, name: 'è®€å–å‹è™Ÿ' },
                    { id: 0x07, name: 'è®€å–æœå‹™åˆ—è¡¨' },
                    { id: 0x08, name: 'è®€å–ç‹€æ…‹ (Broadcast Query) â­' }
                ];
                
                broadcastCommands.forEach(cmd => {
                    const option = document.createElement('option');
                    option.value = cmd.id;
                    option.textContent = `0x${cmd.id.toString(16).toUpperCase().padStart(2, '0')} - ${cmd.name}`;
                    if (cmd.id === 0x08) option.selected = true;
                    select.appendChild(option);
                });
                
                // å»£æ’­å‘½ä»¤é€šå¸¸ä¸éœ€è¦è®€å¯«é¸æ“‡
                document.getElementById('serialCommandType').value = 'read';
                
            } else {
                // å–å¾—è©²è¨­å‚™çš„æœå‹™å®šç¾©
                const deviceServices = getServicesForDevice(deviceType);
                
                // å–å¾—æ‰€æœ‰å¯ç”¨çš„æœå‹™ ID ä¸¦æ’åº
                const serviceIds = Object.keys(deviceServices).map(id => parseInt(id)).sort((a, b) => a - b);
                
                serviceIds.forEach(id => {
                    const service = deviceServices[id];
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = `0x${id.toString(16).toUpperCase().padStart(2, '0')} - ${service.name}`;
                    select.appendChild(option);
                });
            }
            
            updateSerialValueHelp();
        }

        // æ›´æ–°ä¸²å£é é¢çš„æ•¸å€¼å¹«åŠ©
        function updateSerialValueHelp() {
            const deviceType = parseInt(document.getElementById('serialDeviceType').value);
            const serviceId = parseInt(document.getElementById('serialServiceId').value);
            const helpDiv = document.getElementById('serialValueHelp');
            const dataValueSelect = document.getElementById('serialDataValue');
            
            dataValueSelect.innerHTML = '';
            
            // ç‰¹æ®Šè™•ç†ï¼šå»£æ’­å‘½ä»¤
            if (deviceType === 0x00) {
                const queryOption = document.createElement('option');
                queryOption.value = '0xFFFF';
                queryOption.textContent = '0xFFFF - æŸ¥è©¢';
                queryOption.selected = true;
                dataValueSelect.appendChild(queryOption);
                
                const broadcastCommandNames = {
                    0x00: 'è¨»å†Š',
                    0x01: 'è®€å–è¨­å‚™é¡å‹',
                    0x02: 'è®€å–ç‰ˆæœ¬',
                    0x03: 'ä¿ç•™',
                    0x04: 'è®€å– SA ID',
                    0x05: 'è®€å–å“ç‰Œ',
                    0x06: 'è®€å–å‹è™Ÿ',
                    0x07: 'è®€å–æœå‹™åˆ—è¡¨',
                    0x08: 'è®€å–ç‹€æ…‹ (Broadcast Query)'
                };
                
                let helpText = `<strong>${broadcastCommandNames[serviceId]}</strong> (å»£æ’­å‘½ä»¤)<br>`;
                
                if (serviceId === 0x08) {
                    helpText += '<br><strong>â­ æœ€å¸¸ç”¨çš„å»£æ’­å‘½ä»¤</strong><br>';
                    helpText += 'ç™¼é€æ­¤å‘½ä»¤å¾Œï¼Œæ‰€æœ‰è¨­å‚™æœƒå›æ‡‰å®Œæ•´ç‹€æ…‹çš„é•·å°åŒ…<br>';
                }
                
                helpDiv.innerHTML = helpText;
                helpDiv.style.display = 'block';
                return;
            }
            
            // ä¸€èˆ¬è¨­å‚™æœå‹™è™•ç†
            const deviceServices = getServicesForDevice(deviceType);
            const service = deviceServices[serviceId];
            
            if (!service) {
                helpDiv.style.display = 'none';
                addBasicDataOptions(dataValueSelect);
                return;
            }
            
            let helpText = `<strong>${service.name}</strong> (${service.category})<br>`;
            
            if (service.values) {
                helpText += '<br><strong>å¯ç”¨æ•¸å€¼ï¼š</strong><br>';
                
                const queryOption = document.createElement('option');
                queryOption.value = '0xFFFF';
                queryOption.textContent = '0xFFFF - æŸ¥è©¢ (Query)';
                dataValueSelect.appendChild(queryOption);
                
                Object.entries(service.values).forEach(([val, desc]) => {
                    const option = document.createElement('option');
                    option.value = val;
                    option.textContent = `${val} - ${desc}`;
                    dataValueSelect.appendChild(option);
                    helpText += `â€¢ ${val}: ${desc}<br>`;
                });
                
                const customOption = document.createElement('option');
                customOption.value = 'custom';
                customOption.textContent = 'ğŸ”§ è‡ªè¨‚æ•¸å€¼...';
                dataValueSelect.appendChild(customOption);
                
            } else if (service.unit) {
                helpText += `<br><strong>å–®ä½ï¼š</strong>${service.unit}<br>`;
                
                const queryOption = document.createElement('option');
                queryOption.value = '0xFFFF';
                queryOption.textContent = '0xFFFF - æŸ¥è©¢ (Query)';
                queryOption.selected = true;
                dataValueSelect.appendChild(queryOption);
                
                if (service.unit === 'Â°C') {
                    for (let temp = 16; temp <= 30; temp++) {
                        const option = document.createElement('option');
                        option.value = temp;
                        option.textContent = `${temp}Â°C`;
                        dataValueSelect.appendChild(option);
                    }
                    helpText += '<br><strong>å»ºè­°ç¯„åœï¼š</strong>16Â°C ~ 30Â°C';
                } else if (service.unit === '%') {
                    for (let humidity = 30; humidity <= 90; humidity += 5) {
                        const option = document.createElement('option');
                        option.value = humidity;
                        option.textContent = `${humidity}%`;
                        dataValueSelect.appendChild(option);
                    }
                    helpText += '<br><strong>å»ºè­°ç¯„åœï¼š</strong>30% ~ 90%';
                } else {
                    addBasicDataOptions(dataValueSelect);
                }
                
                const customOption = document.createElement('option');
                customOption.value = 'custom';
                customOption.textContent = 'ğŸ”§ è‡ªè¨‚æ•¸å€¼...';
                dataValueSelect.appendChild(customOption);
                
            } else {
                addBasicDataOptions(dataValueSelect);
                helpText += '<br><em>æ­¤æœå‹™æ²’æœ‰é å®šç¾©æ•¸å€¼</em>';
            }
            
            helpText += '<br><br><em>ğŸ’¡ é¸æ“‡ 0xFFFF é€²è¡ŒæŸ¥è©¢</em>';
            
            helpDiv.innerHTML = helpText;
            helpDiv.style.display = 'block';
        }

        // è™•ç†ä¸²å£æ•¸æ“šå€¼è®Šæ›´
        function handleSerialDataValueChange() {
            const selectedValue = document.getElementById('serialDataValue').value;
            const customValueDiv = document.getElementById('serialCustomValueInput');
            
            if (selectedValue === 'custom') {
                customValueDiv.style.display = 'block';
                document.getElementById('serialCustomValue').focus();
            } else {
                customValueDiv.style.display = 'none';
            }
        }

        // ç™¼é€ä¸²å£å‘½ä»¤ï¼ˆå¾å‘½ä»¤ç”¢ç”Ÿå™¨ï¼‰
        async function sendSerialCommand() {
            if (!serialPort) {
                alert('è«‹å…ˆé€£æ¥ä¸²å£');
                return;
            }
            
            try {
                const deviceType = parseInt(document.getElementById('serialDeviceType').value);
                const commandType = document.getElementById('serialCommandType').value;
                const serviceId = parseInt(document.getElementById('serialServiceId').value);
                let dataValue = document.getElementById('serialDataValue').value.trim();
                
                // æª¢æŸ¥æ˜¯å¦é¸æ“‡è‡ªè¨‚å€¼
                if (dataValue === 'custom') {
                    dataValue = document.getElementById('serialCustomValue').value.trim();
                    if (!dataValue) {
                        throw new Error('è«‹è¼¸å…¥è‡ªè¨‚æ•¸å€¼');
                    }
                }
                
                // è§£ææ•¸æ“šå€¼
                if (dataValue.startsWith('0x') || dataValue.startsWith('0X')) {
                    dataValue = parseInt(dataValue, 16);
                } else {
                    dataValue = parseInt(dataValue);
                }
                
                if (isNaN(dataValue) || dataValue < 0 || dataValue > 0xFFFF) {
                    throw new Error('æ•¸æ“šå€¼å¿…é ˆåœ¨ 0 åˆ° 65535 (0xFFFF) ä¹‹é–“');
                }
                
                // å»ºæ§‹å°åŒ…
                const bytes = [];
                bytes[0] = 0x06;
                bytes[1] = deviceType;
                
                // ç¬¬ä¸‰å€‹å­—ç¯€ï¼šå»£æ’­å‘½ä»¤ç›´æ¥ä½¿ç”¨å‘½ä»¤IDï¼Œè¨­å‚™æœå‹™éœ€è¦åŠ è®€å¯«æ¨™èªŒ
                if (deviceType === 0x00) {
                    bytes[2] = serviceId; // å»£æ’­å‘½ä»¤
                } else {
                    bytes[2] = commandType === 'write' ? (serviceId | 0x80) : serviceId; // è¨­å‚™æœå‹™
                }
                
                bytes[3] = (dataValue >> 8) & 0xFF;
                bytes[4] = dataValue & 0xFF;
                bytes[5] = calculateChecksum(bytes.slice(0, 5));
                
                // ç™¼é€
                const writer = serialPort.writable.getWriter();
                await writer.write(new Uint8Array(bytes));
                writer.releaseLock();
                
                const hexString = bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
                const timestamp = new Date().toLocaleTimeString('zh-TW', { hour12: false });
                
                // æ ¹æ“šè¨­å‚™é¡å‹é¡¯ç¤ºä¸åŒçš„è³‡è¨Š
                if (deviceType === 0x00) {
                    const broadcastCommandNames = {
                        0x00: 'è¨»å†Š',
                        0x01: 'è®€å–è¨­å‚™é¡å‹',
                        0x02: 'è®€å–ç‰ˆæœ¬',
                        0x03: 'ä¿ç•™',
                        0x04: 'è®€å– SA ID',
                        0x05: 'è®€å–å“ç‰Œ',
                        0x06: 'è®€å–å‹è™Ÿ',
                        0x07: 'è®€å–æœå‹™åˆ—è¡¨',
                        0x08: 'è®€å–ç‹€æ…‹ (Broadcast Query)'
                    };
                    const commandName = broadcastCommandNames[serviceId] || 'æœªçŸ¥å‘½ä»¤';
                    addSerialLog(`ğŸ“¤ [${timestamp}] TX: ${hexString}`, 'send');
                    addSerialLog(`   âœ å»£æ’­å‘½ä»¤: ${commandName}`, 'info');
                } else {
                    const deviceServices = getServicesForDevice(deviceType);
                    const service = deviceServices[serviceId];
                    const serviceName = service?.name || 'æœªçŸ¥æœå‹™';
                    addSerialLog(`ğŸ“¤ [${timestamp}] TX: ${hexString}`, 'send');
                    addSerialLog(`   âœ ${commandType === 'write' ? 'å¯«å…¥' : 'è®€å–'} ${serviceName} = ${dataValue}`, 'info');
                }
                
            } catch (error) {
                console.error('ç™¼é€å¤±æ•—:', error);
                addSerialLog('âŒ ç™¼é€å¤±æ•—: ' + error.message, 'error');
                alert('ç™¼é€å¤±æ•—: ' + error.message);
            }
        }

        // é€£æ¥ä¸²å£
        async function connectSerial() {
            if (!checkSerialSupport()) {
                alert('âŒ æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ Web Serial API\n\nè«‹ä½¿ç”¨ä»¥ä¸‹ç€è¦½å™¨ï¼š\nâ€¢ Chrome 89+\nâ€¢ Edge 89+\nâ€¢ Opera 75+\n\nä¸¦ç¢ºä¿ä½¿ç”¨ HTTPS æˆ– localhost');
                return;
            }

            try {
                // è«‹æ±‚ä¸²å£
                serialPort = await navigator.serial.requestPort();
                
                // ç²å–è¨­å®š
                const baudRate = parseInt(document.getElementById('baudRate').value);
                const dataBits = parseInt(document.getElementById('dataBits').value);
                const stopBits = parseInt(document.getElementById('stopBits').value);
                const parity = document.getElementById('parity').value;
                
                // æ‰“é–‹ä¸²å£
                await serialPort.open({
                    baudRate: baudRate,
                    dataBits: dataBits,
                    stopBits: stopBits,
                    parity: parity
                });

                // æ›´æ–°UI
                updateSerialUI(true);
                addSerialLog('âœ… ä¸²å£é€£æ¥æˆåŠŸ', 'success');
                addSerialLog(`âš™ï¸ è¨­å®š: ${baudRate} bps, ${dataBits}N${stopBits}`, 'info');
                
                // é–‹å§‹è®€å–
                readSerialData();
                
            } catch (error) {
                console.error('é€£æ¥å¤±æ•—:', error);
                addSerialLog('âŒ é€£æ¥å¤±æ•—: ' + error.message, 'error');
                alert('é€£æ¥å¤±æ•—: ' + error.message);
            }
        }

        // æ–·é–‹ä¸²å£
        async function disconnectSerial() {
            keepReading = false;
            
            if (serialReader) {
                try {
                    await serialReader.cancel();
                } catch (e) {
                    console.error('å–æ¶ˆè®€å–å¤±æ•—:', e);
                }
            }
            
            if (serialPort) {
                try {
                    await serialPort.close();
                    addSerialLog('ğŸ”´ ä¸²å£å·²æ–·é–‹', 'info');
                } catch (e) {
                    console.error('é—œé–‰ä¸²å£å¤±æ•—:', e);
                }
                serialPort = null;
            }
            
            // é‡ç½®å»é‡ç›¸é—œè®Šæ•¸
            lastReceivedPacket = null;
            duplicateCount = 0;
            
            updateSerialUI(false);
        }

        // æ›´æ–°ä¸²å£UIç‹€æ…‹
        function updateSerialUI(connected) {
            const statusDiv = document.getElementById('serialStatus');
            const connectBtn = document.getElementById('connectBtn');
            const disconnectBtn = document.getElementById('disconnectBtn');
            const serialCommandSection = document.getElementById('serialCommandSection');
            const serialMonitorGroup = document.getElementById('serialMonitorGroup');
            
            if (connected) {
                statusDiv.innerHTML = 'ğŸŸ¢ å·²é€£æ¥';
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                connectBtn.style.display = 'none';
                disconnectBtn.style.display = 'block';
                serialCommandSection.style.display = 'block';
                serialMonitorGroup.style.display = 'block';
                
                // åˆå§‹åŒ–å‘½ä»¤ç”¢ç”Ÿå™¨
                updateSerialServiceOptions();
            } else {
                statusDiv.innerHTML = 'ğŸ”´ æœªé€£æ¥';
                statusDiv.style.background = '#f8f9fa';
                statusDiv.style.color = '#6c757d';
                connectBtn.style.display = 'block';
                disconnectBtn.style.display = 'none';
                serialCommandSection.style.display = 'none';
            }
        }

        // è®€å–ä¸²å£æ•¸æ“š
        async function readSerialData() {
            keepReading = true;
            
            try {
                serialReader = serialPort.readable.getReader();

                while (keepReading) {
                    const { value, done } = await serialReader.read();
                    if (done) {
                        break;
                    }
                    
                    // è™•ç†æ¥æ”¶åˆ°çš„äºŒé€²åˆ¶æ•¸æ“š
                    if (value) {
                        handleReceivedData(value);
                    }
                }
                
                serialReader.releaseLock();
            } catch (error) {
                console.error('è®€å–éŒ¯èª¤:', error);
                addSerialLog('âŒ è®€å–éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // è™•ç†æ¥æ”¶åˆ°çš„æ•¸æ“š
        function handleReceivedData(data) {
            // data æ˜¯ Uint8Arrayï¼Œç›´æ¥è™•ç†å­—ç¯€
            for (let i = 0; i < data.length; i++) {
                const byte = data[i];
                receiveBuffer.push(byte);
                
                // æª¢æŸ¥æ˜¯å¦æ”¶åˆ°å®Œæ•´å°åŒ…
                if (receiveBuffer.length >= 1) {
                    const packetLength = receiveBuffer[0];
                    
                    if (receiveBuffer.length >= packetLength) {
                        // æå–å®Œæ•´å°åŒ…
                        const packet = receiveBuffer.slice(0, packetLength);
                        receiveBuffer = receiveBuffer.slice(packetLength);
                        
                        // é¡¯ç¤ºå°åŒ…
                        displayReceivedPacket(packet);
                    }
                }
            }
        }

        // é¡¯ç¤ºæ¥æ”¶åˆ°çš„å°åŒ…
        function displayReceivedPacket(packet) {
            const hexString = packet.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
            
            // æª¢æŸ¥æ˜¯å¦èˆ‡ä¸Šä¸€å€‹å°åŒ…ç›¸åŒï¼ˆå»é‡ï¼‰
            if (lastReceivedPacket) {
                let isDuplicate = true;
                if (lastReceivedPacket.length !== packet.length) {
                    isDuplicate = false;
                } else {
                    for (let i = 0; i < packet.length; i++) {
                        if (lastReceivedPacket[i] !== packet[i]) {
                            isDuplicate = false;
                            break;
                        }
                    }
                }
                
                if (isDuplicate) {
                    duplicateCount++;
                    // å¦‚æœæ˜¯é‡è¤‡å°åŒ…ï¼Œä¸é¡¯ç¤ºï¼Œåªæ›´æ–°è¨ˆæ•¸
                    return;
                }
            }
            
            // å¦‚æœä¹‹å‰æœ‰é‡è¤‡å°åŒ…ï¼Œé¡¯ç¤ºé‡è¤‡æ¬¡æ•¸
            if (duplicateCount > 0) {
                addSerialLog(`   ... (é‡è¤‡ ${duplicateCount} æ¬¡)`, 'info');
                duplicateCount = 0;
            }
            
            // ä¿å­˜ç•¶å‰å°åŒ…ä½œç‚ºä¸‹æ¬¡æ¯”å°çš„åŸºæº–
            lastReceivedPacket = Array.from(packet);
            
            const timestamp = new Date().toLocaleTimeString('zh-TW', { hour12: false });
            addSerialLog(`ğŸ“¥ [${timestamp}] RX: ${hexString}`, 'receive');
            
            // è‡ªå‹•è§£æ
            if (document.getElementById('autoParseResponse').checked) {
                try {
                    displayParsedPacketInSerial(packet);
                } catch (e) {
                    console.error('è§£æéŒ¯èª¤:', e);
                }
            }
        }

        // åœ¨ä¸²å£å€åŸŸé¡¯ç¤ºè§£æçµæœ
        function displayParsedPacketInSerial(bytes) {
            const calculatedChecksum = calculateChecksum(bytes.slice(0, bytes.length - 1));
            const packetChecksum = bytes[bytes.length - 1];
            const isValid = calculatedChecksum === packetChecksum;
            
            let html = '<div style="margin: 10px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #667eea; border-radius: 5px;">';
            
            if (isValid) {
                html += '<div style="color: green; font-weight: bold; margin-bottom: 10px;">âœ… æ ¡é©—ç¢¼æ­£ç¢º</div>';
            } else {
                html += `<div style="color: red; font-weight: bold; margin-bottom: 10px;">âŒ æ ¡é©—ç¢¼éŒ¯èª¤ (è¨ˆç®—: 0x${calculatedChecksum.toString(16).toUpperCase()}, æ¥æ”¶: 0x${packetChecksum.toString(16).toUpperCase()})</div>`;
            }
            
            const saId = bytes[1];
            const isBroadcast = (saId === 0x00);
            
            const deviceTypes = {
                0x00: 'å»£æ’­', 0x01: 'ç©ºèª¿', 0x03: 'æ´—è¡£æ©Ÿ',
                0x04: 'é™¤æ¿•æ©Ÿ', 0x08: 'ç©ºæ°£æ¸…æ·¨æ©Ÿ', 0x0E: 'ERV', 0x0F: 'é›»é¢¨æ‰‡'
            };
            
            html += `<div><strong>è¨­å‚™:</strong> ${deviceTypes[saId] || 'æœªçŸ¥'} (0x${saId.toString(16).toUpperCase()})</div>`;
            
            if (isBroadcast) {
                // å»£æ’­å‘½ä»¤
                const commandByte = bytes[2];
                const broadcastCommands = {
                    0x00: 'è¨»å†Š',
                    0x01: 'è®€å–è¨­å‚™é¡å‹',
                    0x02: 'è®€å–ç‰ˆæœ¬',
                    0x04: 'è®€å– SA ID',
                    0x05: 'è®€å–å“ç‰Œ',
                    0x06: 'è®€å–å‹è™Ÿ',
                    0x07: 'è®€å–æœå‹™åˆ—è¡¨',
                    0x08: 'è®€å–ç‹€æ…‹ (Broadcast Query)'
                };
                
                const commandName = broadcastCommands[commandByte] || 'æœªçŸ¥å‘½ä»¤';
                html += `<div><strong>å‘½ä»¤:</strong> ${commandName} (0x${commandByte.toString(16).toUpperCase()})</div>`;
                
                if (commandByte === 0x08) {
                    html += `<div style="background: #e7f3ff; padding: 8px; margin-top: 8px; border-radius: 4px;">â­ <strong>å»£æ’­æŸ¥è©¢</strong> - è¦æ±‚æ‰€æœ‰è¨­å‚™å›å ±å®Œæ•´ç‹€æ…‹</div>`;
                }
                
                if (bytes.length === 6) {
                    const dataValue = (bytes[3] << 8) | bytes[4];
                    html += `<div><strong>æ•¸å€¼:</strong> ${dataValue} (0x${dataValue.toString(16).toUpperCase().padStart(4, '0')})`;
                    if (dataValue === 0xFFFF) {
                        html += ' - ğŸ” æŸ¥è©¢æŒ‡ä»¤';
                    }
                    html += '</div>';
                }
            } else {
                // è¨­å‚™æœå‹™
                const serviceIdByte = bytes[2];
                const isWrite = (serviceIdByte & 0x80) !== 0;
                const serviceId = serviceIdByte & 0x7F;
                
                // å¾å°æ‡‰è¨­å‚™é¡å‹ç²å–æœå‹™å®šç¾©
                const deviceServices = getServicesForDevice(saId);
                const service = deviceServices[serviceId];
                
                html += `<div><strong>æœå‹™:</strong> ${service?.name || 'æœªçŸ¥æœå‹™'} (0x${serviceId.toString(16).toUpperCase()})</div>`;
                html += `<div><strong>é¡å‹:</strong> ${isWrite ? 'å¯«å…¥' : 'è®€å–'}</div>`;
                
                if (bytes.length === 6) {
                    const dataValue = (bytes[3] << 8) | bytes[4];
                    html += `<div><strong>æ•¸å€¼:</strong> ${dataValue} (0x${dataValue.toString(16).toUpperCase().padStart(4, '0')})`;
                    
                    if (dataValue === 0xFFFF) {
                        html += ' - ğŸ” æŸ¥è©¢';
                    } else if (service?.values && service.values[bytes[4].toString()]) {
                        html += ` - ${service.values[bytes[4].toString()]}`;
                    } else if (service?.unit) {
                        html += ` ${service.unit}`;
                    }
                    html += '</div>';
                }
            }
            
            html += '</div>';
            
            const resultDiv = document.getElementById('serialParseResult');
            resultDiv.innerHTML = html + resultDiv.innerHTML;
            resultDiv.style.display = 'block';
        }

        // ç™¼é€ä¸²å£æ•¸æ“š
        async function sendSerialData() {
            if (!serialPort) {
                alert('è«‹å…ˆé€£æ¥ä¸²å£');
                return;
            }
            
            try {
                const input = document.getElementById('serialSendData').value.trim();
                if (!input) {
                    alert('è«‹è¼¸å…¥è¦ç™¼é€çš„å°åŒ…');
                    return;
                }
                
                // è§£æè¼¸å…¥
                const cleanInput = input.replace(/0x/gi, '').replace(/[:\s-]/g, '');
                const bytes = [];
                for (let i = 0; i < cleanInput.length; i += 2) {
                    bytes.push(parseInt(cleanInput.substr(i, 2), 16));
                }
                
                // é©—è­‰æ ¡é©—ç¢¼
                const calculatedChecksum = calculateChecksum(bytes.slice(0, bytes.length - 1));
                if (calculatedChecksum !== bytes[bytes.length - 1]) {
                    if (!confirm('âš ï¸ æ ¡é©—ç¢¼ä¸æ­£ç¢ºï¼\nè¨ˆç®—å€¼: 0x' + calculatedChecksum.toString(16).toUpperCase() + '\nå°åŒ…å€¼: 0x' + bytes[bytes.length - 1].toString(16).toUpperCase() + '\n\næ˜¯å¦ä»è¦ç™¼é€ï¼Ÿ')) {
                        return;
                    }
                }
                
                // ç™¼é€æ•¸æ“š
                const writer = serialPort.writable.getWriter();
                await writer.write(new Uint8Array(bytes));
                writer.releaseLock();
                
                const hexString = bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
                const timestamp = new Date().toLocaleTimeString('zh-TW', { hour12: false });
                addSerialLog(`ğŸ“¤ [${timestamp}] TX: ${hexString}`, 'send');
                
            } catch (error) {
                console.error('ç™¼é€å¤±æ•—:', error);
                addSerialLog('âŒ ç™¼é€å¤±æ•—: ' + error.message, 'error');
                alert('ç™¼é€å¤±æ•—: ' + error.message);
            }
        }

        // ç™¼é€å¿«é€Ÿå‘½ä»¤
        async function sendQuickCommand(command, description) {
            document.getElementById('serialSendData').value = command;
            addSerialLog(`ğŸš€ å¿«é€Ÿå‘½ä»¤: ${description}`, 'info');
            await sendSerialData();
        }

        // æ·»åŠ ä¸²å£æ—¥èªŒ
        function addSerialLog(message, type = 'info') {
            // å¦‚æœç›£è¦–å™¨æš«åœï¼Œå‰‡ä¸æ·»åŠ æ–°æ¶ˆæ¯
            if (isMonitorPaused) {
                return;
            }
            
            const monitor = document.getElementById('serialMonitor');
            const timestamp = new Date().toLocaleTimeString('zh-TW', { hour12: false });
            
            let color = '#68d391';
            if (type === 'error') color = '#fc8181';
            if (type === 'send') color = '#63b3ed';
            if (type === 'receive') color = '#68d391';
            if (type === 'success') color = '#48bb78';
            
            const logLine = `<div style="color: ${color};">${message}</div>`;
            
            if (monitor.textContent === 'ç­‰å¾…æ•¸æ“š...') {
                monitor.innerHTML = logLine;
            } else {
                monitor.innerHTML += logLine;
            }
            
            // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
            monitor.scrollTop = monitor.scrollHeight;
        }

        // åˆ‡æ›ä¸²å£ç›£è¦–å™¨æš«åœç‹€æ…‹
        function toggleSerialMonitorPause() {
            isMonitorPaused = !isMonitorPaused;
            const btn = document.getElementById('pauseMonitorBtn');
            
            if (isMonitorPaused) {
                btn.innerHTML = 'â–¶ï¸ ç¹¼çºŒ';
                btn.style.background = '#48bb78';
                btn.style.color = 'white';
                // åœ¨ç›£è¦–å™¨é¡¯ç¤ºæš«åœæç¤º
                const monitor = document.getElementById('serialMonitor');
                const pauseHint = `<div style="color: #ffc107; font-weight: bold;">â¸ï¸ ç›£è¦–å™¨å·²æš«åœ - é»æ“Šã€Œç¹¼çºŒã€æŒ‰éˆ•æ¢å¾©</div>`;
                monitor.innerHTML += pauseHint;
                monitor.scrollTop = monitor.scrollHeight;
            } else {
                btn.innerHTML = 'â¸ï¸ æš«åœ';
                btn.style.background = '';
                btn.style.color = '';
            }
        }

        // æ¸…ç©ºä¸²å£ç›£è¦–å™¨
        function clearSerialMonitor() {
            document.getElementById('serialMonitor').innerHTML = 'ç­‰å¾…æ•¸æ“š...';
            document.getElementById('serialParseResult').innerHTML = '';
            document.getElementById('serialParseResult').style.display = 'none';
            
            // é‡ç½®å»é‡ç›¸é—œè®Šæ•¸
            lastReceivedPacket = null;
            duplicateCount = 0;
        }

        // ==================== æ¨¡æ“¬è¨­å‚™åŠŸèƒ½ ====================
        
        // åŠ è¼‰é è¨­æƒ…å¢ƒ
        function loadDevicePreset(preset) {
            const presets = {
                'off': {
                    power: 0, mode: 3, fan: 0, targetTemp: 0xFFFF, 
                    indoorTemp: 23, outdoorTemp: 23, humidity: 54,
                    swing: 0, runtime: 227, filter: 242, energy: 0,
                    packetBytes: 106  // é—œæ©Ÿç‹€æ…‹ä½¿ç”¨ 106 bytes (34 å€‹æœå‹™)
                },
                'cooling': {
                    power: 1, mode: 0, fan: 2, targetTemp: 24,
                    indoorTemp: 26, outdoorTemp: 30, humidity: 60,
                    swing: 1, runtime: 1000, filter: 300, energy: 100,
                    packetBytes: 85  // é–‹æ©Ÿç‹€æ…‹ä½¿ç”¨ 85 bytes (27 å€‹æœå‹™)
                },
                'heating': {
                    power: 1, mode: 4, fan: 3, targetTemp: 26,
                    indoorTemp: 18, outdoorTemp: 10, humidity: 45,
                    swing: 1, runtime: 800, filter: 250, energy: 150,
                    packetBytes: 85
                },
                'hot_day': {
                    power: 1, mode: 0, fan: 4, targetTemp: 20,
                    indoorTemp: 28, outdoorTemp: 35, humidity: 70,
                    swing: 1, runtime: 2000, filter: 500, energy: 300,
                    packetBytes: 85
                },
                'cold_day': {
                    power: 1, mode: 4, fan: 3, targetTemp: 28,
                    indoorTemp: 15, outdoorTemp: 5, humidity: 40,
                    swing: 0, runtime: 1500, filter: 400, energy: 250,
                    packetBytes: 85
                }
            };
            
            const config = presets[preset];
            if (!config) return;
            
            document.getElementById('simPower').value = config.power;
            document.getElementById('simMode').value = config.mode;
            document.getElementById('simFan').value = config.fan;
            
            // è¨­å®šå°åŒ…é•·åº¦
            if (config.packetBytes) {
                document.getElementById('simPacketBytes').value = config.packetBytes;
                updatePacketBytesInfo();
            }
            
            if (config.targetTemp === 0xFFFF) {
                document.getElementById('simTargetTemp').value = '';
                document.getElementById('simTargetTemp').placeholder = 'N/A (AUTOæ¨¡å¼)';
            } else {
                document.getElementById('simTargetTemp').value = config.targetTemp;
                document.getElementById('simTargetTemp').placeholder = '';
            }
            
            document.getElementById('simIndoorTemp').value = config.indoorTemp;
            document.getElementById('simOutdoorTemp').value = config.outdoorTemp;
            document.getElementById('simHumidity').value = config.humidity;
            document.getElementById('simSwing').value = config.swing;
            document.getElementById('simRuntime').value = config.runtime;
            document.getElementById('simFilter').value = config.filter;
            document.getElementById('simEnergy').value = config.energy;
            
            // è‡ªå‹•ç”Ÿæˆå°åŒ…
            generateBroadcastResponse();
        }
        
        // ç”Ÿæˆå»£æ’­å›æ‡‰å°åŒ…
        function generateBroadcastResponse() {
            const power = parseInt(document.getElementById('simPower').value);
            const mode = parseInt(document.getElementById('simMode').value);
            const fan = parseInt(document.getElementById('simFan').value);
            
            let targetTemp = parseInt(document.getElementById('simTargetTemp').value);
            if (isNaN(targetTemp) || document.getElementById('simTargetTemp').value === '') {
                targetTemp = 0xFFFF; // AUTOæ¨¡å¼
            }
            
            const indoorTemp = parseInt(document.getElementById('simIndoorTemp').value);
            const outdoorTemp = parseInt(document.getElementById('simOutdoorTemp').value);
            const humidity = parseInt(document.getElementById('simHumidity').value);
            const swing = parseInt(document.getElementById('simSwing').value);
            const runtime = parseInt(document.getElementById('simRuntime').value);
            const filter = parseInt(document.getElementById('simFilter').value);
            const energy = parseInt(document.getElementById('simEnergy').value);
            
            // å¾ bytes è¼¸å…¥è¨ˆç®—æœå‹™æ•¸é‡
            const packetBytes = parseInt(document.getElementById('simPacketBytes').value);
            const dataBytes = packetBytes - 4;
            
            // é©—è­‰
            if (dataBytes < 0 || dataBytes % 3 !== 0) {
                alert('å°åŒ…é•·åº¦ä¸æ­£ç¢ºï¼è«‹æª¢æŸ¥è¼¸å…¥ã€‚');
                return;
            }
            
            const requestedServiceCount = dataBytes / 3;
            
            if (requestedServiceCount < 1) {
                alert('æœå‹™æ•¸é‡è‡³å°‘éœ€è¦ 1 å€‹ï¼');
                return;
            }
            
            // å®šç¾©æ‰€æœ‰å¯ç”¨çš„æœå‹™ (æŒ‰å„ªå…ˆç´šæ’åº)
            const availableServices = [
                // åŸºç¤çµ„ (å„ªå…ˆç´šæœ€é«˜ï¼Œç¸½æ˜¯åŒ…å«)
                [0x00, (power >> 8) & 0xFF, power & 0xFF, 'é›»æº'],
                [0x01, (mode >> 8) & 0xFF, mode & 0xFF, 'æ¨¡å¼'],
                [0x02, (fan >> 8) & 0xFF, fan & 0xFF, 'é¢¨é€Ÿ'],
                [0x03, (targetTemp >> 8) & 0xFF, targetTemp & 0xFF, 'ç›®æ¨™æº«åº¦'],
                
                // æ¬¡è¦åŸºç¤çµ„
                [0x04, (indoorTemp >> 8) & 0xFF, indoorTemp & 0xFF, 'å®¤å…§æº«åº¦'],
                [0x06, 0x00, 0x00, 'ç¡çœ å®šæ™‚'],
                [0x0B, 0x00, 0x00, 'é–‹æ©Ÿå®šæ™‚'],
                [0x0C, 0x00, 0x00, 'é—œæ©Ÿå®šæ™‚'],
                
                // æ“´å±•çµ„ 1
                [0x0E, (swing >> 8) & 0xFF, swing & 0xFF, 'å‚ç›´æ“ºé¢¨'],
                [0x11, 0x00, 0x02, 'æ°´å¹³æ“ºé¢¨'],
                [0x14, (humidity >> 8) & 0xFF, humidity & 0xFF, 'æ¿•åº¦'],
                [0x17, 0x00, 0x00, 'é˜²éœ‰åŠŸèƒ½'],
                [0x1F, 0x00, 0x00, 'é¡¯ç¤ºæ¨¡å¼'],
                [0x21, (outdoorTemp >> 8) & 0xFF, outdoorTemp & 0xFF, 'å®¤å¤–æº«åº¦'],
                [0x28, (energy >> 8) & 0xFF, energy & 0xFF, 'èƒ½æºæ¶ˆè€—'],
                [0x29, 0x00, 0x00, 'éŒ¯èª¤ä»£ç¢¼'],
                [0x2F, (runtime >> 8) & 0xFF, runtime & 0xFF, 'é‹è½‰æ™‚æ•¸'],
                [0x30, (filter >> 8) & 0xFF, filter & 0xFF, 'æ¿¾ç¶²æ™‚æ•¸'],
                
                // æ“´å±•çµ„ 2
                [0x1A, 0x00, 0x00, 'å¼·åŠ›æ¨¡å¼'],
                [0x1B, 0x00, 0x00, 'ç¯€èƒ½æ¨¡å¼'],
                [0x1C, 0x00, 0x00, 'èˆ’é©æ¨¡å¼'],
                [0x1D, 0x00, 0x00, 'åŠŸèƒ½ç¦ç”¨'],
                
                // æ“´å±•çµ„ 3
                [0x1E, 0x00, 0x00, 'èœ‚é³´å™¨'],
                [0x39, 0x00, 0x00, 'éœœæ´—åŠŸèƒ½'],
                
                // æ“´å±•çµ„ 4
                [0x3A, 0x00, 0x01, 'æ“´å……åŠŸèƒ½ 3A'],
                [0x3B, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 3B'],
                [0x3D, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 3D'],
                
                // æ“´å±•çµ„ 5 (å¾…æ©Ÿå°ˆå±¬)
                [0x40, 0x00, 0x01, 'å¾…æ©Ÿæ“´å…… 40'],
                [0x41, 0x00, 0x00, 'å¾…æ©Ÿæ“´å…… 41'],
                [0x43, 0x00, 0x00, 'å¾…æ©Ÿæ“´å…… 43'],
                [0x44, 0x00, 0x00, 'å¾…æ©Ÿæ“´å…… 44'],
                [0x45, 0x00, 0x00, 'å¾…æ©Ÿæ“´å…… 45'],
                [0x46, 0x00, 0x00, 'å¾…æ©Ÿæ“´å…… 46'],
                [0x47, 0x00, 0x00, 'å¾…æ©Ÿæ“´å…… 47'],
                
                // é¡å¤–æ“´å±•æœå‹™ (ç”¨æ–¼æ¸¬è©¦å¤§å°åŒ…)
                [0x48, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 48'],
                [0x49, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 49'],
                [0x4A, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 4A'],
                [0x4B, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 4B'],
                [0x4C, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 4C'],
                [0x4D, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 4D'],
                [0x4E, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 4E'],
                [0x4F, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 4F'],
                [0x50, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 50'],
                [0x51, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 51'],
                [0x52, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 52'],
                [0x53, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 53'],
                [0x54, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 54'],
                [0x55, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 55'],
                [0x56, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 56'],
                [0x57, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 57'],
                [0x58, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 58'],
                [0x59, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 59'],
                [0x5A, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 5A'],
                [0x5B, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 5B'],
                [0x5C, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 5C'],
                [0x5D, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 5D'],
                [0x5E, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 5E'],
                [0x5F, 0x00, 0x00, 'æ“´å……åŠŸèƒ½ 5F']
            ];
            
            // æ ¹æ“šè«‹æ±‚çš„æœå‹™æ•¸é‡é¸æ“‡æœå‹™
            const selectedServices = availableServices.slice(0, Math.min(requestedServiceCount, availableServices.length));
            
            // å¦‚æœè«‹æ±‚çš„æœå‹™æ•¸è¶…éå¯ç”¨æœå‹™ï¼Œç”¨è™›æ“¬æœå‹™å¡«å……
            while (selectedServices.length < requestedServiceCount) {
                const dummyId = 0x60 + (selectedServices.length - availableServices.length);
                selectedServices.push([dummyId, 0x00, 0x00, `æ“´å……åŠŸèƒ½ ${dummyId.toString(16).toUpperCase()}`]);
            }
            
            // æ§‹å»ºå®Œæ•´å°åŒ…
            const bytes = [];
            const totalLength = 3 + (selectedServices.length * 3) + 1; // é ­éƒ¨3 + æœå‹™æ•¸æ“š + æ ¡é©—1
            
            bytes.push(totalLength);  // é•·åº¦
            bytes.push(0x00);         // SA_ID = å»£æ’­
            bytes.push(0x08);         // å‘½ä»¤ = è®€å–ç‹€æ…‹
            
            // æ·»åŠ æ‰€æœ‰æœå‹™
            selectedServices.forEach(svc => {
                bytes.push(svc[0]);  // æœå‹™ ID
                bytes.push(svc[1]);  // æ•¸æ“šé«˜å­—ç¯€
                bytes.push(svc[2]);  // æ•¸æ“šä½å­—ç¯€
            });
            
            // è¨ˆç®—ä¸¦æ·»åŠ æ ¡é©—ç¢¼
            const checksum = calculateChecksum(bytes);
            bytes.push(checksum);
            
            // é¡¯ç¤ºç”Ÿæˆçš„å°åŒ…
            const hexString = bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
            
            document.getElementById('generatedBroadcastData').textContent = hexString;
            
            // ç”Ÿæˆæœå‹™åˆ—è¡¨èªªæ˜
            let serviceListHtml = '<div style="margin-top: 10px; font-size: 0.85em;">';
            serviceListHtml += '<strong>åŒ…å«çš„æœå‹™:</strong><br>';
            serviceListHtml += '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 5px;">';
            selectedServices.forEach((svc, idx) => {
                serviceListHtml += `<div style="font-size: 0.8em;">â€¢ ${svc[3]}</div>`;
            });
            serviceListHtml += '</div></div>';
            
            document.getElementById('generatedBroadcastInfo').innerHTML = 
                `ğŸ“ é•·åº¦: ${totalLength} bytes (0x${totalLength.toString(16).toUpperCase()}) | ` +
                `ğŸ”§ æœå‹™æ•¸: ${selectedServices.length} å€‹ | ` +
                `âœ… æ ¡é©—ç¢¼: 0x${checksum.toString(16).toUpperCase()}` +
                serviceListHtml;
            
            document.getElementById('generatedBroadcast').style.display = 'block';
            
            // ä¿å­˜åˆ°å…¨å±€è®Šæ•¸
            window.currentBroadcastPacket = bytes;
            
            return bytes;
        }
        
        // æ›´æ–°æœå‹™æ•¸é‡è³‡è¨Š
        
        // è¨­å®šå°åŒ…é•·åº¦
        function setPacketBytes(bytes) {
            document.getElementById('simPacketBytes').value = bytes;
            updatePacketBytesInfo();
        }
        
        // æ›´æ–°å°åŒ…é•·åº¦è³‡è¨Š
        function updatePacketBytesInfo() {
            const packetBytes = parseInt(document.getElementById('simPacketBytes').value);
            const infoDiv = document.getElementById('packetBytesInfo');
            
            // é©—è­‰å°åŒ…é•·åº¦
            if (isNaN(packetBytes) || packetBytes < 4) {
                infoDiv.innerHTML = '<span style="color: #dc3545;">âŒ é•·åº¦è‡³å°‘éœ€è¦ 4 bytes</span>';
                return;
            }
            
            if (packetBytes > 255) {
                infoDiv.innerHTML = '<span style="color: #dc3545;">âŒ é•·åº¦ä¸èƒ½è¶…é 255 bytes</span>';
                return;
            }
            
            // è¨ˆç®—æœå‹™æ•¸é‡
            // å…¬å¼: æœå‹™æ•¸ = (é•·åº¦ - 4) / 3
            const dataBytes = packetBytes - 4;
            
            if (dataBytes < 0) {
                infoDiv.innerHTML = '<span style="color: #dc3545;">âŒ é•·åº¦å¤ªçŸ­ï¼Œç„¡æ³•åŒ…å«æœå‹™</span>';
                return;
            }
            
            if (dataBytes % 3 !== 0) {
                const remainder = dataBytes % 3;
                const suggested = packetBytes + (3 - remainder);
                infoDiv.innerHTML = `<span style="color: #ffc107;">âš ï¸ é•·åº¦ä¸æ­£ç¢ºï¼æœå‹™æ•¸æ“šå¿…é ˆæ˜¯ 3 çš„å€æ•¸<br>å»ºè­°ä½¿ç”¨: ${suggested} bytes</span>`;
                return;
            }
            
            const serviceCount = dataBytes / 3;
            
            // é¡¯ç¤ºè³‡è¨Š
            let statusIcon = 'âœ…';
            let statusText = '';
            let statusColor = '#28a745';
            
            if (serviceCount < 4) {
                statusIcon = 'âš ï¸';
                statusText = 'æœå‹™æ•¸éå°‘';
                statusColor = '#ffc107';
            } else if (serviceCount > 50) {
                statusIcon = 'âš ï¸';
                statusText = 'æœå‹™æ•¸éå¤šï¼Œå¯èƒ½å½±éŸ¿æ€§èƒ½';
                statusColor = '#ffc107';
            } else {
                // åˆ¤æ–·é¡å‹
                if (serviceCount === 18) statusText = 'ç²¾ç°¡ç‰ˆ';
                else if (serviceCount === 22) statusText = 'æ¨™æº–ç‰ˆ';
                else if (serviceCount === 24) statusText = 'é€²éšç‰ˆ';
                else if (serviceCount === 27) statusText = 'å®Œæ•´ç‰ˆ';
                else if (serviceCount === 34) statusText = 'å¾…æ©Ÿç‰ˆ';
                else statusText = 'è‡ªè¨‚é•·åº¦';
            }
            
            infoDiv.innerHTML = `<span style="color: ${statusColor};">${statusIcon} æœå‹™æ•¸é‡: ${serviceCount} å€‹ ${statusText ? '(' + statusText + ')' : ''}</span>`;
        }
        
        // ç™¼é€å»£æ’­å›æ‡‰å°åŒ…
        async function sendBroadcastResponse() {
            if (!serialPort || !serialPort.writable) {
                addSerialLog('âŒ éŒ¯èª¤: ä¸²å£æœªé€£æ¥', 'error');
                alert('è«‹å…ˆé€£æ¥ä¸²å£ï¼');
                return;
            }
            
            // å¦‚æœæ²’æœ‰ç”Ÿæˆå°åŒ…ï¼Œå…ˆç”Ÿæˆ
            if (!window.currentBroadcastPacket) {
                generateBroadcastResponse();
            }
            
            const bytes = window.currentBroadcastPacket;
            
            try {
                const writer = serialPort.writable.getWriter();
                const data = new Uint8Array(bytes);
                await writer.write(data);
                writer.releaseLock();
                
                const hexString = bytes.map(b => b.toString(16).toUpperCase().padStart(2, '0')).join(':');
                const timestamp = new Date().toLocaleTimeString('zh-TW', { hour12: false });
                
                // æ­£ç¢ºè§£ææœå‹™æ•¸æ“š
                // æœå‹™ 0x00 (é›»æº): bytes[3]=ID, bytes[4]=é«˜ä½, bytes[5]=ä½ä½
                // æœå‹™ 0x01 (æ¨¡å¼): bytes[6]=ID, bytes[7]=é«˜ä½, bytes[8]=ä½ä½
                const modeNames = ['å†·æ°£', 'é™¤æ¿•', 'é€é¢¨', 'è‡ªå‹•', 'æš–æ°£'];
                const power = bytes[4] << 8 | bytes[5];  // ä¿®æ­£: å–æ•¸æ“šéƒ¨åˆ†è€Œéæœå‹™ID
                const mode = bytes[7] << 8 | bytes[8];   // ä¿®æ­£: å–æ•¸æ“šéƒ¨åˆ†è€Œéæœå‹™ID
                const temp = bytes[10] << 8 | bytes[11]; // æœå‹™ 0x03 çš„æº«åº¦æ•¸æ“š
                
                let statusText = `${power ? 'é–‹æ©Ÿ' : 'é—œæ©Ÿ'} | ${modeNames[mode] || 'æœªçŸ¥'}`;
                if (temp && temp !== 0xFFFF) {
                    statusText += ` | ${temp}Â°C`;
                }
                
                addSerialLog(`ğŸ“¤ [${timestamp}] TX: ${hexString}`, 'send');
                addSerialLog(`   âœ æ¨¡æ“¬ç©ºèª¿å›æ‡‰: ${statusText} | ${bytes.length} bytes`, 'info');
                
            } catch (error) {
                console.error('ç™¼é€éŒ¯èª¤:', error);
                addSerialLog('âŒ ç™¼é€éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // ==================== å»£æ’­å°åŒ…æ¯”å°åŠŸèƒ½ ====================
        
        // è§£æå»£æ’­å°åŒ…ï¼ˆé•·å°åŒ…æ ¼å¼ï¼‰
        function parseBroadcastPacket(input) {
            // æ¸…ç†è¼¸å…¥
            const cleanInput = input.replace(/0x/gi, '').replace(/[:\s-]/g, '');
            const bytes = [];
            for (let i = 0; i < cleanInput.length; i += 2) {
                bytes.push(parseInt(cleanInput.substr(i, 2), 16));
            }
            
            if (bytes.length < 6) {
                throw new Error('å°åŒ…é•·åº¦ä¸è¶³');
            }
            
            // è§£æå°åŒ…æ¨™é ­
            // TaiSEIA å»£æ’­å°åŒ…æ ¼å¼: [Length] [SA_ID] [Type/Command] [Service_Data...] [Checksum]
            const length = bytes[0];      // å°åŒ…é•·åº¦æ¬„ä½
            const saId = bytes[1];        // è¨­å‚™ ID
            const cmdType = bytes[2];     // å‘½ä»¤é¡å‹ï¼ˆå»£æ’­é€šå¸¸æ˜¯ 0x08ï¼‰
            
            // é©—è­‰é•·åº¦
            if (bytes.length < length) {
                throw new Error(`å°åŒ…ä¸å®Œæ•´ï¼šé æœŸ ${length} å­—ç¯€ï¼Œå¯¦éš› ${bytes.length} å­—ç¯€`);
            }
            
            // é©—è­‰æ ¡é©—ç¢¼ï¼ˆä½¿ç”¨å¯¦éš›å°åŒ…é•·åº¦ï¼‰
            const calculatedChecksum = calculateChecksum(bytes.slice(0, length - 1));
            const packetChecksum = bytes[length - 1];
            
            // è§£ææœå‹™æ•¸æ“šï¼ˆæ¯å€‹æœå‹™ 3 å­—ç¯€ï¼šService_ID + Data_High + Data_Lowï¼‰
            // å»£æ’­å°åŒ…çš„æœå‹™æ•¸æ“šå¾ç¬¬ 4 å€‹å­—ç¯€ï¼ˆç´¢å¼• 3ï¼‰é–‹å§‹ï¼Œåˆ°æ ¡é©—ç¢¼å‰ä¸€å€‹å­—ç¯€çµæŸ
            const services = [];
            for (let i = 3; i < length - 1; i += 3) {
                // ç¢ºä¿æœ‰å®Œæ•´çš„ 3 å€‹å­—ç¯€
                if (i + 2 < length) {
                    const serviceId = bytes[i];
                    const dataHigh = bytes[i + 1];
                    const dataLow = bytes[i + 2];
                    const dataValue = (dataHigh << 8) | dataLow;
                    
                    services.push({
                        position: i,
                        serviceId: serviceId,
                        dataValue: dataValue,
                        dataHigh: dataHigh,
                        dataLow: dataLow
                    });
                }
            }
            
            return {
                valid: calculatedChecksum === packetChecksum,
                length: length,
                saId: saId,
                cmdType: cmdType,
                services: services,
                checksum: packetChecksum,
                calculatedChecksum: calculatedChecksum,
                rawBytes: bytes,
                totalBytes: bytes.length
            };
        }
        
        // æ¯”å°å…©å€‹å»£æ’­å°åŒ…
        function compareBroadcastPackets() {
            try {
                const input1 = document.getElementById('broadcastPacket1').value.trim();
                const input2 = document.getElementById('broadcastPacket2').value.trim();
                const deviceType = parseInt(document.getElementById('compareDeviceType').value);
                
                if (!input1 || !input2) {
                    throw new Error('è«‹è¼¸å…¥å…©å€‹å°åŒ…é€²è¡Œæ¯”å°');
                }
                
                // è§£æå…©å€‹å°åŒ…
                const packet1 = parseBroadcastPacket(input1);
                const packet2 = parseBroadcastPacket(input2);
                
                // å–å¾—è¨­å‚™çš„æœå‹™å®šç¾©
                const deviceServices = getServicesForDevice(deviceType);
                
                // é¡¯ç¤ºæ¯”å°çµæœ
                displayComparisonResult(packet1, packet2, deviceServices, deviceType);
                
            } catch (error) {
                document.getElementById('compareResult').innerHTML = 
                    `<div class="error">âŒ éŒ¯èª¤: ${error.message}</div>`;
                document.getElementById('compareResult').style.display = 'block';
            }
        }
        
        // é¡¯ç¤ºæ¯”å°çµæœ
        function displayComparisonResult(packet1, packet2, deviceServices, deviceType) {
            let html = '<h3>ğŸ“Š å°åŒ…æ¯”å°çµæœ</h3>';
            
            // æ·»åŠ å°åŒ…çµæ§‹èª¿è©¦ä¿¡æ¯
            html += '<div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-family: monospace; font-size: 0.9em;">';
            html += '<strong>ğŸ” å°åŒ…çµæ§‹ä¿¡æ¯ï¼š</strong><br>';
            html += `å°åŒ… 1: ${packet1.totalBytes} å­—ç¯€ (é•·åº¦æ¬„ä½: 0x${packet1.length.toString(16).toUpperCase()})ï¼ŒåŒ…å« ${packet1.services.length} å€‹æœå‹™<br>`;
            html += `å°åŒ… 2: ${packet2.totalBytes} å­—ç¯€ (é•·åº¦æ¬„ä½: 0x${packet2.length.toString(16).toUpperCase()})ï¼ŒåŒ…å« ${packet2.services.length} å€‹æœå‹™<br>`;
            
            // é•·åº¦å·®ç•°è­¦å‘Š
            if (packet1.length !== packet2.length) {
                html += `<br><div style="background: #fff3cd; padding: 10px; border-radius: 5px; border-left: 4px solid #ffc107; margin-top: 10px;">`;
                html += `âš ï¸ <strong>æ³¨æ„ï¼š</strong>å…©å€‹å°åŒ…é•·åº¦ä¸åŒï¼é€™å¯èƒ½æ˜¯ï¼š<br>`;
                html += `â€¢ ä¸åŒå‹è™Ÿçš„è¨­å‚™ï¼ˆå¤§å°å°ã€åŠŸèƒ½å·®ç•°ï¼‰<br>`;
                html += `â€¢ ä¸åŒéŸŒé«”ç‰ˆæœ¬<br>`;
                html += `â€¢ ä¸åŒåŠŸèƒ½é…ç½®<br>`;
                html += `æ¯”å°å°‡åªé¡¯ç¤º<strong>å…±åŒçš„æœå‹™</strong>ï¼Œä¸¦æ¨™è¨»åƒ…å­˜åœ¨æ–¼å…¶ä¸­ä¸€å€‹å°åŒ…çš„æœå‹™ã€‚`;
                html += `</div>`;
            }
            
            html += `<br><strong>å°åŒ… 1 åŸå§‹æ•¸æ“šï¼š</strong><br>`;
            html += formatRawBytes(packet1.rawBytes, packet1.length);
            html += `<br><strong>å°åŒ… 2 åŸå§‹æ•¸æ“šï¼š</strong><br>`;
            html += formatRawBytes(packet2.rawBytes, packet2.length);
            html += '</div>';
            
            // åŸºæœ¬è³‡è¨Š
            html += '<div class="info-table-container">';
            html += '<table class="info-table">';
            html += '<tr><th>é …ç›®</th><th>å°åŒ… 1</th><th>å°åŒ… 2</th><th>ç‹€æ…‹</th></tr>';
            
            // å°åŒ…é•·åº¦
            const lengthStatus = packet1.length === packet2.length ? 
                'âœ… ç›¸åŒ' : 
                `âš ï¸ ä¸åŒ (å·®ç•°: ${Math.abs(packet1.length - packet2.length)} å­—ç¯€)`;
            html += `<tr>
                <td><strong>å°åŒ…é•·åº¦</strong></td>
                <td>${packet1.length} bytes</td>
                <td>${packet2.length} bytes</td>
                <td>${lengthStatus}</td>
            </tr>`;
            
            // æ ¡é©—ç¢¼
            html += `<tr>
                <td><strong>æ ¡é©—ç¢¼</strong></td>
                <td>${packet1.valid ? 'âœ… æ­£ç¢º' : 'âŒ éŒ¯èª¤'} (0x${packet1.checksum.toString(16).toUpperCase()})</td>
                <td>${packet2.valid ? 'âœ… æ­£ç¢º' : 'âŒ éŒ¯èª¤'} (0x${packet2.checksum.toString(16).toUpperCase()})</td>
                <td>${packet1.valid && packet2.valid ? 'âœ… éƒ½æ­£ç¢º' : 'âš ï¸ æœ‰èª¤'}</td>
            </tr>`;
            
            // SA_ID
            const deviceTypes = {
                0x00: 'å»£æ’­', 0x01: 'ç©ºèª¿', 0x03: 'æ´—è¡£æ©Ÿ',
                0x04: 'é™¤æ¿•æ©Ÿ', 0x08: 'ç©ºæ°£æ¸…æ·¨æ©Ÿ', 0x0E: 'ERV', 0x0F: 'é›»é¢¨æ‰‡'
            };
            html += `<tr>
                <td><strong>è¨­å‚™é¡å‹</strong></td>
                <td>${deviceTypes[packet1.saId] || 'æœªçŸ¥'} (0x${packet1.saId.toString(16).toUpperCase()})</td>
                <td>${deviceTypes[packet2.saId] || 'æœªçŸ¥'} (0x${packet2.saId.toString(16).toUpperCase()})</td>
                <td>${packet1.saId === packet2.saId ? 'âœ… ç›¸åŒ' : 'âŒ ä¸åŒ'}</td>
            </tr>`;
            
            // å‘½ä»¤é¡å‹
            html += `<tr>
                <td><strong>å‘½ä»¤é¡å‹</strong></td>
                <td>0x${packet1.cmdType.toString(16).toUpperCase()}</td>
                <td>0x${packet2.cmdType.toString(16).toUpperCase()}</td>
                <td>${packet1.cmdType === packet2.cmdType ? 'âœ… ç›¸åŒ' : 'âš ï¸ ä¸åŒ'}</td>
            </tr>`;
            
            // æœå‹™æ•¸é‡
            html += `<tr>
                <td><strong>æœå‹™æ•¸é‡</strong></td>
                <td>${packet1.services.length} å€‹</td>
                <td>${packet2.services.length} å€‹</td>
                <td>${packet1.services.length === packet2.services.length ? 'âœ… ç›¸åŒ' : 'âš ï¸ ä¸åŒ'}</td>
            </tr>`;
            
            html += '</table></div>';
            
            // æœå‹™æ•¸æ“šæ¯”å°
            html += '<h3 style="margin-top: 30px;">ğŸ” æœå‹™æ•¸æ“šæ¯”å°</h3>';
            
            // å»ºç«‹æœå‹™ç´¢å¼•
            const services1Map = new Map();
            packet1.services.forEach(s => services1Map.set(s.serviceId, s.dataValue));
            
            const services2Map = new Map();
            packet2.services.forEach(s => services2Map.set(s.serviceId, s.dataValue));
            
            // å–å¾—æ‰€æœ‰æœå‹™ ID
            const allServiceIds = new Set([...services1Map.keys(), ...services2Map.keys()]);
            const sortedServiceIds = Array.from(allServiceIds).sort((a, b) => a - b);
            
            // çµ±è¨ˆ
            let unchangedCount = 0;
            let changedCount = 0;
            let onlyInPacket1 = 0;
            let onlyInPacket2 = 0;
            
            html += '<div class="info-table-container">';
            html += '<table class="info-table">';
            html += '<tr><th>æœå‹™ ID</th><th>æœå‹™åç¨±</th><th>å°åŒ… 1 æ•¸å€¼</th><th>å°åŒ… 2 æ•¸å€¼</th><th>ç‹€æ…‹</th></tr>';
            
            sortedServiceIds.forEach(serviceId => {
                const service = deviceServices[serviceId];
                const serviceName = service ? service.name : 'æœªçŸ¥æœå‹™';
                const value1 = services1Map.get(serviceId);
                const value2 = services2Map.get(serviceId);
                
                let value1Text = '';
                let value2Text = '';
                let statusText = '';
                let rowClass = '';
                
                if (value1 === undefined && value2 !== undefined) {
                    // åªåœ¨å°åŒ…2ä¸­å­˜åœ¨ï¼ˆå°åŒ…2æ˜¯è¼ƒå¤§å°/è¼ƒæ–°ç‰ˆæœ¬ï¼‰
                    value1Text = '<span style="color: #999;">-</span>';
                    value2Text = formatServiceValue(value2, service);
                    statusText = 'ğŸ†• åƒ…å°åŒ…2';
                    rowClass = ' style="background: #e3f2fd;"';
                    onlyInPacket2++;
                } else if (value1 !== undefined && value2 === undefined) {
                    // åªåœ¨å°åŒ…1ä¸­å­˜åœ¨ï¼ˆå°åŒ…1æ˜¯è¼ƒå¤§å°/è¼ƒæ–°ç‰ˆæœ¬ï¼‰
                    value1Text = formatServiceValue(value1, service);
                    value2Text = '<span style="color: #999;">-</span>';
                    statusText = 'ğŸ”µ åƒ…å°åŒ…1';
                    rowClass = ' style="background: #f3e5f5;"';
                    onlyInPacket1++;
                } else if (value1 === value2) {
                    // ç›¸åŒ
                    value1Text = formatServiceValue(value1, service);
                    value2Text = formatServiceValue(value2, service);
                    statusText = 'âœ… ç›¸åŒ';
                    unchangedCount++;
                } else {
                    // ä¸åŒ
                    value1Text = formatServiceValue(value1, service);
                    value2Text = formatServiceValue(value2, service);
                    statusText = 'ğŸ”„ æ”¹è®Š';
                    rowClass = ' style="background: #fff9c4; font-weight: bold;"';
                    changedCount++;
                }
                
                html += `<tr${rowClass}>
                    <td><code>0x${serviceId.toString(16).toUpperCase().padStart(2, '0')}</code></td>
                    <td>${serviceName}</td>
                    <td>${value1Text}</td>
                    <td>${value2Text}</td>
                    <td>${statusText}</td>
                </tr>`;
            });
            
            html += '</table></div>';
            
            // çµ±è¨ˆæ‘˜è¦
            html += '<div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px;">';
            html += '<h3 style="margin: 0 0 15px 0; color: white;">ğŸ“ˆ æ¯”å°çµ±è¨ˆ</h3>';
            html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">';
            html += `<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2em; font-weight: bold;">${unchangedCount}</div>
                <div style="font-size: 0.9em; opacity: 0.9;">âœ… ç›¸åŒ</div>
            </div>`;
            html += `<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2em; font-weight: bold;">${changedCount}</div>
                <div style="font-size: 0.9em; opacity: 0.9;">ğŸ”„ æ”¹è®Š</div>
            </div>`;
            html += `<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2em; font-weight: bold;">${onlyInPacket1}</div>
                <div style="font-size: 0.9em; opacity: 0.9;">ğŸ”µ åƒ…å°åŒ…1</div>
            </div>`;
            html += `<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2em; font-weight: bold;">${onlyInPacket2}</div>
                <div style="font-size: 0.9em; opacity: 0.9;">ğŸ†• åƒ…å°åŒ…2</div>
            </div>`;
            html += `<div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2em; font-weight: bold;">${sortedServiceIds.length}</div>
                <div style="font-size: 0.9em; opacity: 0.9;">ğŸ“‹ ç¸½æœå‹™æ•¸</div>
            </div>`;
            html += '</div></div>';
            
            // é¡¯ç¤ºé‡è¦è®ŠåŒ–
            if (changedCount > 0) {
                html += '<div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 5px;">';
                html += '<h4 style="margin: 0 0 10px 0; color: #856404;">ğŸ”„ æ•¸å€¼æ”¹è®Šçš„æœå‹™</h4>';
                html += '<ul style="margin: 0; padding-left: 20px;">';
                
                sortedServiceIds.forEach(serviceId => {
                    const value1 = services1Map.get(serviceId);
                    const value2 = services2Map.get(serviceId);
                    
                    if (value1 !== undefined && value2 !== undefined && value1 !== value2) {
                        const service = deviceServices[serviceId];
                        const serviceName = service ? service.name : 'æœªçŸ¥æœå‹™';
                        html += `<li><strong>${serviceName} (0x${serviceId.toString(16).toUpperCase().padStart(2, '0')})</strong>: ${formatServiceValue(value1, service)} â†’ ${formatServiceValue(value2, service)}</li>`;
                    }
                });
                
                html += '</ul></div>';
            }
            
            // é¡¯ç¤ºåƒ…å­˜åœ¨æ–¼ä¸€å€‹å°åŒ…çš„æœå‹™
            if (onlyInPacket1 > 0 || onlyInPacket2 > 0) {
                html += '<div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 5px;">';
                html += '<h4 style="margin: 0 0 10px 0; color: #0d47a1;">ğŸ“Œ åŠŸèƒ½å·®ç•°</h4>';
                
                if (onlyInPacket1 > 0) {
                    html += '<strong style="color: #9c27b0;">ğŸ”µ åƒ…å°åŒ…1æ“æœ‰çš„æœå‹™ï¼š</strong>';
                    html += '<ul style="margin: 5px 0; padding-left: 20px;">';
                    sortedServiceIds.forEach(serviceId => {
                        const value1 = services1Map.get(serviceId);
                        const value2 = services2Map.get(serviceId);
                        if (value1 !== undefined && value2 === undefined) {
                            const service = deviceServices[serviceId];
                            const serviceName = service ? service.name : 'æœªçŸ¥æœå‹™';
                            html += `<li>${serviceName} (0x${serviceId.toString(16).toUpperCase().padStart(2, '0')}): ${formatServiceValue(value1, service)}</li>`;
                        }
                    });
                    html += '</ul>';
                }
                
                if (onlyInPacket2 > 0) {
                    html += '<strong style="color: #2196f3;">ğŸ†• åƒ…å°åŒ…2æ“æœ‰çš„æœå‹™ï¼š</strong>';
                    html += '<ul style="margin: 5px 0; padding-left: 20px;">';
                    sortedServiceIds.forEach(serviceId => {
                        const value1 = services1Map.get(serviceId);
                        const value2 = services2Map.get(serviceId);
                        if (value1 === undefined && value2 !== undefined) {
                            const service = deviceServices[serviceId];
                            const serviceName = service ? service.name : 'æœªçŸ¥æœå‹™';
                            html += `<li>${serviceName} (0x${serviceId.toString(16).toUpperCase().padStart(2, '0')}): ${formatServiceValue(value2, service)}</li>`;
                        }
                    });
                    html += '</ul>';
                }
                
                html += '<div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 5px; font-size: 0.9em;">';
                html += 'ğŸ’¡ <strong>æç¤ºï¼š</strong>é€™äº›å·®ç•°å¯èƒ½æ˜¯å› ç‚ºï¼š<br>';
                html += 'â€¢ ä¸åŒå‹è™Ÿï¼ˆä¾‹å¦‚ï¼š1.5å™¸ vs 2å™¸ï¼‰<br>';
                html += 'â€¢ ä¸åŒç³»åˆ—ï¼ˆä¾‹å¦‚ï¼šåŸºæœ¬æ¬¾ vs æ——è‰¦æ¬¾ï¼‰<br>';
                html += 'â€¢ éŸŒé«”ç‰ˆæœ¬å·®ç•°<br>';
                html += 'â€¢ åŠŸèƒ½é…ç½®ä¸åŒï¼ˆä¾‹å¦‚ï¼šæ˜¯å¦æœ‰ PM2.5 åµæ¸¬ã€è‡ªå‹•æ¸…æ½”ç­‰ï¼‰';
                html += '</div>';
                
                html += '</div>';
            }
            
            document.getElementById('compareResult').innerHTML = html;
            document.getElementById('compareResult').style.display = 'block';
        }
        
        // æ ¼å¼åŒ–æœå‹™æ•¸å€¼
        function formatServiceValue(value, service) {
            if (value === 0xFFFF) {
                return '<span style="color: #999;">0xFFFF (æŸ¥è©¢/ç„¡æ•ˆ)</span>';
            }
            
            let text = `${value} (0x${value.toString(16).toUpperCase().padStart(4, '0')})`;
            
            if (service) {
                if (service.values && service.values[value.toString()]) {
                    text += ` - <strong>${service.values[value.toString()]}</strong>`;
                } else if (service.unit) {
                    text += ` <strong>${service.unit}</strong>`;
                }
            }
            
            return text;
        }
        
        // æ ¼å¼åŒ–åŸå§‹å­—ç¯€é¡¯ç¤º
        function formatRawBytes(bytes, packetLength) {
            let html = '<div style="line-height: 1.8;">';
            html += `<span style="color: #e91e63; font-weight: bold;">${bytes[0].toString(16).toUpperCase().padStart(2, '0')}</span> `; // Length
            html += `<span style="color: #9c27b0; font-weight: bold;">${bytes[1].toString(16).toUpperCase().padStart(2, '0')}</span> `; // SA_ID
            html += `<span style="color: #ff9800; font-weight: bold;">${bytes[2].toString(16).toUpperCase().padStart(2, '0')}</span> `; // Type/Command
            
            // æœå‹™æ•¸æ“šï¼ˆæ¯ 3 å­—ç¯€ä¸€çµ„ï¼Œå¾ç´¢å¼• 3 é–‹å§‹ï¼‰
            for (let i = 3; i < packetLength - 1; i += 3) {
                html += '| ';
                html += `<span style="color: #2196f3;">${bytes[i].toString(16).toUpperCase().padStart(2, '0')}</span> `; // Service ID
                if (i + 1 < packetLength - 1) {
                    html += `${bytes[i + 1].toString(16).toUpperCase().padStart(2, '0')} `; // Data High
                }
                if (i + 2 < packetLength - 1) {
                    html += `${bytes[i + 2].toString(16).toUpperCase().padStart(2, '0')} `; // Data Low
                }
            }
            
            html += `| <span style="color: #4caf50; font-weight: bold;">${bytes[packetLength - 1].toString(16).toUpperCase().padStart(2, '0')}</span>`; // Checksum
            html += '<br><span style="color: #999; font-size: 0.85em;">é•·åº¦ SA_ID é¡å‹ | æœå‹™1(ID+H+L) | æœå‹™2(ID+H+L) | ... | æ ¡é©—ç¢¼</span>';
            html += '</div>';
            return html;
        }

        // ==================== åˆå§‹åŒ– ====================
        window.onload = function() {
            updateServiceOptions();
            displayServices();
            updatePacketBytesInfo();  // åˆå§‹åŒ–å°åŒ…é•·åº¦è³‡è¨Š
            
            // å…è¨± Enter éµè§¸ç™¼æ“ä½œ
            document.getElementById('packetInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    parsePacket();
                }
            });
        };
    </script>
</body>
</html>
